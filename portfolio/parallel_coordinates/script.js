d3.csv("data.csv",function(e,t){if(e)throw e;var n=d3.utcParse("%Y-%m-%dT%H:%M:%S"),a=d3.timeFormat("%Y-%m-%d"),i=(d3.timeParse("%Y-%m-%d"),d3.timeFormat("%e %b '%y"),a(n(0)),[]);t=function(e){return e.forEach((t,n)=>{var a=d3.max(e,e=>+e.Key.substring(e.Key.indexOf("-")+1,e.Key.length).length);for(key=t.Key.substring(0,t.Key.indexOf("-")),number=t.Key.substring(t.Key.indexOf("-")+1,t.Key.length),k=number.length;k<a;k++)number="0"+number;t.key=key+"-"+number}),e.sort((e,t)=>{var n=e.Key.substring(0,e.Key.indexOf("-")),a=t.Key.substring(0,t.Key.indexOf("-")),i=+e.Key.substring(e.Key.indexOf("-")+1,e.Key.length),r=+t.Key.substring(t.Key.indexOf("-")+1,t.Key.length);return n<a?-1:n>a?1:i<r?-1:i>r?1:0}),e.forEach((e,t)=>{e.index=t}),e}(t);var r,s,c=50,l=100,o=10,u=100,d=d3.select("#chart").node().getBoundingClientRect().width-u-l,p=.4*$(window).innerHeight()-c-o,f=p-2,y=window.devicePixelRatio||1,h=d3.scaleSequential().interpolator(function(e,t){var n=0,a=t.length-1,i=t[0],r=new Array(a<0?0:a);for(;n<a;)r[n]=e(i,i=t[++n]);return function(e){var t=Math.max(0,Math.min(a-1,Math.floor(e*=a)));return r[t](e-t)}}(d3.interpolateHcl,["#A0FE65","#FA016D"])).domain([0,t.length-1]),m={Number:{key:"Number",coerce:function(e){return+e},extent:d3.extent,within:function(e,t,n){return t[0]<=n.scale(e)&&n.scale(e)<=t[1]},defaultScale:d3.scaleLinear().range([f,0])},String:{key:"String",coerce:String,extent:function(e){return e.sort()},within:function(e,t,n){return t[0]<=n.scale(e)&&n.scale(e)<=t[1]},defaultScale:d3.scalePoint().range([0,f])},Date:{key:"Date",coerce:function(e){return new Date(e)},extent:d3.extent,within:function(e,t,n){return t[0]<=n.scale(e)&&n.scale(e)<=t[1]},defaultScale:d3.scaleTime().range([0,f])}};r=function(){var e=[];new Set(t.map(e=>e.key)).size>1&&e.push({key:"key",description:"Jira Key",type:m.String,axis:d3.axisLeft().tickFormat(function(e,n){let a=Math.ceil(new Set(t.map(e=>e.key)).size/10);if(n%a==0)return e})});new Set(t.map(e=>e["Epic Name"])).size>1&&e.push({key:"Epic Name",description:"Epic Name",type:m.String,axis:d3.axisLeft().tickFormat(function(e,n){let a=Math.ceil(new Set(t.map(e=>e["Epic Name"])).size/10);if(n%a==0)return e.substring(0,15)+"..."})});new Set(t.map(e=>e["Cost of Delay"])).size>1&&e.push({key:"Cost of Delay",description:"Cost of Delay",type:m.String,axis:d3.axisLeft().tickFormat(function(e,n){let a=Math.ceil(new Set(t.map(e=>e["Cost of Delay"])).size/10);if(n%a==0)return e})});new Set(t.map(e=>e["Resolved Name"])).size>1&&e.push({key:"Resolved Name",description:"Resolution",type:m.String,axis:d3.axisLeft().tickFormat(function(e,n){let a=Math.ceil(new Set(t.map(e=>e["Resolved Name"])).size/10);if(n%a==0)return e})});new Set(t.map(e=>e["Story Points"])).size>1&&e.push({key:"Story Points",description:"Story Points",type:m.Number,scale:d3.scaleSqrt().range([f,0])});new Set(t.map(e=>e["Cycle Time (Bus. Days)"])).size>1&&e.push({key:"Cycle Time (Bus. Days)",description:"Cycle Time",type:m.Number,scale:d3.scaleSqrt().range([f,0])});new Set(t.map(e=>e["Lead Time (Bus. Days)"])).size>1&&e.push({key:"Lead Time (Bus. Days)",description:"Lead Time",type:m.Number,scale:d3.scaleSqrt().range([f,0])});new Set(t.map(e=>e["Created Date"])).size>1&&e.push({key:"Created Date",description:"Created Date",type:m.Date});new Set(t.map(e=>e["First In Progress Date"])).size>1&&e.push({key:"First In Progress Date",description:"In Progress Date",type:m.Date});new Set(t.map(e=>e["Last Resolved Date"])).size>1&&e.push({key:"Last Resolved Date",description:"Resolved Date",type:m.Date});return e}(),s="key",i=r.map(e=>e[s]).map((e,t,n)=>n.indexOf(e)===t&&t).filter(e=>r[e]).map(e=>r[e]);var g=d3.scalePoint().domain(d3.range(i.length)).range([0,d]);$("#chart").height(p+c+o),$("#table").height((p+c+o)/2);var x=d3.select("#chart"),v=x.append("svg").attr("width",d+u+l).attr("height",p+c+o).append("g").attr("transform","translate("+u+","+c+")"),S=x.append("canvas").attr("width",d*y).attr("height",p*y).style("width",d+"px").style("height",p+"px").style("margin-top",c+"px").style("margin-left",u+"px").node().getContext("2d");S.globalAlpha=.1,S.lineWidth=1.5,S.scale(y,y);var w=d3.select("#table").append("pre");t.forEach(function(e){for(var t in i.forEach(function(t){e[t.key]=e[t.key]?t.type.coerce(e[t.key]):null}),e)e[t]&&e[t].length>35&&(e[t]=e[t].slice(0,36))}),i.forEach(function(e){var n;"domain"in e||(e.domain=("function"==typeof(n=e.type.extent)?n:function(){return n})(t.map(function(t){return t[e.key]}))),"scale"in e||(e.scale=e.type.defaultScale.copy()),e.scale.domain(e.domain)}),t=d3.shuffle(t);var b=renderQueue(function(e){S.strokeStyle=h(e.index),S.beginPath();var t=function(e){return i.map(function(t,n){return t.key in e&&null!==e[t.key]?[g(n),t.scale(e[t.key])]:null})}(e);t.forEach(function(e,n){if(null!==e)0!=n?S.lineTo(e[0],e[1]):S.moveTo(e[0],e[1]);else{if(n>0){var a=t[n-1];null!==a&&(S.moveTo(a[0],a[1]),S.lineTo(a[0]+6,a[1]))}if(n<t.length-1){var i=t[n+1];null!==i&&S.moveTo(i[0]-6,i[1])}}}),S.stroke()}).rate(t.length/50);S.clearRect(0,0,d,p),b(t);var D=v.selectAll(".axis").data(i).enter().append("g").attr("class",function(e){return"axis "+e.key.replace(/ /g,"_")}).attr("transform",function(e,t){return"translate("+g(t)+")"});function K(){d3.event.sourceEvent.stopPropagation()}function z(){b.invalidate();var e=[];v.selectAll(".axis .brush").filter(function(e){return d3.brushSelection(this)}).each(function(t){e.push({dimension:t,extent:d3.brushSelection(this)})});var n=t.filter(function(t){if(e.every(function(e){var n=e.dimension;return n.type.within(t[n.key],e.extent,n)}))return!0});v.selectAll(".axis").filter(function(t){return e.indexOf(t)>-1}).classed("active",!0).each(function(e,t){var n=extents[t];d3.select(this).selectAll(".tick text").style("display",function(t){var a=e.type.coerce(t);return e.type.within(a,n,e)?null:"none"})}),v.selectAll(".axis").filter(function(t){return!(e.indexOf(t)>-1)}).classed("active",!1).selectAll(".tick text").style("display",null),S.clearRect(0,0,d,p),b(n),w.text(d3.tsvFormat(n.slice())),n}D.append("g").each(function(e){var t="axis"in e?e.axis.scale(e.scale):d3.axisLeft().scale(e.scale);d3.select(this).call(t)}).append("text").attr("class","title").attr("text-anchor","start").text(function(e){return"description"in e?e.description:e.key}),D.append("g").attr("class","brush").each(function(e){d3.select(this).call(e.brush=d3.brushY().extent([[-10,0],[10,p]]).on("start",K).on("brush",z).on("end",z))}).selectAll("rect").attr("x",-8).attr("width",16),console.log(t.slice()),w.text(d3.tsvFormat(t.slice()))});