        var formatInteger=d3.format("d"),oldUserStories50th=0,oldUserStories85th=0,oldUserStories95th=0,oldSprints50th=0,oldSprints85th=0,oldSprints95th=0;outputData=updateData();var cadenceWidth=d3.select("#cadenceType1").node().getBoundingClientRect().width-3*parseFloat($("#cadenceType1").css("padding-left")),cadenceHeight=d3.select("#cadenceType1").node().getBoundingClientRect().height;for(i=1;i<=10;i++)d3.select("#cadenceType"+i).append("svg").attr("width",cadenceWidth).attr("height",cadenceHeight).append("text").text("Sprint "+i).attr("y",cadenceHeight/2).attr("dy","0.35em").style("fill","white");var margin={top:20,right:80,bottom:40,left:50},width=d3.select("#chart").node().getBoundingClientRect().width-margin.left-margin.right,height=d3.select("#dataInput").node().getBoundingClientRect().height-3*margin.top-margin.bottom,svg=d3.select("#chart").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom),layerPDF=svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")"),layerCDF=svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")");svg.append("text").attr("id","xAxisLabel").attr("transform","translate("+(width+margin.left+margin.right)/2+" ,"+(height+margin.top+32)+")").style("text-anchor","middle").attr("fill","white").attr("font-size","0.75em").text("Number of Sprints"),svg.append("text").attr("id","yAxisConfLabel").attr("transform","rotate(-90)").attr("y",0-margin.left).attr("x",0-(height+margin.top)/2).attr("dy","5em").attr("fill","white").attr("font-size","0.75em").style("text-anchor","middle").text("% Confidence to Deliver"),svg.append("text").attr("id","yAxisRiskLabel").attr("transform","rotate(90)").attr("y",-width-margin.left).attr("x",(height+margin.top)/2).attr("dy","-3em").attr("fill","white").attr("font-size","0.75em").style("text-anchor","middle").text("% Risk to Deliver");var xAxis=d3.scaleBand().range([0,width]).padding(.1),xAxisLine=d3.scaleLinear().range([0,width]),yAxisPDF=d3.scaleLinear().range([height,0]),yAxisCDFConf=d3.scaleLinear().range([height,0]),yAxisCDFConfPer=d3.scaleLinear().domain([height,0]).range([0,1]),yAxisCDFRisk=d3.scaleLinear().range([height,0]);xAxis.domain(outputData.map(t=>t.key)),xAxisLine.domain([d3.min(outputData,t=>+t.key),d3.max(outputData,t=>+t.key)]),yAxisPDF.domain([0,d3.max(outputData,t=>t.value.confidencePDF)]),yAxisCDFConf.domain([0,d3.max(outputData,t=>t.value.confidenceCDF)]),yAxisCDFRisk.domain([d3.max(outputData,t=>t.value.confidenceCDF),0]);var xTickValues=d3.axisBottom(xAxis).tickValues(xAxis.domain().filter(function(t,e){return outputData.length<=10?e:!(e%Math.floor(outputData.length/10))}));layerPDF.selectAll(".bar").data(outputData).enter().append("rect").attr("class","bar").attr("x",t=>xAxis(t.key)).attr("width",xAxis.bandwidth()).attr("y",t=>yAxisPDF(t.value.confidencePDF)).attr("height",t=>height-yAxisPDF(t.value.confidencePDF)).attr("fill","white"),layerCDF.append("g").attr("class","x").attr("transform","translate(0,"+height+")").call(xTickValues),layerCDF.append("g").attr("class","y").call(d3.axisLeft(yAxisCDFConf).tickFormat(d3.format(".0%"))),layerCDF.append("g").attr("class","y").attr("transform","translate("+width+",0)").call(d3.axisRight(yAxisCDFRisk).tickFormat(d3.format(".0%")));var lineChart=d3.line().x(t=>xAxisLine(+t.key)).y(t=>yAxisCDFConf(t.value.confidenceCDF)),linePath=layerCDF.append("path").attr("class","line").attr("d",lineChart(outputData)),mouseG=svg.append("g").attr("class","mouse-over-effects").attr("transform","translate("+margin.left+","+margin.top+")"),lineHoverY=mouseG.append("line").attr("class","mouse-line").attr("id","mouse-line-y").style("stroke-width","2px").style("opacity","0").style("stroke","white").style("stroke-dasharray","5 5"),lineHoverX=mouseG.append("line").attr("class","mouse-line").attr("id","mouse-line-x").style("stroke-width","2px").style("opacity","0").style("stroke","white").style("stroke-dasharray","5 5"),hoverCircle=mouseG.append("circle").attr("id","Circle").attr("class","hoverCircle").attr("r",7).style("stroke-width","2px").style("opacity","0"),hoverCircleBackground=mouseG.selectAll("rect").data(["HoverRect","DateRect"]).enter().append("rect").attr("id",t=>t).attr("class","hoverBackground"),hoverCircleText=mouseG.selectAll("text").data(["HoverText","DateText"]).enter().append("text").attr("id",t=>t).attr("class","hoverText").attr("fill","white"),hoverCircle50th=mouseG.append("circle").attr("id","Circle50th").attr("class","hoverCircle").attr("r",7).style("stroke-width","2px").style("opacity","0");function cadenceTypeChange(){var t,e,a,r=d3.select("#configCadenceTypeButton")._groups[0][0].textContent;"Sprints"==r?(t="Sprint",e="Days",a=10):"Days"==r?(t="Day",e="Hours",a=8):"Weeks"==r?(t="Week",e="Days",a=5):"Months"==r&&(t="Month",e="Days",a=20),void 0===t&&(t="Sprint",e="Days",a=10);for(var n=1;n<=10;n++)d3.select("#cadenceType"+n).select("text").text(t+" "+n),d3.select("#inputLength"+n).transition().duration(2500).on("start",function(){d3.active(this).attrTween("value",function(){var t=d3.select(this).property("value");return d3.interpolateRound(t,a)})});d3.select("#configCadenceLength").transition().duration(2500).on("start",function(){d3.active(this).attrTween("value",function(){var t=d3.select(this).property("value");return d3.interpolateRound(t,a)})}),d3.select("#labelConfigCadenceLength").html(t+" Length <br>(Work "+e+")"),d3.select("#labelInputLength").html(t+" Length <br>(Work "+e+")"),updateChart()}function leastSquares(t,e,a,r){"object"==typeof a&&(r=a,a=!1),void 0===r&&(r={});for(var n=0,i=0,o=0,s=0,l=t.length,d=0;d<l;++d)n+=t[d],i+=e[d],o+=t[d]*e[d],s+=t[d]*t[d];if(r.m=(o-n*i/l)/(s-n*n/l),r.b=i/l-r.m*n/l,a){for(var c=0,h=0;h<l;++h)c+=(e[h]-r.b-r.m*t[h])*(e[h]-r.b-r.m*t[h]);var u=l*s-n*n,p=1/(l-2)*c;r.bErr=Math.sqrt(p/u*s),r.mErr=Math.sqrt(l/u*p)}return function(t){return r.m*t+r.b}}function closestValue(t,e){for(var a=e[0],r=Math.abs(t-a),n=0;n<e.length;n++){var i=Math.abs(t-e[n]);i<r&&(r=i,a=e[n])}return a}function pathTween(t,e){return function(){for(var a=this,r=a.cloneNode(),n=a.getTotalLength(),i=(r.setAttribute("d",t),r).getTotalLength(),o=[0],s=0,l=e/Math.max(n,i);(s+=l)<1;)o.push(s);o.push(1);var d=o.map(function(t){var e=a.getPointAtLength(t*n),o=r.getPointAtLength(t*i);return d3.interpolate([e.x,e.y],[o.x,o.y])});return function(e){return e<1?"M"+d.map(function(t){return t(e)}).join("L"):t}}}function updateData(){for(var t=+d3.select("#configWorkItems").property("value"),e=parseFloat(d3.select("#configGoalFocus").property("value"))/100,a=+d3.select("#configCadenceLength").property("value"),r=d3.select("#configCadenceType").select("button")._groups[0][0].textContent,n=d3.select("#configConstraintType").select("button")._groups[0][0].textContent,i=d3.select("#configWorkItemType").select("button")._groups[0][0].textContent,o=0,s=[],l=1;l<=10;l++)+d3.select("#inputThroughput"+l).property("value")>0&&(o++,s.push(+d3.select("#inputLength"+l).property("value")/+d3.select("#inputThroughput"+l).property("value")));s.sort((t,e)=>d3.ascending(t,e));var d=[],c=[],h=[];for(l=0;l<o;l++)d.push({x:s[l],fX:+(.05+1/o*l).toFixed(2)}),c.push(Math.log(s[l])),h.push(Math.log(-Math.log(1-+(.05+1/o*l).toFixed(2))));var u={};leastSquares(c,h,!0,u),step=(d3.max(d,t=>t.x)-d3.min(d,t=>t.x))/1e3,yIntercept=u.b,shape=u.m,scale=Math.pow(Math.E,-yIntercept/shape);var p=[],y=[],x=[];for(l=0;l<1e3;l++)p.push(parseFloat((l*step).toFixed(3))),x.push(shape/scale*Math.pow(p[l]/scale,shape-1)*Math.pow(Math.E,-Math.pow(p[l]/scale,shape))),y.push(1-Math.pow(Math.E,-Math.pow(p[l]/scale,shape)));var g=0,f=0,m=[];for(l=0;l<1e3;l++){for(var v=0;v<o;v++)g+=p[y.indexOf(closestValue(Math.random(),y))];f=g/o,"Scope"==n?(m.push(Math.ceil(t*f/(e*a))),d3.select("#labelConfigWorkItems").text("No. of "+i)):"Time"==n&&(m.push(Math.floor(t*e*a/f)),d3.select("#labelConfigWorkItems").text("No. of "+r)),g=0}var D=d3.nest().key(t=>t).rollup(t=>({total:t.length})).entries(m);if(D.sort((t,e)=>d3.ascending(+t.key,+e.key)),D.forEach((t,e)=>{t.value.confidencePDF=t.value.total/m.length,"Scope"==n?t.value.confidenceCDF=0==e?t.value.confidencePDF:t.value.confidencePDF+D[e-1].value.confidenceCDF:"Time"==n&&(t.value.confidenceCDF=0==e?1:D[e-1].value.confidenceCDF-t.value.confidencePDF)}),"Scope"==n){D.sprints50th=D.find(t=>t.value.confidenceCDF>=.5).key,D.sprints85th=D.find(t=>t.value.confidenceCDF>=.85).key,D.sprints95th=D.find(t=>t.value.confidenceCDF>=.95).key;var C="Stories",w=r,b=t,F=t,k=t,A=D.sprints50th,T=D.sprints85th,S=D.sprints95th}else if("Time"==n){D.stories50th=D.find(t=>t.value.confidenceCDF<=.5).key,D.stories85th=D.find(t=>t.value.confidenceCDF<=.85).key,D.stories95th=D.find(t=>t.value.confidenceCDF<=.95).key;C="Sprints",w=i,b=D.stories50th,F=D.stories85th,k=D.stories95th,A=t,T=t,S=t}return updateSummary(oldUserStories50th,b,oldUserStories85th,F,oldUserStories95th,k,oldSprints50th,A,oldSprints85th,T,oldSprints95th,S),oldUserStories50th=b,oldUserStories85th=F,oldUserStories95th=k,oldSprints50th=A,oldSprints85th=T,oldSprints95th=S,d3.select("#input-simDataNoStoriesHeader").html("No. of "+C),d3.select("#input-simDataNoStoriesHeader").html("No. of "+C),d3.select("text#xAxisLabel").html("Number of "+w),D}function updateOutputPercentage(t,e){d3.select(t).transition().duration(2500).on("start",function(){d3.active(this).tween("text",function(){var t=d3.select(this),a=d3.interpolateNumber(t.text(),e);return function(e){t.text(formatPercentage(a(e)))}})})}function updateOutputInteger(t,e,a){var r,n=d3.select("#configConstraintType").select("button")._groups[0][0].textContent;r="Scope"==n&&"story"==a||"Time"==n&&"sprint"==a?"#FDBB32":"white",d3.select(t).transition().duration(2500).style("color",r).on("start",function(){d3.active(this).tween("text",function(){var t=d3.select(this),a=d3.interpolateNumber(t.text(),e);return function(e){t.html(formatInteger(a(e)))}})})}function updateSummary(t,e,a,r,n,i,o,s,l,d,c,h){var u=d3.select("#configCadenceType").select("button")._groups[0][0].textContent.toLowerCase(),p=(d3.select("#configConstraintType").select("button")._groups[0][0].textContent,d3.select("#configWorkItemType").select("button")._groups[0][0].textContent.toLowerCase());d3.select("#outputSummary50th").transition().duration(2500).on("start",function(){d3.active(this).tween("text",function(){var a=d3.select(this);return storyValue=d3.interpolateNumber(t,e),sprintValue=d3.interpolateNumber(o,s),function(t){a.html("There is a 50% chance we can deliver <span style='color:gold;'>&nbsp"+formatInteger(storyValue(t))+"&nbsp</span> "+p+" in <span style='color:gold;'>&nbsp"+formatInteger(sprintValue(t))+"</span>&nbsp"+u+" with 50% risk associated.")}})}),d3.select("#outputSummary85th").transition().duration(2500).on("start",function(){d3.active(this).tween("text",function(){var t=d3.select(this),e=d3.interpolateNumber(a,r),n=d3.interpolateNumber(l,d);return function(a){t.html("There is a 85% chance we can deliver <span style='color:gold;'>&nbsp"+formatInteger(e(a))+"&nbsp</span> "+p+" in <span style='color:gold;'>&nbsp"+formatInteger(n(a))+"</span>&nbsp"+u+" with 15% risk associated.")}})}),d3.select("#outputSummary95th").transition().duration(2500).on("start",function(){d3.active(this).tween("text",function(){var t=d3.select(this),e=d3.interpolateNumber(n,i),a=d3.interpolateNumber(c,h);return function(r){t.html("There is a 95% chance we can deliver <span style='color:gold;'>&nbsp"+formatInteger(e(r))+"&nbsp</span> "+p+" in <span style='color:gold;'>&nbsp"+formatInteger(a(r))+"</span>&nbsps"+u+" with 5% risk associated.")}})})}function updateChart(){layerPDF.selectAll(".bar").attr("fill","white"),outputData=updateData(),xAxis.domain(outputData.map(t=>t.key)),xAxisLine.domain([d3.min(outputData,t=>+t.key),d3.max(outputData,t=>+t.key)]),yAxisPDF.domain([0,d3.max(outputData,t=>t.value.confidencePDF)]),yAxisCDFConf.domain([0,d3.max(outputData,t=>t.value.confidenceCDF)]),xTickValues=d3.axisBottom(xAxis).tickValues(xAxis.domain().filter(function(t,e){return outputData.length<=10?e:!(e%Math.floor(outputData.length/10))}));var t=d3.select("#chart"),e=layerPDF.selectAll(".bar").data(outputData);t.transition().select(".x").duration(750).call(xTickValues),t.transition().select(".y").duration(750).call(d3.axisLeft(yAxisCDFConf).tickFormat(d3.format(".0%"))),e.exit().transition().duration(750).attr("height",0).attr("y",height).remove(),e.enter().append("rect").attr("class","bar").attr("fill","#FDBB32").attr("width",xAxis.bandwidth()).attr("height",0).attr("y",height).attr("x",t=>xAxis(t.key)).merge(e).transition().duration(750).attr("height",t=>height-yAxisPDF(t.value.confidencePDF)).attr("y",t=>yAxisPDF(t.value.confidencePDF)).attr("width",xAxis.bandwidth()).attr("x",t=>xAxis(t.key)),t.transition().select(".line").duration(750).attrTween("d",pathTween(lineChart(outputData),1))}function updateMouseOver(t,e){var a=document.getElementById("chart").offsetLeft,r=linePath.node(),n=r.getTotalLength(),o=d3.bisector(t=>t.key).right,s=(Math.max(n),Math.max(d3.select("text#HoverText").node().getBBox().width),d3.event.pageX-a-margin.left-parseFloat($("#chart").css("padding-left"))),l=e[o(e,xAxisLine.invert(s-xAxis.bandwidth()/2))];for(d3.select("text#DateText").style("opacity",1).attr("x",s).attr("y",height+margin.bottom/2+5).attr("dy","0.1em").attr("text-anchor","middle").text(l.key),d3.select("rect#DateRect").style("opacity",1).attr("x",s).attr("y",height+margin.bottom/2+5).attr("width",d3.select("text#DateText").node().getBBox().width+2).attr("height",d3.select("text#DateText").node().getBBox().height+2).attr("transform","translate("+-d3.select("text#DateText").node().getBBox().width/2+",-15)"),i=s;i<n;i+=1){var d=r.getPointAtLength(i);if(d.x>=s)break}if(width-d.x<145)var c=-15-d3.select("text#HoverText").node().getBBox().width;else c=10;d3.select("circle#Circle").style("fill","white").style("stroke","white").style("opacity",1).attr("cx",s-1).attr("cy",d.y),d3.select("text#HoverText").style("opacity",1).attr("x",s).attr("y",d.y).attr("dx",c).attr("dy","0.25em").text("Confidence: "+d3.format(".0%")(yAxisCDFConfPer(d.y))),d3.select("rect#HoverRect").style("opacity",1).attr("x",s).attr("y",d.y).attr("width",d3.select("text#HoverText").node().getBBox().width+2).attr("height",d3.select("text#HoverText").node().getBBox().height+2).attr("transform","translate("+c+",-12.5)"),d3.selectAll("#mouse-line-x").attr("x1",0).attr("x2",d.x).attr("y1",d.y).attr("y2",d.y),d3.selectAll("#mouse-line-y").attr("x1",t[0]).attr("x2",t[0]).attr("y1",height).attr("y2",d.y),d3.select("circle#Circle50th").style("fill","white").style("stroke","white").style("opacity",1).attr("cx",s-1).attr("cy",d.y)}mouseG.append("rect").attr("width",width).attr("height",height).attr("fill","none").attr("pointer-events","all").on("mouseout",function(){d3.selectAll(".mouse-line").style("opacity","0"),d3.selectAll(".hoverCircle").style("opacity","0"),d3.selectAll(".hoverBackground").style("opacity","0"),d3.selectAll(".hoverText").style("opacity","0")}).on("mouseover",function(){d3.selectAll(".mouse-line").style("opacity","1"),d3.selectAll(".hoverCircle").style("opacity","1"),d3.selectAll(".hoverBackground").style("opacity","1"),d3.selectAll(".hoverText").style("opacity","1")}).on("mousemove",function(){updateMouseOver(d3.mouse(this),outputData)});