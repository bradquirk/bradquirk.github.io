if(/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)||/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.platform))$("#chart").append('<img src="/img/portfolio/cards/relationship_heatmap_card.png"/>'),$("#chart").append("<p>For the interactive version, please visit this site on desktop!</p>"),d3.select("#header").html("<h3 class='amber-text'>Relationship Heatmap</h3><h6>version 1.0</h6>");else{var margin={top:10,right:200,bottom:150,left:150},tooltipMargin={top:20,right:20,bottom:60,left:60},width=$("#chart").width()-margin.left-margin.right,height=.6*$(window).innerHeight()-margin.top-margin.bottom,tooltipWidth=.4*$(window).innerHeight()-tooltipMargin.left-tooltipMargin.right,tooltipHeight=.4*$(window).innerHeight()-tooltipMargin.top-tooltipMargin.bottom,tooltip=d3.select("#chart").append("div").attr("id","tooltip").style("max-width",1.2*tooltipWidth).style("position","absolute").style("visibility","hidden");tooltipSVG=tooltip.append("p").attr("id","tooltipText").attr("font-size","0.5em"),tooltipSVG=tooltip.append("svg").attr("width",tooltipWidth+tooltipMargin.left+tooltipMargin.right).attr("height",tooltipHeight+tooltipMargin.top+tooltipMargin.bottom).style("background-color","#333").append("g").attr("transform","translate("+tooltipMargin.left+","+tooltipMargin.top+")");var tooltipX=d3.scaleLinear().domain([0,1]).range([0,tooltipWidth]);tooltipSVG.append("g").attr("class","x axis").attr("transform","translate(0,"+tooltipHeight+")").call(d3.axisBottom(tooltipX)),tooltipSVG.append("text").attr("id","tooltipXText").attr("transform","translate("+tooltipWidth/2+" ,"+(tooltipHeight+tooltipMargin.top+20)+")").style("text-anchor","middle");var tooltipY=d3.scaleLinear().domain([0,1]).range([tooltipHeight,0]);tooltipSVG.append("g").attr("class","y axis").call(d3.axisLeft(tooltipY)),tooltipSVG.append("text").attr("id","tooltipYText").attr("transform","rotate(-90)").attr("x",0-tooltipHeight/2).attr("dy","1em").style("text-anchor","middle"),d3.select("#tooltipYText").attr("y",0-tooltipMargin.left),tooltipSVG.append("g").attr("id","scatterGroup");var PearsonPath=d3.line().x(t=>tooltipX(t.xValues)).y(t=>tooltipY(t.yValues));tooltipSVG.append("path").attr("id","tooltipLine").attr("stroke-width","1px").style("stroke","white"),tooltipSVG.append("text").append("textPath").attr("id","tooltipLineText").attr("xlink:href","#tooltipLine").attr("startOffset","50%").style("text-anchor","middle").style("fill","white").style("dy",-10);var dataTable=[];d3.csv("data.csv",function(t,e){if(t)throw t;for(var a=d3.keys(e[0]).filter(function(t){return"key"!==t&&"index"!==t}),o=(a.length,0);o<a.length;o++)for(var i=0;i<a.length;i++){var l={},r=e.map(t=>+t[a[o]]),n=e.map(t=>+t[a[i]]);S(r,n,!0,l),r.filter((t,e,a)=>a.indexOf(t)===e).length>=3&&n.filter((t,e,a)=>a.indexOf(t)===e).length>=3&&dataTable.push({xName:a[o],yName:a[i],xValues:r,yValues:n,linReg:l,pearson:Math.pow(X(r,n),2)})}a=dataTable.map(t=>t.xName).filter((t,e,a)=>a.indexOf(t)===e);var p=d3.select("#chart").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),s=d3.scaleBand().range([0,width]).domain(a).padding(.01);p.append("g").attr("transform","translate(0,"+height+")").call(d3.axisBottom(s)).selectAll("text").attr("class","axisValues").attr("id",t=>"xAxis"+V(t.replace("("," ").replace(")"," "))).style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-45)");var d=d3.scaleBand().range([height,0]).domain(a.reverse()).padding(.01);p.append("g").call(d3.axisLeft(d)).selectAll("text").attr("class","axisValues").attr("id",t=>"yAxis"+V(t.replace("("," ").replace(")"," ")));var h=d3.scaleSequential().interpolator(d3.interpolateWarm),c=d3.scaleSequential().interpolator(d3.interpolateWarm);p.selectAll().data(dataTable).enter().append("rect").attr("x",function(t){return s(t.xName)}).attr("y",function(t){return d(t.yName)}).attr("width",s.bandwidth()).attr("height",d.bandwidth()).style("fill",t=>t.xName==t.yName||t.xValues.filter(t=>t>0).length<=1||t.yValues.filter(t=>t>0).length<=1?"#333":h(t.pearson)).attr("box-sizing","border-box").on("mouseout",function(){d3.selectAll(".axisValues").transition().attr("fill","white"),tooltip.transition().style("visibility","hidden")}).on("mouseover",function(t){d3.select("#xAxis"+V(t.xName.replace("("," ").replace(")"," "))).transition().attr("fill",h(.5)),d3.select("#yAxis"+V(t.yName.replace("("," ").replace(")"," "))).transition().attr("fill",h(.5)),A(d3.mouse(this),t)}).on("mousemove",function(t){A(d3.mouse(this),t)});var g=d3.range(20).map(t=>h(t/20)).reverse();p.append("defs").append("linearGradient").attr("id","gradient-colors").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%").selectAll("stop").data(g).enter().append("stop").attr("offset",function(t,e){return e/(g.length-1)}).attr("stop-color",function(t){return t});var m=p.append("g").attr("class","legendWrapper").attr("transform","translate("+(width+10)+","+margin.top+")");m.append("rect").attr("class","legendRect").attr("y",10).attr("width","15px").attr("height",height/2).style("fill","url(#gradient-colors)"),m.append("text").attr("class","legendTitle").text("Relationship Strength");var x=d3.scaleLinear().domain([0,1]).range([height/2-1,0]);m.append("g").attr("class","legendAxis").attr("transform","translate(15,10)").call(d3.axisRight(x).ticks(5).tickFormat(d3.format(".0%"))).selectAll("path").style("stroke","none");var f=p,u={x:window.scrollX,y:window.scrollY,w:window.innerWidth,h:window.innerHeight},y=d3.select("#chart"),v=(y.node().offsetWidth,y.node().offsetHeight,document.width,document.height,function(t){for(var e=d3.select("body").node(),a=0,o=0;null!=t&&t!=e;a+=t.offsetLeft||t.clientLeft,o+=t.offsetTop||t.clientTop,t=t.offsetParent||t.parentNode);return{x:a,y:o}}(f.node())),w={x:15,y:15},b=$("#chart").position();function V(t){return t.replace(/(?:^\w|[A-Z]|\b\w|\s+)/g,function(t,e){return 0==+t?"":0==e?t.toLowerCase():t.toUpperCase()})}function S(t,e,a,o){"object"==typeof a&&(o=a,a=!1),void 0===o&&(o={});for(var i=0,l=0,r=0,n=0,p=t.length,s=0;s<p;++s)i+=t[s],l+=e[s],r+=t[s]*e[s],n+=t[s]*t[s];if(o.m=(r-i*l/p)/(n-i*i/p),o.b=l/p-o.m*i/p,a){for(var d=0,h=0;h<p;++h)d+=(e[h]-o.b-o.m*t[h])*(e[h]-o.b-o.m*t[h]);var c=p*n-i*i,g=1/(p-2)*d;o.bErr=Math.sqrt(g/c*n),o.mErr=Math.sqrt(p/c*g)}return function(t){return o.m*t+o.b}}function X(t,e){let{min:a,pow:o,sqrt:i}=Math,l=(t,e)=>t+e,r=a(t.length,e.length);if(0===r)return 0;[t,e]=[t.slice(0,r),e.slice(0,r)];let[n,p]=[t,e].map(t=>t.reduce(l)),[s,d]=[t,e].map(t=>t.reduce((t,e)=>t+o(e,2),0)),h=t.map((t,a)=>t*e[a]).reduce(l),c=i((s-o(n,2)/r)*(d-o(p,2)/r));return 0===c?0:(h-n*p/r)/c}function A(t,e){var a=document.getElementById("chart").offsetLeft;d3.event.pageX,margin.left;tooltipSVG.select(".x").transition().call(d3.axisBottom(tooltipX)),tooltipSVG.select(".y").transition().call(d3.axisLeft(tooltipY));var o=d3.mouse(f.node());u.x=window.scrollX,u.y=window.scrollY,o[0]+=v.x,o[1]+=v.y,tooltip.style("right",""),tooltip.style("left",""),tooltip.style("bottom",""),tooltip.style("top",""),d3.select("#tooltipText").html(e.xName+" vs. "+e.yName+"</br>Strength: <span style='color:"+h(e.pearson)+";'>"+d3.format(".0%")(e.pearson)+"</span>"),tooltip.style("height",$("#heading").height()),o[0]>$(window).innerWidth()/2?tooltip.style("left",event.clientX-b.left-w.x-$("#tooltip").width()+"px"):tooltip.style("left",event.clientX-b.left+w.x+"px"),o[1]>$(window).innerHeight()/2?tooltip.style("top",event.clientY-b.top-w.y-$("#tooltip").height()+"px"):tooltip.style("top",event.clientY-b.top+w.y+"px"),tooltip.style("visibility","visible");for(var i=[],l=e.xValues.length-1;l>=0;l--)i.push({xValues:e.xValues[l],yValues:e.yValues[l]});tooltipX.domain([0,d3.max(e.xValues)]),tooltipY.domain([0,d3.max(e.yValues)]),c.domain(tooltipX.domain());var r=tooltipSVG.select("#scatterGroup").selectAll("circle").data(i);r.exit().remove(),r.enter().append("circle").attr("r",0),r.transition().attr("cx",t=>tooltipX(t.xValues)).attr("cy",t=>tooltipY(t.yValues)).attr("r",3).style("opacity",.5).attr("fill",t=>c(t.xValues));var n=[],p=e.linReg;for(l=0;l<tooltipX.domain()[1];l+=tooltipX.domain()[1]/50)n.push({xValues:l,yValues:p.m*l+p.b});n=n.filter(t=>t.xValues>=tooltipX.domain()[0]&&t.xValues<=tooltipX.domain()[1]&&t.yValues>=tooltipY.domain()[0]&&t.yValues<=tooltipY.domain()[1]);var s=tooltipSVG.selectAll("#tooltipLine").data([n]);s.enter().append("path").attr("id","tooltipLine").merge(s).transition().attr("d",PearsonPath).attr("fill","none").attr("stroke-width",2.5),d3.select("#tooltipLineText").text(function(){return p.b>0?"y = "+p.m.toFixed(2)+"*x + "+p.b.toFixed(2):"y = "+p.m.toFixed(2)+"*x "+p.b.toFixed(2)}),d3.select("#tooltipXText").text(e.xName),d3.select("#tooltipYText").text(e.yName)}})}