<!DOCTYPE html>
<meta charset="utf-8">
<style>
    /* set the CSS */

    body {
        font-family: 'Arial', sans-serif;
        font-size: 12px;
        font-weight: 400;
        background-color: #2E353D;
        /*        margin-top: 10px;*/
    }


    /*
.arcs {
    cursor: pointer;
}
*/

    hr {
        width: 100%;
        height: 8px;
        margin-left: auto;
        margin-right: auto;
        background-color: #FFF;
        border: 0 none;
        margin-top: 100px;
        margin-bottom: 100px;
    }

    #header {
        /*        padding: 10px 0 0 10px;*/
        font-family: "Poppins";
        color: white;
    }

    .node rect {
        cursor: move;
        fill-opacity: .9;
        shape-rendering: crispEdges;
    }

    .node text {
        pointer-events: none;
    }

    .link {
        fill: none;
        stroke: #FFF;
        stroke-opacity: .15;
    }

    .link:hover {
        stroke-opacity: .25;
    }

    #tooltip {
        background-color: rgba(0, 0, 0, .8);
        border: none;
        border-radius: 5px;
        padding: 15px;
        max-width: 400px;
        text-align: left;
        color: white;
    }

</style>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Brad Quirk | Value Stream Map</title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css">
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/mdb.min.css" rel="stylesheet">
    <link href="/css/style_lean_dashboard.css" rel="stylesheet">
    <!-- Hotjar Tracking Code for https://quirkules.github.io/ -->
    <script>
        (function(h, o, t, j, a, r) {
            h.hj = h.hj || function() {
                (h.hj.q = h.hj.q || []).push(arguments)
            };
            h._hjSettings = {
                hjid: 1230223,
                hjsv: 6
            };
            a = o.getElementsByTagName('head')[0];
            r = o.createElement('script');
            r.async = 1;
            r.src = t + h._hjSettings.hjid + j + h._hjSettings.hjsv;
            a.appendChild(r);
        })(window, document, 'https://static.hotjar.com/c/hotjar-', '.js?sv=');

    </script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-50453785-4"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());

        gtag('config', 'UA-50453785-4');

    </script>

</head>

<body>
    <!-- SCRIPTS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script type="/text/javascript" src="/js/mdb.js"></script>
    <script src="/js/d3.min.js"></script>
    <script src="/js/d3-color.js"></script>
    <script src="/js/d3-scale-chromatic.js"></script>
    <script src="/js/d3-interpolate.js"></script>
    <script src="/js/jquery.js"></script>
    <script src="https://unpkg.com/d3-sankey@0"></script>
    <!-- Navbar-->
    <nav class="navbar sticky-top navbar-expand-lg navbar-dark dark-color" id="navbar">
        <a class="navbar-brand amber-text" href="/">
    <img src="/img/sitelogo_yellow.png" height="30" alt="logo"> 
  </a>
        <a class="navbar-brand amber-text" href="/">
    Brad Quirk
  </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="amber-text"><i
        class="fas fa-bars fa-1x"></i></span>
  </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item px-2">
                    <a class="nav-link amber-text" href="/">Home</a>
                </li>
                <li class="nav-item px-2 active">
                    <a class="nav-link amber-text" href="/portfolio/">Portfolio<span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item px-2">
                    <a class="nav-link amber-text" href="/about/">About</a>
                </li>
                <li class="nav-item px-2"><a class="amber-text" href="/contact/">
                    <button class="btn btn-sm btn-outline-warning" type="button">Contact</button></a>
                </li>
            </ul>
        </div>

    </nav>
    <!-- Navbar-->

    <div class="container">
        <div class="row">
            <div class="col amber-text" id="header">
                <h1>Value Stream Map</h1>
                <h6>version 1.0</h6>
            </div>
        </div>
        <div></div>
        <div class="row m-2">
            <div class="col" id="chart" style="overflow-x: auto; overflow-y:hidden;"></div>
        </div>
        <h6 class="mb-4 white-text"><small>Note: Each checkpoint can be repositioned, and each transition contains more information when hovered over</small></h6>
        <!-- Accordion card -->
        <div class="accordion md-accordion" id="accordionValue" role="tablist" aria-multiselectable="true">
            <div>
                <!-- Card header -->
                <div class="header" role="tab" id="headingOne1">
                    <a data-toggle="collapse" data-parent="#accordionValue" href="#collapseOne1" aria-expanded="true" aria-controls="collapseOne1">
                        <h4 class="my-4 amber-text">
                            The Value <i class="fas fa-angle-down rotate-icon"></i>
                        </h4>
                    </a>
                </div>
                <!-- Card body -->
                <div id="collapseOne1" class="collapse show" role="tabpanel" aria-labelledby="headingOne1" data-parent="#accordionValue">
                    <div class="white-text">
                        <p>
                            When undertaking large-scale change programs, we want to understand our existing end-to-end processes in order to indentify more efficient avenues to add customer value, or in other words eliminate waste. The Value Stream Map (VSM) is a decades-old lean-manufacturing technique that has been used by thousands of companies to fulfil this exact purpose. Especially in agile transformation programs, it doesn't take too long until the topic of VSMs start creeping to the surface.</p>
                        <p>
                            But if we're all talking about VSMs, why aren't the outputs of the exercise sitting in a framed poster inside every boardroom or meeting hub? I believe the answer is simple; <b>traditional Value Stream Maps are really difficult to interpret.</b></p> Without a detailed workshop or instruction manual they don't hold much conveyance to the end user.

                        <p>
                            So what if we took these confusing outputs and repurposed them to make them much easier to interpret? By using the metaphor of 'flow', which is a key principle of lean manufacturing to begin with, and extending it to represent a pipeline of customer value, it should be much easier to highlight the current state of an organisation's processes and where the opportunities for improvement lie.</p>
                    </div>
                </div>

            </div>
        </div>
        <!-- Accordion card -->
        <!-- Accordion card -->
        <div class="accordion md-accordion" id="accordionHypothesis" role="tablist" aria-multiselectable="true">
            <div>
                <!-- Card header -->
                <div class="header" role="tab" id="headingOne2">
                    <a class="collapsed" data-toggle="collapse" data-parent="#accordionHypothesis" href="#collapseOne2" aria-expanded="false" aria-controls="collapseOne2">
                        <h4 class="my-4 amber-text">
                            Hypothesis <i class="fas fa-angle-down rotate-icon"></i>
                        </h4>
                    </a>
                </div>
                <!-- Card body -->
                <div id="collapseOne2" class="collapse" role="tabpanel" aria-labelledby="headingOne2" data-parent="#accordionHypothesis">
                    <div class="white-text">
                        <p><i>I believe<br>
                    that by taking the existing outputs of a traditional Value Stream Map (i.e. Lead Time, Throughput, WIP, Defect & Discard Rates)<br>
                    will enable managers and leaders to easily understand and articulate the overall efficiency of their customer-driven processes<br>
                    and lead to structured conversations about optimising said processes where traditional VSMs could not before.<br>
                    I'll know I'm right when any member of an organisation can identify their place within 'the ecosystem'<br>
                    and understand how their efficincy can impact those further downstream.
                    </i></p>
                    </div>
                </div>

            </div>
        </div>
        <!-- Accordion card -->
        <!-- Accordion card -->
        <div class="accordion md-accordion" id="accordionMethod" role="tablist" aria-multiselectable="true">
            <div>
                <!-- Card header -->
                <div class="header" role="tab" id="headingOne3">
                    <a class="collapsed" data-toggle="collapse" data-parent="#accordionMethod" href="#collapseOne3" aria-expanded="false" aria-controls="collapseOne3">
                        <h4 class="my-4 amber-text">
                            Method <i class="fas fa-angle-down rotate-icon"></i>
                        </h4>
                    </a>
                </div>
                <!-- Card body -->
                <div id="collapseOne3" class="collapse" role="tabpanel" aria-labelledby="headingOne3" data-parent="#accordionMethod">
                    <div class="white-text">
                        <ol>
                            <li>For the sake of producing rapid value, try to start with the most understood parts of the process</li>
                            <li>Involve those who best understand the process, which is usually those performing the work itself</li>
                            <li>Focus on the work itself, not the individuals contributing to the work</li>
                            <li>Each workshop should be long enough to involve in-depth discussion, but short enough to avoid fatigue. Typically this means each workshop is 2-4 hours in length.</li>
                            <li>Operational waste can come in different forms e.g. idling, quality control issues and discarded work.</li>
                            <li>The Value Stream Map itself will evolve significantly over time, so whiteboards and post-it notes are highly recommended.</li>
                        </ol>
                    </div>
                </div>

            </div>
        </div>
        <!-- Accordion card -->
        <!-- Accordion card -->
        <div class="accordion md-accordion" id="accordionInsights" role="tablist" aria-multiselectable="true">
            <div>
                <!-- Card header -->
                <div class="header" role="tab" id="headingOne4">
                    <a class="collapsed" data-toggle="collapse" data-parent="#accordionInsights" href="#collapseOne4" aria-expanded="false" aria-controls="collapseOne4">
                        <h4 class="my-4 amber-text">
                            Insights <i class="fas fa-angle-down rotate-icon"></i>
                        </h4>
                    </a>
                </div>
                <!-- Card body -->
                <div id="collapseOne4" class="collapse" role="tabpanel" aria-labelledby="headingOne4" data-parent="#accordionInsights">
                    <div class="white-text">
                        <p>After recovering some existing Value Stream Maps created by other parties and repurposing them using the above method. I sat down with some process SMEs and A/B tested the two different outputs, with the following observations:</p>
                        <ul>
                            <li>Without instructing the user on how to interpret the 'new' visualisation method, most were able to quickly identify where the largest process bottlenecks were.</li>
                            <li>Conversely, when presented with the 'old' visualisation method that contained the same information, it took significantly longer to identify the same level of insights.</li>
                            <li>The SMEs held much more engagement with the new method, spending significantly more time evaluating the detail of each process step compared to the old method.</li>
                            <li>The majority of participants wanted to showcase the new VSM to their stakeholders as they also believed it would be a much more engaging conversation piece.</li>
                        </ul>
                    </div>
                </div>

            </div>
        </div>
        <!-- Accordion card -->
        <!-- Accordion card -->
        <div class="accordion md-accordion" id="accordionConclusion" role="tablist" aria-multiselectable="true">
            <div>
                <!-- Card header -->
                <div class="header" role="tab" id="headingOne5">
                    <a class="collapsed" data-toggle="collapse" data-parent="#accordionConclusion" href="#collapseOne5" aria-expanded="false" aria-controls="collapseOne5">
                        <h4 class="my-4 amber-text">
                            Conclusion <i class="fas fa-angle-down rotate-icon"></i>
                        </h4>
                    </a>
                </div>
                <!-- Card body -->
                <div id="collapseOne5" class="collapse" role="tabpanel" aria-labelledby="headingOne5" data-parent="#accordionConclusion">
                    <div class="white-text">
                        <p>By taking the key lean principle of 'flow' and extending it to be a metaphor for how work is transformed into customer value in an interactive way, it has become easier to understand and identify opportunities to either remove waste, or otherwise optimise customer-driven processes.</p>
                    </div>
                </div>
            </div>
        </div>
        <!-- Accordion card -->
        <div class="row">
            <div class="col white-text">
                <p>If you'd like to know how this visualisation could be implemented in your organisation, feel free to <a href="/contact/" class="amber-text">contact me!</a></p>
            </div>
        </div>
    </div>

    <script>
        $(function() {
            $(this).bind("contextmenu", function(n) {
                n.preventDefault()
            })
        });
    </script>
    <script>
    var dataset={nodes:[{name:"Customer Requests",order:0,colorOrder:0,commentary:"We are inundated with customer requests, which is fantastic, but we never have the capacity to address them. Unfortunately the vast majority are thrown out before we have a chance to evaluate them."},{name:"Executive Requests",order:1,colorOrder:1,commentary:"Our senior leadership team collectively have decades of industry experience and knowledge, as such their ideas usually take priority and are evaluated accordingly."},{name:"Annual SteerCo Planning",order:2,colorOrder:2,commentary:"Our annual business strategy sessions are very labour-intensive, with months of preparation required from key stakeholders to ensure the agenda is followed. If we don't get this perfect every time this can have a major impact on everything downstream."},{name:"Expedited Requests",order:3,colorOrder:3,commentary:"We have reserved capacity for high-priority requests from our senior leadership team when the time arises. This can be due to regulatory changes, significant market shifts or other 'pet projects'."},{name:"BAU Helpdesk Requests",order:5,colorOrder:5,commentary:"We pride ourselves on our customer service, but the tools we have in place to triage issues are very primative. More often than not we have to request additional information from our customers which can lead to friction."},{name:"Quarterly Product Increment (PI) Planning",order:4,colorOrder:4,commentary:"Similar to our SteerCo planning, our quarterly tribe PI planning has a lot of overhead attached to the event. We are still finding our feet with regards to getting good outcomes but ideally we want to shift to continuous planning."},{name:"External Vendor Build",order:6,colorOrder:9,commentary:"One of our key features was hastily built using a whitelabel product from a third party vendor, and as such they are contracted to employ quality checks on any changes made to this space. We don't use the same tools so we have little insight as to their day-to-day progress."},{name:"Component Squad #1 Build",order:7,colorOrder:6,commentary:"This squad is responsible for maintaining the CMS features on our platform, of which there are several. Our CMS was built using a whitelabel product from a third party vendor and as such this team is unable to prepare their releases without constant delays."},{name:"Component Squad #2 Build",order:8,colorOrder:7,commentary:"This squad is arguably the most mature with their agile ways of working. They have a clear runway to deploy new features and are fantastic at breaking down their work. We wish to emulate their practices elsewhere."},{name:"Component Squad #3 Build",order:9,colorOrder:8,commentary:"When this team first started they were the highest performing, so we gave them additional responsibilities. Since then the team has lost some original members and as such they have slipped to the back of the pack. They rarely deliver on time due to constant rework on their features."},{name:"Integration & Staging",order:10,colorOrder:10,commentary:"Unfortunately our biggest bottleneck is our release process, which is on a monthly basis. Some of our teams would be capable of deploying new features faster if they had their own runway but we are held back by legacy architecture principles."},{name:"Feature Release",order:11,colorOrder:11,commentary:"Once our features have been released we have no methods in place to measure their success outside of tracking monthly revenue. We feel like this is a huge missed opportunity to close the feedback loop and learn more about our customers."}],links:[{source:0,target:2,value:6,leadTime:1e6,size:13,throughput:.05,defectRate:.05,discardRate:.8,leadtimeText:"500 bus. days",wipText:"300 Requests",throughputText:"20 Initiatives / Year",workItemInput:"Requests",workItemOutput:"Initiatives"},{source:1,target:2,value:3,leadTime:1e6,size:13,throughput:.02,defectRate:.1,discardRate:.2,leadtimeText:"150 bus. days",wipText:"100 Requests",throughputText:"5 Initiatives / Quarter",workItemInput:"Requests",workItemOutput:"Initiatives"},{source:1,target:3,value:2,leadTime:.5,size:13,throughput:.01,defectRate:.05,discardRate:.01,leadtimeText:"20 bus. days",wipText:"2 Requests",throughputText:"1 Initiative / Quarter",workItemInput:"Requests",workItemOutput:"Initiatives"},{source:2,target:5,value:9,leadTime:1e6,size:8,throughput:.03,defectRate:.1,discardRate:.1,leadtimeText:"60 bus. days",wipText:"6 Initiatives",throughputText:"3 Features / Quarter",workItemInput:"Initiatives",workItemOutput:"Features"},{source:5,target:7,value:3,leadTime:1e3,size:5,throughput:.01,defectRate:.1,discardRate:.1,leadtimeText:"5 bus. days",wipText:"5 Features",throughputText:"20 Epics / Quarter",workItemInput:"Features",workItemOutput:"Epics"},{source:7,target:6,value:3,leadTime:1e3,size:3,throughput:.03,defectRate:.2,discardRate:.2,leadtimeText:"20 bus. days",wipText:"2 Epics",throughputText:"25 User Stories / Month",workItemInput:"Epics",workItemOutput:"User Stories"},{source:5,target:8,value:3,leadTime:1e3,size:5,throughput:.01,defectRate:.2,discardRate:.2,leadtimeText:"7 bus. days",wipText:"3 Features",throughputText:"0.5 Epics / Day",workItemInput:"Features",workItemOutput:"Epics"},{source:5,target:9,value:3,leadTime:1e3,size:5,throughput:.01,defectRate:.05,discardRate:.2,leadtimeText:"5 bus. days",wipText:"4 Features",throughputText:"4 Epics / Day",workItemInput:"Features",workItemOutput:"Epics"},{source:4,target:9,value:2,leadTime:1e3,size:3,throughput:.03,defectRate:.5,discardRate:.6,leadtimeText:"700 bus. days",wipText:"300 Requests",throughputText:"8 User Stories / Month",workItemInput:"Requests",workItemOutput:"User Stories"},{source:3,target:9,value:2,leadTime:.5,size:8,throughput:.01,defectRate:.05,discardRate:.01,leadtimeText:"10 bus. days",wipText:"4 Initiatives",throughputText:"15 Epics / Month",workItemInput:"Initiatives",workItemOutput:"Epics"},{source:6,target:10,value:3,leadTime:1e4,size:3,throughput:.005,defectRate:.4,discardRate:.5,leadtimeText:"30 bus. days",wipText:"60 User Stories",throughputText:"15 User Stories / Month",workItemInput:"User Stories",workItemOutput:"Features"},{source:8,target:10,value:3,leadTime:1e3,size:3,throughput:.03,defectRate:.05,discardRate:.2,leadtimeText:"5 bus. days",wipText:"2 Epics",throughputText:"40 User Stories / Month",workItemInput:"Epics",workItemOutput:"User Stories"},{source:9,target:10,value:7,leadTime:1e6,size:3,throughput:.1,defectRate:.7,discardRate:.2,leadtimeText:"30 bus. days",wipText:"20 Epics",throughputText:"15 User Stories / Month",workItemInput:"Epics",workItemOutput:"User Stories"},{source:10,target:11,value:13,leadTime:1e4,size:13,throughput:.003,defectRate:.3,discardRate:.1,leadtimeText:"20 bus. days",wipText:"80 User Stories",throughputText:"1 Releases / Month",workItemInput:"User Stories",workItemOutput:"Releases"}]};const formatNumber=d3.format(",.0f"),format=e=>`${formatNumber(e)} Days`,color=d3.scaleSequential().interpolator(d3.interpolateCool).domain([0,dataset.nodes.length-1]);var widthFactor,heightFactor;/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)||/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.platform)?(widthFactor=5,heightFactor=1.2):(widthFactor=2,heightFactor=.8);const margin={top:100,right:30,bottom:20,left:30},width=$("#chart").innerWidth()*widthFactor-margin.left-margin.right-parseFloat($(".container").css("padding-left"))-parseFloat($(".container").css("padding-right")),height=$(window).innerHeight()*heightFactor-margin.top-margin.bottom,canvas=d3.select("#chart").append("canvas").style("position","absolute").style("top",margin.top+"px").style("left",margin.left+"px").attr("width",width).attr("height",height),svg=d3.select("#chart").append("svg").style("position","relative").attr("width",width).attr("height",height).style("left",0).style("top",0),sankey=d3.sankey().nodeWidth(15).nodePadding(80).nodeAlign(d3.sankeyCenter).nodeSort((e,t)=>e.order-t.order).iterations(1e3).size([width-margin.left-margin.right,height-margin.top-margin.bottom]);var graph=sankey(dataset);const link=svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")").selectAll("path").data(dataset.links).enter().append("path").attr("class","link").attr("d",d3.sankeyLinkHorizontal()).style("stroke-width",e=>Math.max(1,e.width)).on("mouseover",function(){return tooltip.style("visibility","visible")}).on("mousemove",function(e,t){var r,a;r=e.defectRate>.4?"red":"white",a=e.discardRate>.2?"red":"white";var o=d3.mouse(root.node());scr.x=window.scrollX,scr.y=window.scrollY,o[0]+=svgpos.x,o[1]+=svgpos.y,tooltip.style("right",""),tooltip.style("left",""),tooltip.style("bottom",""),tooltip.style("top",""),tooltip.html("<h5>From <span style='color:"+e.source.color+";'>"+e.source.name+"</span> to <br><span style='color:"+e.target.color+";'>"+e.target.name+"</h5><hr>From <span style='color:"+e.source.color+";'>"+e.workItemInput+"</span> to <span style='color:"+e.target.color+";'>"+e.workItemOutput+"</span><hr>WIP: "+e.wipText+"<br>Lead Time: "+e.leadtimeText+"<br>Throughput: "+e.throughputText+"<br>Defect Rate: <span style='color:"+r+";'>"+d3.format(".0%")(e.defectRate)+"</span><br>Discard Rate: <span style='color:"+a+";'>"+d3.format(".0%")(e.discardRate)+"</span><br>"),o[0]>scr.x+scr.w/2?tooltip.style("right",body.w-o[0]+dist.x+margin.right+"px"):tooltip.style("left",o[0]+dist.x+margin.left-chart.left+"px"),o[1]>scr.y+scr.h/2?tooltip.style("bottom",body.h-o[1]+dist.y+header.height+navbar.height+"px"):tooltip.style("top",o[1]+dist.y-header.height-navbar.height+"px"),tooltip.style("visibility","visible")}).on("mouseout",function(){return tooltip.style("visibility","hidden")}),node=svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")").selectAll(".node").data(dataset.nodes).enter().append("g").attr("class","node").attr("transform",e=>`translate(${e.x0},${e.y0})`).call(d3.drag().subject(e=>e).on("start",function(){this.parentNode.appendChild(this)}).on("drag",dragmove)).on("mouseover",function(){return tooltip.style("visibility","visible")}).on("mousemove",function(e,t){var r,a;r=e.targetLinks.length>2?"red":"white",a=e.sourceLinks.length>2?"red":"white";var o=d3.mouse(root.node());scr.x=window.scrollX,scr.y=window.scrollY,o[0]+=svgpos.x,o[1]+=svgpos.y,tooltip.style("right",""),tooltip.style("left",""),tooltip.style("bottom",""),tooltip.style("top",""),tooltip.html("<h5><span style='color:"+e.color+";'>"+e.name+"</span></h5><hr>Stream Inputs: <span style='color:"+r+";'>"+e.targetLinks.length+"</span><br>Stream Outputs: <span style='color:"+a+";'>"+e.sourceLinks.length+"</span><hr><i>"+e.commentary+"</i>"),o[0]>scr.x+scr.w/2?tooltip.style("right",body.w-o[0]+dist.x+margin.right+"px"):tooltip.style("left",o[0]+dist.x+margin.left-chart.left+"px"),o[1]>scr.y+scr.h/2?tooltip.style("bottom",body.h-o[1]+dist.y+header.height+navbar.height+"px"):tooltip.style("top",o[1]+dist.y-header.height-navbar.height+"px"),tooltip.style("visibility","visible")}).on("mouseout",function(){return tooltip.style("visibility","hidden")});link.attr("d",d3.sankeyLinkHorizontal()),sankey.update(graph),node.append("rect").attr("height",e=>e.y1-e.y0).attr("width",e=>e.x1-e.x0).style("fill",(e,t)=>(e.color=color(e.colorOrder),e.color)).style("stroke","none").append("text").text(e=>`${e.name}\n${format(e.value)}`),node.append("text").attr("x",0).attr("dy","-.35em").attr("text-anchor","middle").attr("transform",null).text(e=>e.name).style("fill",e=>color(e.colorOrder)).style("text-background",(e,t)=>(e.color=color(e.colorOrder),e.color)).text(e=>e.name).call(wrap,10);var tooltip=d3.select("#chart").append("div").attr("id","tooltip").style("position","absolute").style("visibility","hidden");function dragmove(e){var t=d3.select(this).select("rect").attr("y"),r=d3.select(this).select("rect").attr("x");e.x0=e.x0+d3.event.dx,e.x1=e.x1+d3.event.dx,e.y0=e.y0+d3.event.dy,e.y1=e.y1+d3.event.dy;var a=e.y0-t,o=e.x0-r;d3.select(this).attr("transform","translate("+o+","+a+")"),link.attr("d",d3.sankeyLinkHorizontal()),sankey.update(graph)}var root=d3.select("svg"),scr={x:window.scrollX,y:window.scrollY,w:window.innerWidth,h:window.innerHeight},body_sel=d3.select("#chart"),body={w:body_sel.node().offsetWidth,h:body_sel.node().offsetHeight},doc={w:document.width,h:document.height},svgpos=getNodePos(root.node()),dist={x:10,y:10},header=d3.select("#header").node().getBoundingClientRect(),navbar=d3.select("#navbar").node().getBoundingClientRect(),chart=$("#chart").position();const particleSize=d3.scaleLinear().domain(d3.extent(dataset.links,e=>e.size)).range([5,20]);dataset.links.forEach(e=>{e.particleSize=e.size,e.particleColor=d3.scaleLinear().domain([0,1]).range([e.source.color,e.target.color]),e.defectAlpha=d3.scaleLinear().domain([0,1]).range([1,0])});const t=d3.timer(tick,1e3);let particles=[];function tick(e,t){particles=particles.filter(e=>e.current<e.path.getTotalLength()),d3.selectAll("path.link").each(function(t){for(let r=0;r<2;r+=1){const r=(Math.random()-.5)*(t.width-2*t.size),a=Math.random()<=t.defectRate?1:0,o=Math.random()<=t.discardRate?1:0;Math.random()<t.throughput&&particles.push({link:t,time:e,offset:r,path:this,defect:a,discard:o,speed:1/t.leadTime+Math.random()})}}),particleEdgeCanvasPath(e)}function particleEdgeCanvasPath(e){const t=d3.select("canvas").node().getContext("2d");t.clearRect(0,0,width,height),t.fillStyle="gray",t.lineWidth="1px";for(const a in particles)if({}.hasOwnProperty.call(particles,a)){const o=e-particles[a].time;particles[a].current=.15*o*particles[a].speed;var r=particles[a].path.getPointAtLength(particles[a].current);t.beginPath(),1==particles[a].defect?(t.fillStyle="red",t.globalAlpha=1,r=particles[a].path.getPointAtLength(particles[a].path.getTotalLength()-particles[a].current)):(t.fillStyle=particles[a].link.particleColor(particles[a].current/particles[a].path.getTotalLength()),1==particles[a].discard?particles[a].current>.74*particles[a].path.getTotalLength()?t.globalAlpha=0:t.globalAlpha=particles[a].link.defectAlpha(particles[a].current/(.75*particles[a].path.getTotalLength())):t.globalAlpha=1),t.arc(r.x+particles[a].link.particleSize,r.y+particles[a].offset,particles[a].link.particleSize,0,2*Math.PI),t.fill()}}function piecewise(e,t){for(var r=0,a=t.length-1,o=t[0],i=new Array(a<0?0:a);r<a;)i[r]=e(o,o=t[++r]);return function(e){var t=Math.max(0,Math.min(a-1,Math.floor(e*=a)));return i[t](e-t)}}function wrap(e,t){e.each(function(){for(var e,r=d3.select(this),a=r.text().split(/\s+/).reverse(),o=a.length,i=[],s=0,n=r.attr("x"),l=r.attr("y"),d=r.text(null).append("tspan").attr("x",n).attr("y",l).attr("dy","0em");e=a.pop();)s++,i.push(e),d.text(i.join(" ")),d.node().getComputedTextLength()>t&&(i.pop(),d.text(i.join(" ")),i=[e],d=r.append("tspan").attr("class",s).attr("x",0).attr("y",e=>1==s?1.2*-o-.35+"em":l).attr("dx",sankey.nodeWidth()/2).attr("dy","1.2em").text(e))})}function getNodePos(e){for(var t=d3.select("body").node(),r=0,a=0;null!=e&&e!=t;r+=e.offsetLeft||e.clientLeft,a+=e.offsetTop||e.clientTop,e=e.offsetParent||e.parentNode);return{x:r,y:a}}
    </script>
</body>
