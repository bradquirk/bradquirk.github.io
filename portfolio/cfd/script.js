d3.csv("data.csv",function(t,e){if(t)throw t;var a=d3.utcParse("%Y-%m-%dT%H:%M:%S"),r=d3.timeFormat("%Y-%m-%d"),o=d3.format(".2p"),n=d3.timeParse("%Y-%m-%d"),s=r(a(0));e.forEach(t=>{t.historyDate=r(a(t["History End"])),t.key=t.Key,t.historyKey=t.key+t["History End"],t.ToDoIn=parseFloat(t["To Do In"]),t.ToDoOut=parseFloat(t["To Do Out"]),t.InProgressIn=parseFloat(t["In Progress In"]),t.InProgressOut=parseFloat(t["In Progress Out"]),t.DoneIn=parseFloat(t["Done In"]),t.DoneOut=parseFloat(t["Done Out"])});var d=d3.nest().key(t=>t.historyDate).sortKeys(d3.ascending).key(t=>t.historyKey).rollup(t=>({ToDoIn:d3.max(t,t=>t.ToDoIn),ToDoOut:d3.max(t,t=>t.ToDoOut),InProgressIn:d3.max(t,t=>t.InProgressIn),InProgressOut:d3.max(t,t=>t.InProgressOut),DoneIn:d3.max(t,t=>t.DoneIn),DoneOut:d3.max(t,t=>t.DoneOut)})).entries(e);d[0].key==s&&d.shift();var l=d3.nest().key(t=>t.key).rollup(t=>({ToDoIn:d3.sum(t[0].values,t=>t.value.ToDoIn),ToDoOut:d3.sum(t[0].values,t=>t.value.ToDoOut),InProgressIn:d3.sum(t[0].values,t=>t.value.InProgressIn),InProgressOut:d3.sum(t[0].values,t=>t.value.InProgressOut),DoneIn:d3.sum(t[0].values,t=>t.value.DoneIn),DoneOut:d3.sum(t[0].values,t=>t.value.DoneOut)})).entries(d),c=0,y=0,g=0;l.forEach((t,e)=>{c+=l[e].value.ToDoIn-l[e].value.ToDoOut,y+=l[e].value.InProgressIn-l[e].value.InProgressOut,g+=l[e].value.DoneIn-l[e].value.DoneOut,t.key=n(t.key),t.toDo=c,t.inProgress=y,t.done=g,delete t.value});var p=0;l.forEach((t,e)=>{p=t.toDo+t.inProgress+t.done,t.toDoPercentage=t.toDo/p,t.inProgressPercentage=t.inProgress/p,t.donePercentage=t.done/p});d3.bisector(t=>t.key).right;var x={top:20,right:50,bottom:40,left:50},u=d3.select("#volumeChart").node().getBoundingClientRect().width-x.left-x.right,m=.3*$(window).innerHeight();textHeightOffset=.125*$("p").height();var P=d3.select("#volumeChart").append("svg").attr("width",u+x.left+x.right).attr("height",m+x.top+x.bottom),h=P.append("g").attr("transform","translate("+x.left+","+x.top+")"),f=P.append("defs"),D=f.append("linearGradient").attr("id","toDoVolumeGradient").attr("x1","0%").attr("x2","100%").attr("y1","0%").attr("y2","0%");D.append("stop").attr("class","toDoStart").attr("offset","0%").attr("stop-opacity",1),D.append("stop").attr("class","toDoEnd").attr("offset","100%").attr("stop-opacity",1);var v=f.append("linearGradient").attr("id","inProgressVolumeGradient").attr("x1","0%").attr("x2","100%").attr("y1","0%").attr("y2","0%");v.append("stop").attr("class","inProgressStart").attr("offset","0%").attr("stop-opacity",1),v.append("stop").attr("class","inProgressEnd").attr("offset","100%").attr("stop-opacity",1);var T=f.append("linearGradient").attr("id","doneVolumeGradient").attr("x1","0%").attr("x2","100%").attr("y1","0%").attr("y2","0%");T.append("stop").attr("class","doneStart").attr("offset","0%").attr("stop-opacity",1),T.append("stop").attr("class","doneEnd").attr("offset","100%").attr("stop-opacity",1);var B=d3.scaleTime().rangeRound([0,u]),I=d3.scaleLinear().rangeRound([m,0]),k=d3.area().x(t=>B(t.key)).y0(t=>I(t.inProgress+t.done)).y1(t=>I(t.toDo+t.inProgress+t.done)),V=d3.area().x(t=>B(t.key)).y0(t=>I(t.done)).y1(t=>I(t.inProgress+t.done)),w=d3.area().x(t=>B(t.key)).y0(m).y1(t=>I(t.done)),O=d3.line().x(t=>B(t.key)).y(t=>I(t.toDo+t.inProgress+t.done)),L=d3.line().x(t=>B(t.key)).y(t=>I(t.inProgress+t.done)),b=d3.line().x(t=>B(t.key)).y(t=>I(t.done));h.append("path").attr("id","toDo").style("fill","url(#toDoVolumeGradient)"),h.append("path").attr("id","inProgress").style("fill","url(#inProgressVolumeGradient)"),h.append("path").attr("id","done").style("fill","url(#doneVolumeGradient)"),h.append("g").attr("id","x").attr("class","axis").attr("transform","translate(0,"+m+")"),h.append("g").attr("id","y").attr("class","axis").append("text").attr("fill","#FFF").attr("transform","rotate(-90)").attr("y",6).attr("dy","0.71em").attr("text-anchor","end").text("No. of Work Items");var F=h.append("path").attr("id","toDoVolumeLine").attr("class","mouseLine"),G=h.append("path").attr("id","inProgressVolumeLine").attr("class","mouseLine"),A=h.append("path").attr("id","doneVolumeLine").attr("class","mouseLine"),R=d3.select("#percentageChart").append("svg").attr("width",u+x.left+x.right).attr("height",m+x.top+x.bottom),E=R.append("g").attr("transform","translate("+x.left+","+x.top+")"),H=R.append("defs"),S=H.append("linearGradient").attr("id","toDoPercentageGradient").attr("x1","0%").attr("x2","100%").attr("y1","0%").attr("y2","0%");S.append("stop").attr("class","toDoStart").attr("offset","0%").attr("stop-opacity",1),S.append("stop").attr("class","toDoEnd").attr("offset","100%").attr("stop-opacity",1);var K=H.append("linearGradient").attr("id","inProgressPercentageGradient").attr("x1","0%").attr("x2","100%").attr("y1","0%").attr("y2","0%");K.append("stop").attr("class","inProgressStart").attr("offset","0%").attr("stop-opacity",1),K.append("stop").attr("class","inProgressEnd").attr("offset","100%").attr("stop-opacity",1);var C=H.append("linearGradient").attr("id","donePercentageGradient").attr("x1","0%").attr("x2","100%").attr("y1","0%").attr("y2","0%");C.append("stop").attr("class","doneStart").attr("offset","0%").attr("stop-opacity",1),C.append("stop").attr("class","doneEnd").attr("offset","100%").attr("stop-opacity",1);var Y=d3.scaleTime().rangeRound([0,u]),M=d3.scaleLinear().rangeRound([m,0]),N=d3.area().x(t=>Y(t.key)).y0(t=>M(t.inProgressPercentage+t.donePercentage)).y1(t=>M(t.toDoPercentage+t.inProgressPercentage+t.donePercentage)),W=d3.area().x(t=>Y(t.key)).y0(t=>M(t.donePercentage)).y1(t=>M(t.inProgressPercentage+t.donePercentage)),j=d3.area().x(t=>Y(t.key)).y0(m).y1(t=>M(t.donePercentage)),X=d3.line().x(t=>Y(t.key)).y(t=>M(t.toDoPercentage+t.inProgressPercentage+t.donePercentage)),q=d3.line().x(t=>Y(t.key)).y(t=>M(t.inProgressPercentage+t.donePercentage)),z=d3.line().x(t=>Y(t.key)).y(t=>M(t.donePercentage));Y.domain(d3.extent(l,t=>t.key)),M.domain([0,1]),E.append("path").attr("id","toDo").attr("class","area").style("fill","url(#toDoPercentageGradient)"),E.append("path").attr("id","inProgress").attr("class","area").style("fill","url(#inProgressPercentageGradient)"),E.append("path").attr("id","done").attr("class","area").style("fill","url(#donePercentageGradient)"),E.append("g").attr("id","x").attr("class","axis").attr("transform","translate(0,"+m+")"),E.append("g").attr("id","y").attr("class","axis").append("text").attr("fill","#FFF").attr("transform","rotate(-90)").attr("y",6).attr("dy","0.71em").attr("text-anchor","end").text("% of Work Items");var J=E.append("path").attr("id","toDoPercentageLine").attr("class","mouseLine"),Q=E.append("path").attr("id","inProgressPercentageLine").attr("class","mouseLine"),U=E.append("path").attr("id","donePercentageLine").attr("class","mouseLine");lt("All");var Z=P.append("g").attr("class","mouse-over-effects").attr("transform","translate("+x.left+","+x.top+")"),_=Z.append("line").attr("class","mouse-line").style("stroke-width","1px").style("opacity","0"),tt=Z.selectAll("circle").data(["toDoVolume","inProgressVolume","doneVolume"]).enter().append("circle").attr("id",t=>t).attr("r",7).style("stroke-width","1px").style("opacity","0"),et=Z.selectAll("rect").data(["toDoVolume","inProgressVolume","doneVolume","dateVolume"]).enter().append("rect").attr("id",t=>t+"Rect").attr("class","rectBackground"),at=Z.selectAll("text").data(["toDoVolume","inProgressVolume","doneVolume","dateVolume"]).enter().append("text").attr("id",t=>t+"Text").style("fill","white"),rt=R.append("g").attr("class","mouse-over-effects").attr("transform","translate("+x.left+","+x.top+")"),ot=rt.append("line").attr("class","mouse-line").style("stroke-width","1px").style("opacity","0"),nt=rt.selectAll("circle").data(["toDoPercentage","inProgressPercentage","donePercentage"]).enter().append("circle").attr("id",t=>t).attr("r",7).style("stroke-width","1px").style("opacity","0"),st=rt.selectAll("rect").data(["toDoPercentage","inProgressPercentage","donePercentage","datePercentage"]).enter().append("rect").attr("id",t=>t+"Rect").attr("class","rectBackground"),dt=rt.selectAll("text").data(["toDoPercentage","inProgressPercentage","donePercentage","datePercentage"]).enter().append("text").attr("id",t=>t+"Text").style("fill","white");function lt(t){if("All"!=t)var a=e.filter(e=>e.projectName==t);else a=e;return(d=d3.nest().key(t=>t.historyDate).sortKeys(d3.ascending).key(t=>t.historyKey).rollup(t=>({ToDoIn:d3.max(t,t=>t.ToDoIn),ToDoOut:d3.max(t,t=>t.ToDoOut),InProgressIn:d3.max(t,t=>t.InProgressIn),InProgressOut:d3.max(t,t=>t.InProgressOut),DoneIn:d3.max(t,t=>t.DoneIn),DoneOut:d3.max(t,t=>t.DoneOut)})).entries(a))[0].key==s&&d.shift(),l=d3.nest().key(t=>t.key).rollup(t=>({ToDoIn:d3.sum(t[0].values,t=>t.value.ToDoIn),ToDoOut:d3.sum(t[0].values,t=>t.value.ToDoOut),InProgressIn:d3.sum(t[0].values,t=>t.value.InProgressIn),InProgressOut:d3.sum(t[0].values,t=>t.value.InProgressOut),DoneIn:d3.sum(t[0].values,t=>t.value.DoneIn),DoneOut:d3.sum(t[0].values,t=>t.value.DoneOut)})).entries(d),c=0,y=0,g=0,l.forEach((t,e)=>{c+=l[e].value.ToDoIn-l[e].value.ToDoOut,y+=l[e].value.InProgressIn-l[e].value.InProgressOut,g+=l[e].value.DoneIn-l[e].value.DoneOut,t.key=n(t.key),t.toDo=c,t.inProgress=y,t.done=g,delete t.value}),p=0,l.forEach((t,e)=>{p=t.toDo+t.inProgress+t.done,t.toDoPercentage=t.toDo/p,t.inProgressPercentage=t.inProgress/p,t.donePercentage=t.done/p}),B.domain(d3.extent(l,t=>t.key)),I.domain([0,d3.max(l,t=>t.toDo+t.inProgress+t.done)]),h.select("#toDo").datum(l).attr("d",k),h.select("#inProgress").datum(l).attr("d",V),h.select("#done").datum(l).attr("d",w),h.select("#x").call(d3.axisBottom(B).tickFormat(d3.timeFormat("%b %y"))),h.select("#y").call(d3.axisLeft(I)),F.datum(l).attr("d",O),G.datum(l).attr("d",L),A.datum(l).attr("d",b),Y.domain(d3.extent(l,t=>t.key)),M.domain([0,1]),E.select("#toDo").datum(l).attr("d",N),E.select("#inProgress").datum(l).attr("d",W),E.select("#done").datum(l).attr("d",j),E.select("#x").call(d3.axisBottom(Y)),E.select("#y").call(d3.axisLeft(M).tickFormat(d3.format(".0%"))),J.datum(l).attr("d",X),Q.datum(l).attr("d",q),U.datum(l).attr("d",z),l}function it(t,e){var a=document.getElementById("volumeChart").offsetLeft+14,r=F.node(),n=r.getTotalLength(),s=G.node(),d=s.getTotalLength(),l=A.node(),c=l.getTotalLength(),y=J.node(),g=y.getTotalLength(),p=Q.node(),u=p.getTotalLength(),P=U.node(),h=P.getTotalLength(),f=d3.bisector(t=>t.key).right,D=Math.max(d3.select("text#doneVolumeText").node().getBBox().width,d3.select("text#inProgressVolumeText").node().getBBox().width,d3.select("text#toDoVolumeText").node().getBBox().width,d3.select("text#donePercentageText").node().getBBox().width,d3.select("text#inProgressPercentageText").node().getBBox().width,d3.select("text#toDoPercentageText").node().getBBox().width);_.attr("x1",t[0]).attr("x2",t[0]).attr("y1",m).attr("y2",0),ot.attr("x1",t[0]).attr("x2",t[0]).attr("y1",m).attr("y2",0);var v=d3.event.pageX-a-x.left,T=e[f(e,B.invert(v))];for(d3.select("text#dateVolumeText").style("opacity",1).attr("x",v).attr("y",m+x.bottom/2).attr("text-anchor","middle").text(d3.timeFormat("%d-%b-%y")(T.key)),d3.select("rect#dateVolumeRect").style("opacity",1).attr("x",v).attr("y",m+x.bottom/2).attr("width",d3.select("text#dateVolumeText").node().getBBox().width+0).attr("height",d3.select("text#dateVolumeText").node().getBBox().height+0).attr("transform","translate("+-d3.select("text#dateVolumeText").node().getBBox().width/2+","+-18+")"),i=v;i<c;i+=1){if((M=l.getPointAtLength(i)).x>=v)break}if(c-M.x-D<45)var I=-15-d3.select("text#toDoVolumeText").node().getBBox().width,k=-15-d3.select("text#inProgressVolumeText").node().getBBox().width,V=-15-d3.select("text#doneVolumeText").node().getBBox().width,w=-15-d3.select("text#toDoPercentageText").node().getBBox().width,O=-15-d3.select("text#inProgressPercentageText").node().getBBox().width,L=-15-d3.select("text#donePercentageText").node().getBBox().width;else I=10,k=10,V=10,w=10,O=10,L=10;var b=M.y;for(d3.select("circle#doneVolume").style("opacity",1).attr("cx",v).attr("cy",M.y),d3.select("text#doneVolumeText").style("opacity",1).attr("x",v).attr("y",M.y).attr("dx",V).attr("dy",textHeightOffset).text("Done: "+T.done),d3.select("rect#doneVolumeRect").style("opacity",1).attr("x",v).attr("y",M.y).attr("width",d3.select("text#doneVolumeText").node().getBBox().width+0).attr("height",d3.select("text#doneVolumeText").node().getBBox().height+0).attr("transform","translate("+V+",-12.5)"),i=v;i<d;i+=1){if((M=s.getPointAtLength(i)).x>=v)break}var R=M.y;if(b-R<20)var E=-20+b-R;else E=0;for(d3.select("circle#inProgressVolume").style("opacity",1).attr("cx",v).attr("cy",M.y),d3.select("text#inProgressVolumeText").style("opacity",1).attr("x",v).attr("y",M.y).attr("dx",k).attr("dy",E+textHeightOffset).text("In Progress: "+T.inProgress),d3.select("rect#inProgressVolumeRect").style("opacity",1).attr("x",v).attr("y",M.y).attr("width",d3.select("text#inProgressVolumeText").node().getBBox().width+0).attr("height",d3.select("text#inProgressVolumeText").node().getBBox().height+0).attr("transform","translate("+k+","+(-12.5+E)+")"),i=v;i<n;i+=1){if((M=r.getPointAtLength(i)).x>=v)break}var H=M.y;if(R+E-H<20)var S=-20+R+E-H;else S=0;for(d3.select("circle#toDoVolume").style("opacity",1).attr("cx",v).attr("cy",M.y),d3.select("text#toDoVolumeText").style("opacity",1).attr("x",v).attr("y",M.y).attr("dx",I).attr("dy",S+textHeightOffset).text("To Do: "+T.toDo),d3.select("rect#toDoVolumeRect").style("opacity",1).attr("x",v).attr("y",M.y).attr("width",d3.select("text#toDoVolumeText").node().getBBox().width+0).attr("height",d3.select("text#toDoVolumeText").node().getBBox().height+0).attr("transform","translate("+I+","+(-12.5+S)+")"),i=v;i<g;i+=1){if((M=y.getPointAtLength(i)).x>=v)break}var K=M.y;for(d3.select("circle#toDoPercentage").style("opacity",1).attr("cx",v).attr("cy",M.y),d3.select("text#toDoPercentageText").style("opacity",1).attr("x",v).attr("y",M.y).attr("dx",w).attr("dy",textHeightOffset).text("To Do %: "+o(T.toDoPercentage)),d3.select("rect#toDoPercentageRect").style("opacity",1).attr("x",v).attr("y",M.y).attr("width",d3.select("text#toDoPercentageText").node().getBBox().width+0).attr("height",d3.select("text#toDoPercentageText").node().getBBox().height+0).attr("transform","translate("+w+","+-12.5+")"),d3.select("text#datePercentageText").style("opacity",1).attr("x",v).attr("y",m+x.bottom/2).attr("text-anchor","middle").text(d3.timeFormat("%d-%b-%y")(T.key)),d3.select("rect#datePercentageRect").style("opacity",1).attr("x",v).attr("y",m+x.bottom/2).attr("width",d3.select("text#datePercentageText").node().getBBox().width+0).attr("height",d3.select("text#datePercentageText").node().getBBox().height+0).attr("transform","translate("+-d3.select("text#datePercentageText").node().getBBox().width/2+",-18)"),i=v;i<u;i+=1){if((M=p.getPointAtLength(i)).x>=v)break}var C=M.y;if(C-K<20)var Y=20+K-C;else Y=0;for(d3.select("circle#inProgressPercentage").style("opacity",1).attr("cx",v).attr("cy",M.y),d3.select("text#inProgressPercentageText").style("opacity",1).attr("x",v).attr("y",M.y).attr("dx",O).attr("dy",Y+textHeightOffset).text("In Progress %: "+o(T.inProgressPercentage)),d3.select("rect#inProgressPercentageRect").style("opacity",1).attr("x",v).attr("y",M.y).attr("width",d3.select("text#inProgressPercentageText").node().getBBox().width+0).attr("height",d3.select("text#inProgressPercentageText").node().getBBox().height+0).attr("transform","translate("+O+","+(-12.5+Y)+")"),i=v;i<h;i+=1){var M;if((M=P.getPointAtLength(i)).x>=v)break}var N=M.y;if(N-C+Y<20)var W=20+C-Y-N;else W=0;d3.select("circle#donePercentage").style("opacity",1).attr("cx",v).attr("cy",M.y),d3.select("text#donePercentageText").style("opacity",1).attr("x",v).attr("y",M.y).attr("dx",L).attr("dy",W+textHeightOffset).text("Done %: "+o(T.donePercentage)),d3.select("rect#donePercentageRect").style("opacity",1).attr("x",v).attr("y",M.y).attr("width",d3.select("text#donePercentageText").node().getBBox().width+0).attr("height",d3.select("text#donePercentageText").node().getBBox().height+0).attr("transform","translate("+L+","+(-12.5+W)+")")}Z.append("rect").attr("width",u).attr("height",m).attr("fill","none").attr("pointer-events","all").on("mouseout",function(){_.style("opacity","0"),ot.style("opacity","0"),tt.style("opacity","0"),nt.style("opacity","0"),et.style("opacity","0"),at.style("opacity","0"),dt.style("opacity","0"),st.style("opacity","0")}).on("mouseover",function(){_.style("opacity","1"),ot.style("opacity","1"),tt.style("opacity","1"),nt.style("opacity","1"),at.style("opacity","1"),dt.style("opacity","1"),st.style("opacity","0.5")}).on("mousemove",function(){it(d3.mouse(this),l)}),rt.append("rect").attr("width",u).attr("height",m).attr("fill","none").attr("pointer-events","all").on("mouseout",function(){_.style("opacity","0"),ot.style("opacity","0"),tt.style("opacity","0"),nt.style("opacity","0"),et.style("opacity","0"),at.style("opacity","0"),dt.style("opacity","0"),st.style("opacity","0")}).on("mouseover",function(){_.style("opacity","1"),ot.style("opacity","1"),tt.style("opacity","1"),nt.style("opacity","1"),et.style("opacity","1"),at.style("opacity","1"),dt.style("opacity","1"),st.style("opacity","0.5")}).on("mousemove",function(){it(d3.mouse(this),l)}),lt("All")});