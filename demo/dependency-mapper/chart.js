var width,rootSVG,rootRingSVG,scr,body_sel,body,svgpos,svgRingpos,dist,chart,header,subHeader,firstVizButton,sectionDepTypes,sectionOptions,sectionChart,delayTimer,serverURL,colourSchemeHeatmap,colourSchemeRing,colourSchemeSankey,totalIssues,dataTable,canvasLine,customFields,sankeyProjects,margin={top:50,right:50,bottom:50,left:50},height=820,issuelinks=[],arcs=d3.arc().startAngle(function(e){return e.value.x0}).endAngle(function(e){return e.value.x1}),buttonWidth=$(".createViz").outerWidth();function loadChart(){d3.selectAll(".tablinks").transition().style("opacity",0).style("pointer-events","none"),d3.selectAll(".loading-buttons").transition().style("opacity",0);var e=d3.select("#chart").select("canvas").node();context=e.getContext("2d"),context.translate(width/2,height/2);var t=d3.selectAll(".loading-text");t.text("Initialising Dependency Extracts"),d3.json("data.json").then(e=>{if(0==e.length)throw"No dependencies identified within the "+totalIssues+" initial issue/s returned by JQL query. Please review JQL Query and Dependency Types";var t=d3.select("#boardChart").node().getBoundingClientRect().width,o=d3.select("#boardChart").node().getBoundingClientRect().height,a=e;a=a.filter(e=>JSON.stringify(e.target)!==JSON.stringify(e.source));var r=[];d3.nest().key(function(e){return e.target}).key(e=>e.targetProj).rollup(function(e){return{total:d3.sum(e,function(e){return e.count})}}).entries(a).forEach(function(e){r.push({id:e.key,summary:a.find(t=>t.target==e.key).targetName,group:e.values[0].key,total:e.values[0].value.total,projectName:a.find(t=>t.targetProj==e.values[0].key).targetProjectName,sprint:a.find(t=>t.target==e.key).targetSprint,fixVersion:a.find(t=>t.target==e.key).targetFixVersion,dueDate:a.find(t=>t.target==e.key).targetDueDate,earliestDate:a.find(t=>t.target==e.key).targetEarliestDate,latestDate:a.find(t=>t.target==e.key).targetLatestDate,earliestBasedOn:a.find(t=>t.target==e.key).targetEarliestBasedOn,latestBasedOn:a.find(t=>t.target==e.key).targetLatestBasedOn,statusCategory:a.find(t=>t.target==e.key).targetStatusCategory})});var l=d3.nest().key(function(e){return e.source}).key(function(e){return e.sourceProj}).rollup(function(e){return{total:d3.sum(e,function(e){return e.count})}}).entries(a),n=0;l.forEach(e=>{-1==r.findIndex(t=>t.id==e.key)?r.push({id:e.key,summary:a.find(t=>t.source==e.key).sourceName,group:e.values[0].key,total:e.values[0].value.total,projectName:a.find(t=>t.sourceProj==e.values[0].key).sourceProjectName,sprint:a.find(t=>t.source==e.key).sourceSprint,fixVersion:a.find(t=>t.source==e.key).sourceFixVersion,dueDate:a.find(t=>t.source==e.key).sourceDueDate,earliestDate:a.find(t=>t.source==e.key).sourceEarliestDate,latestDate:a.find(t=>t.source==e.key).sourceLatestDate,earliestBasedOn:a.find(t=>t.source==e.key).sourceEarliestBasedOn,latestBasedOn:a.find(t=>t.source==e.key).sourceLatestBasedOn,statusCategory:a.find(t=>t.source==e.key).sourceStatusCategory}):(n=r.findIndex(t=>t.id==e.key),r[n].total+=e.values[0].value.total)});const s={nodes:r=r.sort((e,t)=>{var o=e.id.substring(0,e.id.indexOf("-")),a=t.id.substring(0,t.id.indexOf("-")),r=+e.id.substring(e.id.indexOf("-")+1,e.id.length),l=+t.id.substring(t.id.indexOf("-")+1,t.id.length);return o<a?-1:o>a?1:r<l?-1:r>l?1:0}),links:a},i=new Map,c=new Map(r.map(e=>[e.id,e]));for(const e of r){let t=i.get(e.group);t||i.set(e.group,t={name:e.group,children:[]}),t.children.push(e),e.targetIds=[],e.sourceIds=[]}for(const{source:e,target:t}of a)c.get(e).targetIds.push(t),c.get(t).sourceIds.push(e);var d={name:"root",children:[...i.values()]},u=(t+margin.left+margin.right)/2;canvasLine=d3.radialLine().curve(d3.curveBundle.beta(.85)).radius(e=>e.y).angle(e=>e.x).context(context);const g=d3.cluster().size([2*Math.PI,u-102])(d3.hierarchy(d)),h=new Map(g.leaves().map(e=>[e.data.id,e]));dataTable=d3.merge(g.leaves().map(e=>e.data.targetIds.map(t=>e.path(h.get(t)))));var p=d3.nest().key(e=>e.data.group).rollup(e=>({x0:e[0].x,x1:e[e.length-1].x,y0:arcs.innerRadius()(e),y1:arcs.outerRadius()(e),projectName:e[0].data.projectName})).entries(g.leaves());arcs.innerRadius(.9*(u-100)).outerRadius(u-100),colourSchemeRing=d3.scaleSequential().interpolator(d3.interpolateRainbow).domain([0,p.length].reverse());const y=d3.select("#chart").select("svg");fontValue=Math.min(1,Math.PI*Math.pow(s.nodes.length,-.5)),d3.zoom().on("zoom",function zoomed(){m.attr("transform",d3.event.transform+"translate("+t/2+","+o/2+")"),context.save(),context.translate(-t/2,-o/2),context.clearRect(0,0,t,o),context.translate(d3.event.transform.x,d3.event.transform.y),context.scale(d3.event.transform.k,d3.event.transform.k),context.translate(t/2,o/2),dataTable.forEach(e=>{context.beginPath(),canvasLine(e),context.lineWidth=1,$("#checkDarkmode").is(":checked")?context.strokeStyle="#FFFFFF":context.strokeStyle="#2E2E2E",context.stroke()}),context.restore()})(y);var m=y.append("g").attr("transform","translate("+t/2+","+o/2+")"),f=d3.select("#chart").append("div").attr("class","tooltipDemo").style("position","absolute").style("visibility","hidden"),b=m.append("g").attr("id","nodeContainer").selectAll(".node"),x=m.append("g").attr("id","arcContainer").selectAll(".arc");return dataTable.forEach(e=>{e.source=e[0],e.target=e[e.length-1],context.globalAlpha=.2,context.beginPath(),canvasLine(e),context.lineWidth=1,$("#checkDarkmode").is(":checked")?context.strokeStyle="#FFFFFF":context.strokeStyle="#2E2E2E",context.stroke()}),b=b.data(g.leaves()).enter().append("text").attr("class","node").attr("id",e=>e.data.id).attr("transform",e=>`rotate(${180*e.x/Math.PI-90})translate(${e.y},0)${e.x>=Math.PI?"rotate(180)":""}`).attr("dy","0.31em").attr("x",e=>e.x<Math.PI?3:-3).attr("font-size",fontValue+"em").attr("text-anchor",e=>e.x<Math.PI?"start":"end").text(e=>e.data.id).on("mouseover",e=>{f.style("visibility","visible")}).on("mousemove",function(e,t){var o=d3.mouse(rootRingSVG.node());scr.x=window.scrollX,scr.y=window.scrollY,o[0]+=svgRingpos.x,o[1]+=svgRingpos.y,sourceLength=e.data.sourceIds?e.data.sourceIds.length:0,targetLength=e.data.targetIds?e.data.targetIds.length:0,f.style("right",""),f.style("left",""),f.style("bottom",""),f.style("top",""),f.html("<h4 style='color:#FFFFFF'>ID: "+e.data.id+"<br>Summary: "+e.data.summary+"<hr><table><tbody><tr><td>Received Dependencies: </td><td><span style='color:#4CD964'>"+sourceLength+"</span></td></tr><tr><td>Raised Dependencies: </td><td><span style='color:#FF2D55'>"+targetLength+"</span></td></tr></tbody></table><hr>"),o[0]>scr.x+scr.w/2?f.style("right",body.w-o[0]+dist.x-chart.left+parseInt($("#appContainer").css("marginLeft".replace("px","")))+"px"):f.style("left",o[0]+dist.x-chart.left+parseInt($("#appContainer").css("marginLeft".replace("px","")))+"px"),f.style("top",o[1]-dist.y-header.height-f.node().getBoundingClientRect().height-parseInt($("#appContainer").css("marginTop".replace("px","")))+"px"),f.style("visibility","visible")}).on("mouseleave",function(e,t){f.style("visibility","hidden")}),x.data(p).enter().append("path").attr("id",function(e,t){return"arc_"+t}).attr("class","arcs").attr("d",arcs).style("fill",(e,t)=>colourSchemeRing(t)).attr("cursor","pointer").on("mouseover",e=>{f.style("visibility","visible")}).on("mousemove",function(e,t){var o=d3.mouse(rootRingSVG.node());scr.x=window.scrollX,scr.y=window.scrollY,o[0]+=svgRingpos.x,o[1]+=svgRingpos.y,sourceLength=dataTable.filter(t=>e.key==t.target.data.group&&e.key!=t.source.data.group).length,targetLength=dataTable.filter(t=>e.key==t.source.data.group&&e.key!=t.target.data.group).length,internalLength=dataTable.filter(t=>e.key==t.source.data.group&&e.key==t.target.data.group).length,f.style("right",""),f.style("left",""),f.style("bottom",""),f.style("top",""),$("#checkInternal").is(":checked")?f.html("<h4 style='color:#FFFFFF'>ID: "+e.key+"<br>Name: "+e.value.projectName+"<hr><table><tbody><tr><td>Received Dependencies: </td><td><span style='color:#4CD964'>"+sourceLength+"</span></td></tr><tr><td>Raised Dependencies: </td><td><span style='color:#FF2D55'>"+targetLength+"</span></td></tr><tr><td>Internal Dependencies: </td><td><span style='color:#34AADC'>"+internalLength+"</span></td></tr></tbody></table><hr>"):f.html("<h4 style='color:#FFFFFF'>ID: "+e.key+"<br>Name: "+e.value.projectName+"<hr><table><tbody><tr><td>Received Dependencies: </td><td><span style='color:#4CD964'>"+sourceLength+"</span></td></tr><tr><td>Raised Dependencies: </td><td><span style='color:#FF2D55'>"+targetLength+"</span></td></tr></tbody></table>"),o[0]>scr.x+scr.w/2?f.style("right",body.w-o[0]+dist.x-chart.left+parseInt($("#appContainer").css("marginLeft".replace("px","")))+"px"):f.style("left",o[0]+dist.x-chart.left+parseInt($("#appContainer").css("marginLeft".replace("px","")))+"px"),f.style("top",o[1]-dist.y-header.height-f.node().getBoundingClientRect().height-parseInt($("#appContainer").css("marginTop".replace("px","")))+"px"),f.style("visibility","visible")}).on("mouseleave",function(e,t){f.style("visibility","hidden")}).each((e,t)=>{var o=/(^.+?)L/.exec(d3.select("#arc_"+t).attr("d"));o&&(o=getArcPath(o,e,t),m.append("path").attr("class","hiddenDonutArcs").attr("id","donutArc"+t).attr("d",o).style("fill","none"))}),m.append("path").attr("id","dummyPath").attr("d","M 0 0 L 10000 0"),m.append("text").attr("id","dummyText").append("textPath").attr("xlink:href","#dummyPath").text("ABC"),textHeight=d3.select("#dummyText").node().getBBox().height,d3.select("#dummyPath").remove(),d3.select("#dummyText").remove(),m.selectAll(".arcText").data(p).enter().append("text").attr("class","arcText").attr("id",(e,t)=>"text"+t).attr("dy",function(e){return arcs.centroid(e)[1]>0?-((u-100-.9*(u-100))/2-.35*textHeight):(u-100-.9*(u-100))/2+.35*textHeight}).append("textPath").attr("startOffset","50%").attr("text-anchor","middle").attr("xlink:href",function(e,t){return"#donutArc"+t}).style("fill",(e,t)=>d3.hsl(colourSchemeRing(t)).l<.64?"#FFFFFF":"#333333").style("pointer-events","none").text(e=>textFits(e)),s}).then(e=>{heatmapArray=[],xProjectKeys=Array.from(new Set(e.nodes.map(e=>e.group))).sort(),yProjectKeys=Array.from(new Set(e.nodes.map(e=>e.group))).sort().reverse();var t=d3.nest().key(e=>e.sourceProj).key(e=>e.targetProj).rollup(e=>e.length).entries(e.links);for(let t=0;t<xProjectKeys.length;t++)for(let o=0;o<yProjectKeys.length;o++)heatmapArray.push({source:xProjectKeys[t],sourceName:e.nodes.find(e=>e.group==xProjectKeys[t]).projectName,target:yProjectKeys[o],targetName:e.nodes.find(e=>e.group==yProjectKeys[t]).projectName,value:0});t.forEach(e=>{source=e.key;for(let t=0;t<e.values.length;t++)target=e.values[t].key,value=e.values[t].value,heatmapArray.find(e=>e.source==source&&e.target==target).value=value}),max=d3.max(heatmapArray,e=>e.value);const o=d3.select("#tableChart").select("svg");var a=d3.scaleBand().range([0,Math.min(width,height)-margin.left-margin.right]).domain(xProjectKeys).padding(.01),r=d3.scaleBand().range([Math.min(width,height)-margin.top-margin.bottom,0]).domain(yProjectKeys).padding(.01);colourSchemeHeatmap=d3.scaleLinear().range(["#FFFFFF","#FF2D55"]).domain([0,max]);var l=d3.scaleLinear().domain([0,50]).range([10,1]);o.selectAll().data(heatmapArray).enter().append("rect").attr("id","heatmapRect").attr("x",function(e){return a(e.source)}).attr("y",function(e){return r(e.target)}).attr("width",a.bandwidth()).attr("height",r.bandwidth()).attr("cursor","pointer").attr("rx",Math.max(l(xProjectKeys.length).toFixed(0),1)).attr("ry",Math.max(l(xProjectKeys.length).toFixed(0),1)).attr("transform","translate("+margin.left+","+margin.top+")").style("fill",e=>e.source!=e.target||$("#checkInternal").is(":checked")?colourSchemeHeatmap(e.value):"#CCCCCC").style("opacity",e=>e.source!=e.target||$("#checkInternal").is(":checked")?0==e.value?.2:1:0).on("mouseover",e=>$("#checkInternal").is(":checked")||e.source!=e.target&&!$("#checkInternal").is(":checked")?n.style("visibility","visible"):null).on("mousemove",function(t,o){var a=d3.mouse(rootSVG.node());scr.x=window.scrollX,scr.y=window.scrollY,a[0]+=svgpos.x,a[1]+=svgpos.y,n.style("right",""),n.style("left",""),n.style("bottom",""),n.style("top",""),t.value>0?n.html("<h4 style='color:white'>"+t.source+" has <span style='color:"+colourSchemeHeatmap(t.value)+";'>"+t.value+"</span> dependencies logged against "+t.target+"<hr><table><tbody><tr><td>"+t.source+": </td><td>"+e.links.find(e=>t.source==e.sourceProj).sourceProjectName+"</td></tr><tr><td>"+t.target+": </td><td>"+e.links.find(e=>t.target==e.targetProj).targetProjectName+"</td></tr></tbody></table><hr>"):n.html("<h4 style='color:white'>"+t.source+" has no dependencies logged against "+t.target+"</h4>"),a[0]>scr.x+scr.w/2?n.style("right",body.w-a[0]+dist.x-chart.left+parseInt($("#appContainer").css("marginLeft".replace("px","")))+"px"):n.style("left",a[0]+dist.x-chart.left+parseInt($("#appContainer").css("marginLeft".replace("px","")))+"px"),n.style("top",a[1]-dist.y-header.height-n.node().getBoundingClientRect().height-parseInt($("#appContainer").css("marginTop".replace("px","")))+"px"),($("#checkInternal").is(":checked")||t.source!=t.target&&!$("#checkInternal").is(":checked"))&&n.style("visibility","visible")}).on("mouseout",function(){n.style("visibility","hidden")}),o.selectAll().data(heatmapArray).enter().append("text").attr("id","heatmapText").attr("x",function(e){return a(e.source)+a.bandwidth()/2}).attr("y",function(e){return r(e.target)+r.bandwidth()/2}).attr("dy","0.35em").attr("transform","translate("+margin.left+","+margin.top+")").attr("text-anchor","middle").style("pointer-events","none").style("fill",(e,t)=>d3.hsl(colourSchemeHeatmap(e.value)).l<.64?"#FFFFFF":"#2E2E2E").text(e=>e.value>0&&e.source!=e.target?e.value:null).each(function(e,t){!(this.getComputedTextLength()<a.bandwidth())&&this.remove()}),o.append("g").attr("transform","translate("+margin.left+","+margin.top+")").call(d3.axisTop(a).tickSizeOuter(0)).attr("class","axis").selectAll("text").attr("x",10).attr("dy","0.35em").attr("transform","rotate(-45)").style("text-anchor","start"),o.append("g").attr("transform","translate("+margin.left+","+(width-margin.bottom)+")").call(d3.axisBottom(a).tickSizeOuter(0)).attr("class","axis").selectAll("text").attr("x",10).attr("dy","0.35em").attr("transform","rotate(45)").style("text-anchor","start"),o.append("g").attr("transform","translate("+margin.left+","+margin.top+")").call(d3.axisLeft(r).tickSizeOuter(0)).attr("class","axis"),o.append("g").attr("transform","translate("+(width-margin.right)+","+margin.top+")").call(d3.axisRight(r).tickSizeOuter(0)).attr("class","axis");var n=d3.select("#tableChart").append("div").attr("class","tooltipDemo").style("position","absolute").style("visibility","hidden");return rootSVG=d3.select("#tableChart").select("svg"),rootRingSVG=d3.select("#chart").select("svg"),rootSankeySVG=d3.select("#sankeyChart").select("svg"),scr={x:window.scrollX,y:window.scrollY,w:window.innerWidth,h:window.innerHeight},body_sel=d3.select("body"),body={w:body_sel.node().offsetWidth,h:body_sel.node().offsetHeight},svgpos=getNodePos(rootSVG.node()),svgRingpos=getNodePos(rootRingSVG.node()),svgSankeypos=getNodePos(rootSankeySVG.node()),dist={x:20,y:-10},chart=$("#tableChart").position(),header=d3.select(".banner").node().getBoundingClientRect(),width=d3.select("#boardChart").node().getBoundingClientRect().width,[e,heatmapArray]}).then(e=>{ringData=e[0],heatmapData=e[1],sankeyProjects=heatmapData.map(e=>e.source).concat(heatmapData.map(e=>e.target)).unique();var t=removeDuplicates(heatmapData.map(function(e){return{name:e.source+"source",project:e.source}}).concat(heatmapData.map(function(e){return{name:e.target+"target",project:e.target}})));t.forEach(e=>{e.projectName=ringData.nodes.find(t=>t.group==e.project).projectName});var o=heatmapData.map(function(e){return{source:t.findIndex(t=>t.name==e.source+"source"),sourceName:e.sourceName,target:t.findIndex(t=>t.name==e.target+"target"),targetName:e.targetName,value:e.value}}),a={nodes:t,links:o};colourSchemeSankey=d3.scaleSequential().interpolator(d3.interpolateRainbow).domain([0,sankeyProjects.length].reverse());const r=d3.select("#sankeyContainer"),l=d3.sankey().nodeWidth(50).nodeAlign(d3.sankeyCenter).nodeSort((e,t)=>e.sourceLinks.length>0?e.index-t.index:t.index-e.index).iterations(1e3).size([width-margin.left-margin.right,height-margin.top-margin.bottom]);var n=l(a);const s=r.append("g").attr("transform","translate("+margin.left+","+margin.top+")").selectAll("path").data(a.links).enter().append("path").attr("class","sankeyLink").attr("d",d3.sankeyLinkHorizontal()).style("stroke-width",e=>e.width).on("mouseover",function(){return c.style("visibility","visible")}).on("mousemove",function(e,t){var o=d3.mouse(rootSankeySVG.node());scr.x=window.scrollX,scr.y=window.scrollY,o[0]+=svgSankeypos.x,o[1]+=svgSankeypos.y,c.style("right",""),c.style("left",""),c.style("bottom",""),c.style("top",""),c.html("<h4 style='color:white'>"+e.source.project+" has "+e.value+" dependencies logged against "+e.target.project+"<hr><table><tbody><tr><td>"+e.source.project+": </td><td>"+e.source.projectName+"</td></tr><tr><td>"+e.target.project+": </td><td>"+e.target.projectName+"</td></tr></tbody></table>"),o[0]>scr.x+scr.w/2?c.style("right",body.w-o[0]+dist.x-chart.left+parseInt($("#appContainer").css("marginLeft".replace("px","")))+"px"):c.style("left",o[0]+dist.x-chart.left+parseInt($("#appContainer").css("marginLeft".replace("px","")))+"px"),c.style("top",o[1]-dist.y-header.height-c.node().getBoundingClientRect().height-parseInt($("#appContainer").css("marginTop".replace("px","")))+"px"),($("#checkInternal").is(":checked")||e.source!=e.target&&!$("#checkInternal").is(":checked"))&&c.style("visibility","visible")}).on("mouseout",function(){return c.style("visibility","hidden")}),i=r.append("g").attr("transform","translate("+margin.left+","+margin.top+")").selectAll(".sankeyNode").data(a.nodes).enter().append("g").attr("class","sankeyNode").attr("transform",e=>`translate(${e.x0},${e.y0})`).call(d3.drag().subject(e=>e).on("start",function(){this.parentNode.appendChild(this)}).on("drag",function dragmove(e){var t=d3.select(this).select("rect").attr("y"),o=d3.select(this).select("rect").attr("x");e.x0=e.x0+d3.event.dx,e.x1=e.x1+d3.event.dx,e.y0=e.y0+d3.event.dy,e.y1=e.y1+d3.event.dy;var a=e.y0-t,r=e.x0-o;d3.select(this).attr("transform","translate("+r+","+a+")"),s.attr("d",d3.sankeyLinkHorizontal()),l.update(n)})).on("mouseover",function(){return c.style("visibility","visible")}).on("mousemove",function(e,t){var o=d3.mouse(rootSankeySVG.node());if(scr.x=window.scrollX,scr.y=window.scrollY,o[0]+=svgSankeypos.x,o[1]+=svgSankeypos.y,c.style("right",""),c.style("left",""),c.style("bottom",""),c.style("top",""),tooltipDemoString="",tooltipDemoArray=[],e.sourceLinks.length>0){for(tooltipDemoArray=e.sourceLinks.sort((e,t)=>t.value-e.value),tooltipDemoString="<h4 style='color:white'>"+e.projectName+" has raised "+e.value+" total dependencies <hr>Top "+Math.min(tooltipDemoArray.length,3)+" Dependencies:</h4><table><tbody>",t=0;t<Math.min(tooltipDemoArray.length,3);t++)tooltipDemoString+="<tr><td>#"+(t+1)+" "+tooltipDemoArray[t].target.projectName+": </td><td>"+tooltipDemoArray[t].value+"</td></tr>";tooltipDemoString+="</tbody></table>",c.html(tooltipDemoString)}else{for(tooltipDemoArray=e.targetLinks.sort((e,t)=>t.value-e.value),tooltipDemoString="<h4 style='color:white'>"+e.projectName+" has had "+e.value+" total dependencies raised against them<hr>Top "+Math.min(tooltipDemoArray.length,3)+" Dependencies:</h4><table><tbody>",t=0;t<Math.min(tooltipDemoArray.length,3);t++)tooltipDemoString+="<tr><td>#"+(t+1)+" "+tooltipDemoArray[t].source.projectName+": </td><td>"+tooltipDemoArray[t].value+"</td></tr>";tooltipDemoString+="</tbody></table>",c.html(tooltipDemoString)}o[0]>scr.x+scr.w/2?c.style("right",body.w-o[0]+dist.x-chart.left+parseInt($("#appContainer").css("marginLeft".replace("px","")))+"px"):c.style("left",o[0]+dist.x-chart.left+parseInt($("#appContainer").css("marginLeft".replace("px","")))+"px"),c.style("top",o[1]-dist.y-header.height-c.node().getBoundingClientRect().height-parseInt($("#appContainer").css("marginTop".replace("px","")))+"px"),($("#checkInternal").is(":checked")||e.source!=e.target&&!$("#checkInternal").is(":checked"))&&c.style("visibility","visible"),d3.selectAll(".sankeyLink").transition().style("stroke",t=>e.sourceLinks.length>0&&e.project==t.source.project||e.targetLinks.length>0&&e.project==t.target.project?colourSchemeSankey(sankeyProjects.indexOf(e.project)):$("#checkDarkmode").is(":checked")?"#FFFFFF":"#2E2E2E").style("stroke-opacity",t=>e.sourceLinks.length>0&&e.project==t.source.project||e.targetLinks.length>0&&e.project==t.target.project?.8:.2)}).on("mouseout",function(){c.style("visibility","hidden"),d3.selectAll(".sankeyLink").transition().style("stroke-opacity",.2),adjustDarkMode()});s.attr("d",d3.sankeyLinkHorizontal()),l.update(n),i.append("rect").attr("class","sankeyNodeRect").attr("height",e=>e.y1-e.y0).attr("width",e=>e.x1-e.x0).style("fill",e=>colourSchemeSankey(sankeyProjects.indexOf(e.project))).style("stroke","none").append("text"),i.append("text").attr("class","sankeyNodeText").attr("x",0).attr("y",e=>(e.y1-e.y0)/2).attr("dx",l.nodeWidth()/2).attr("dy","0.35em").attr("text-anchor","middle").attr("transform",null).attr("pointer-events","none").style("fill",(e,t)=>d3.hsl(colourSchemeSankey(sankeyProjects.indexOf(e.project))).l<.64?"#FFFFFF":"#2E2E2E").text(e=>e.project),d3.selectAll(".sankeyNodeText").attr("display",function(e){return d3.select(this).node().getBBox().height>e.y1-e.y0?"none":null});var c=d3.select("#sankeyChart").append("div").attr("class","tooltipDemo").style("position","absolute").style("visibility","hidden");return rootSVG=d3.select("#tableChart").select("svg"),rootRingSVG=d3.select("#chart").select("svg"),rootSankeySVG=d3.select("#sankeyChart").select("svg"),scr={x:window.scrollX,y:window.scrollY,w:window.innerWidth,h:window.innerHeight},body_sel=d3.select("body"),body={w:body_sel.node().offsetWidth,h:body_sel.node().offsetHeight},svgpos=getNodePos(rootSVG.node()),svgRingpos=getNodePos(rootRingSVG.node()),svgSankeypos=getNodePos(rootSankeySVG.node()),dist={x:20,y:-10},chart=$("#tableChart").position(),header=d3.select(".banner").node().getBoundingClientRect(),width=d3.select("#boardChart").node().getBoundingClientRect().width,r.append("g").attr("transform","translate("+margin.left+","+margin.top+")").append("text").attr("class","uppercaseHeading").attr("text-anchor","middle").attr("y",-12).attr("dx",l.nodeWidth()/2).attr("dy","-1.35em").text("Team"),r.append("g").attr("transform","translate("+margin.left+","+margin.top+")").append("text").attr("class","uppercaseHeading").attr("text-anchor","middle").attr("y",-10).attr("dx",l.nodeWidth()/2).attr("dy","-0.35em").text("Raised"),r.append("g").attr("transform","translate("+(width-margin.right)+","+margin.top+")").append("text").attr("class","uppercaseHeading").attr("text-anchor","middle").attr("y",-12).attr("dx",-l.nodeWidth()/2).attr("dy","-1.35em").text("Team"),r.append("g").attr("transform","translate("+(width-margin.right)+","+margin.top+")").append("text").attr("class","uppercaseHeading").attr("text-anchor","middle").attr("y",-10).attr("dx",-l.nodeWidth()/2).attr("dy","-0.35em").text("Received"),[ringData,heatmapData,sankeyProjects]}).then(e=>{forceTable=e[0],forceProjects=e[2],colourToNode={};var t=1;forceObjects={},forceProjects.forEach(e=>{forceObjects[e]=null,colour=genColour(),colourToNode[colour]=e,forceProjects[e]=colour}),forceTable.nodes.forEach(e=>{e.groupId=forceProjects.indexOf(e.group),e.hiddenCol=genColour(),colourToNode[e.hiddenCol]=e});var o=d3.select("#forceChart").append("div").attr("id","tooltipForce").attr("class","tooltipDemo").style("position","absolute").style("visibility","hidden"),a=d3.scaleLinear().domain([1,d3.max(forceTable.nodes,e=>e.total)]).range([5,15]),r=d3.scaleLinear().domain([1,1e5]).range([14,36]);d3.select("#forceChart").append("canvas").attr("width",width).attr("height",height).attr("id","forceContainer"),d3.select("#forceChart").append("canvas").attr("width",width).attr("height",height).attr("id","forceContainerHidden").style("display","none");var l=d3.select("#forceContainer").node().getContext("2d"),n=d3.select("#forceContainerHidden").node().getContext("2d");polygonPath=d3.line().x(function(e){return e[0]}).y(function(e){return e[1]}).curve(d3.curveCatmullRomClosed).context(l),polygonPathHidden=d3.line().x(function(e){return e[0]}).y(function(e){return e[1]}).curve(d3.curveCatmullRomClosed).context(n);var s=d3.forceSimulation().force("charge",d3.forceManyBody()),i=d3.zoomIdentity,c=forceInABox().strength(.075).template("treemap").groupBy("groupId").links(forceTable.links).enableGrouping(!0).nodeSize(10).forceCharge(-25).size([width,height]);function simulationUpdate(e){l.save(),l.clearRect(0,0,width,height),l.translate(i.x,i.y),l.scale(i.k,i.k),l.strokeWidth=5,l.textAlign="center",l.textBaseline="middle",n.save(),n.clearRect(0,0,width,height),n.translate(i.x,i.y),n.scale(i.k,i.k),groupIds.forEach(function(t,o){polygon=d(t),forceObjects[forceProjects[t]]=polygon,centroid=d3.polygonCentroid(polygon),l.save(),l.translate(centroid[0],centroid[1]),l.scale(1.1,1.1),l.beginPath(),polygonPath(polygon.map(function(e){return[e[0]-centroid[0],e[1]-centroid[1]]})),l.closePath(),"string"==typeof e?heatmapArray.filter(o=>o.source==e&&o.target==forceProjects[t])[0].value>0||heatmapArray.filter(o=>o.source==forceProjects[t]&&o.target==e)[0].value>0?($("#checkDarkmode").is(":checked")?l.fillStyle="#FFFFFF":l.fillStyle="#2E2E2E",l.font=r(d3.polygonArea(polygon))+"px Roboto",l.fillText(forceProjects[t],0,0),l.globalAlpha=1,l.strokeStyle=colourSchemeSankey(t),l.stroke(),l.globalAlpha=.2,l.fillStyle=colourSchemeSankey(t),l.fill()):(l.globalAlpha=.05,l.strokeStyle="#333333",l.stroke(),l.globalAlpha=.05,l.fillStyle="#333333",l.fill()):"object"==typeof e?forceTable.links.filter(o=>o.source.id==e.id&&o.target.group==forceProjects[t]).length>0||forceTable.links.filter(o=>o.source.group==forceProjects[t]&&o.target.id==e.id).length>0?($("#checkDarkmode").is(":checked")?l.fillStyle="#FFFFFF":l.fillStyle="#2E2E2E",l.font=r(d3.polygonArea(polygon))+"px Roboto",l.fillText(forceProjects[t],0,0),l.globalAlpha=1,l.strokeStyle=colourSchemeSankey(t),l.stroke(),l.globalAlpha=.2,l.fillStyle=colourSchemeSankey(t),l.fill()):(l.globalAlpha=.05,l.strokeStyle="#333333",l.stroke(),l.globalAlpha=.05,l.fillStyle="#333333",l.fill()):($("#checkDarkmode").is(":checked")?l.fillStyle="#FFFFFF":l.fillStyle="#2E2E2E",l.font=r(d3.polygonArea(polygon))+"px Roboto",l.fillText(forceProjects[t],0,0),l.globalAlpha=1,l.strokeStyle=colourSchemeSankey(t),l.stroke(),l.globalAlpha=.2,l.fillStyle=colourSchemeSankey(t),l.fill()),l.restore(),n.save(),n.translate(centroid[0],centroid[1]),n.scale(1.1,1.1),n.beginPath(),polygonPathHidden(polygon.map(function(e){return[e[0]-centroid[0],e[1]-centroid[1]]})),n.closePath(),n.strokeStyle=forceProjects[forceProjects[t]],n.fillStyle=forceProjects[forceProjects[t]],n.globalAlpha=1,n.stroke(),n.fill(),n.restore()}),forceTable.links.forEach(function(t){"string"==typeof e?(l.globalAlpha=.8,t.sourceProj==e&&t.targetProj==e?l.strokeStyle="#34AADC":t.sourceProj==e?l.strokeStyle="#FF2D55":t.targetProj==e?l.strokeStyle="#4CD964":(l.globalAlpha=0,l.strokeStyle=null)):"object"==typeof e?(l.globalAlpha=.8,t.source.id==e.id?l.strokeStyle="#FF2D55":t.target.id==e.id?l.strokeStyle="#4CD964":$("#checkDarkmode").is(":checked")?(l.globalAlpha=0,l.strokeStyle="#FFFFFF"):(l.globalAlpha=0,l.strokeStyle=null)):(l.globalAlpha=.1,$("#checkDarkmode").is(":checked")?l.strokeStyle="#FFFFFF":l.strokeStyle="#2E2E2E"),l.beginPath(),l.moveTo(t.source.x,t.source.y),l.lineTo(t.target.x,t.target.y),l.stroke()}),$("#checkDarkmode").is(":checked")?l.strokeStyle="#FFFFFF":l.strokeStyle="#2E2E2E",forceTable.nodes.forEach(function(t,o){l.beginPath(),l.arc(t.x,t.y,a(t.total),0,2*Math.PI,!0),"string"==typeof e?t.group==e||forceTable.links.filter(o=>o.sourceProj==e&&o.target.id==t.id).length>0||forceTable.links.filter(o=>o.source.id==t.id&&o.targetProj==e).length>0?(l.globalAlpha=1,l.fillStyle=colourSchemeSankey(forceProjects.indexOf(t.group))):(l.globalAlpha=.05,l.fillStyle="#333333"):"object"==typeof e?t.id==e.id||t.sourceIds.indexOf(e.id)>=0||t.targetIds.indexOf(e.id)>=0?(l.globalAlpha=1,l.fillStyle=colourSchemeSankey(forceProjects.indexOf(t.group))):(l.globalAlpha=.05,l.fillStyle="#333333"):(l.globalAlpha=1,l.fillStyle=colourSchemeSankey(forceProjects.indexOf(t.group))),l.fill(),l.stroke(),l.globalAlpha=1,n.beginPath(),n.arc(t.x,t.y,a(t.total),0,2*Math.PI,!0),n.fillStyle=t.hiddenCol,n.fill(),n.stroke()}),l.restore(),n.restore()}s.nodes(forceTable.nodes).force("group",c).force("link",d3.forceLink().id(function(e){return e.id}).distance(50).strength(c.getLinkStrength)),s.nodes(forceTable.nodes).on("tick",simulationUpdate),s.force("link").links(forceTable.links),d3.select("#forceContainer").call(d3.drag().subject(function dragsubject(){var e,t,o,r=i.invertX(d3.event.x),l=i.invertY(d3.event.y);for(e=forceTable.nodes.length-1;e>=0;--e)if(node=forceTable.nodes[e],(t=r-node.x)*t+(o=l-node.y)*o<a(forceTable.nodes[e].total)*a(forceTable.nodes[e].total))return node.x=i.applyX(node.x),node.y=i.applyY(node.y),node;for(e=0;e<groupIds.length;e++)if(group=groupIds[e],d3.polygonContains(forceObjects[forceProjects[group]],[r,l]))return forceTable.nodes.filter(e=>e.groupId==group)}).on("start",function dragstarted(){o.style("visibility","hidden"),d3.event.active?Array.isArray(d3.event.subject)||(d3.event.subject.fx=i.invertX(d3.event.x),d3.event.subject.fy=i.invertY(d3.event.y)):s.alphaTarget(.3).restart()}).on("drag",function dragged(){Array.isArray(d3.event.subject)?d3.event.subject.forEach(e=>{e.x+=d3.event.dx,e.y+=d3.event.dy}):(d3.event.subject.fx=i.invertX(d3.event.x),d3.event.subject.fy=i.invertY(d3.event.y))}).on("end",function dragended(){d3.event.active||s.alphaTarget(0),d3.event.subject.fx=null,d3.event.subject.fy=null})).call(d3.zoom().scaleExtent([.1,8]).on("zoom",function zoomed(){i=d3.event.transform,simulationUpdate()})).on("mousemove",function(){var e=d3.mouse(this),t=n.getImageData(e[0],e[1],1,1).data,a="rgb("+t[0]+","+t[1]+","+t[2]+")",r=colourToNode[a];canvasZoomValue=d3.zoomTransform(d3.select("#forceContainer").node()),"object"==typeof r?(o.style("visibility","visible"),o.style("right",""),o.style("left",""),o.style("bottom",""),o.style("top",""),sourceLength=r.sourceIds?r.sourceIds.length:0,targetLength=r.targetIds?r.targetIds.length:0,o.html("<h4 style='color:#FFFFFF'>ID: "+r.id+"<br>Summary: "+r.summary+"<hr><table><tbody><tr><td>Received Dependencies: </td><td><span style='color:#4CD964'>"+sourceLength+"</span></td></tr><tr><td>Raised Dependencies: </td><td><span style='color:#FF2D55'>"+targetLength+"</span></td></tr></tbody></table><hr>"),e[0]>width/2?o.style("left",e[0]+document.getElementById("forceContainer").getBoundingClientRect().left-document.getElementById("tooltipForce").offsetWidth+"px"):o.style("left",e[0]+document.getElementById("forceContainer").getBoundingClientRect().left+20+"px"),e[1]>height/2?o.style("top",e[1]+document.getElementById("forceContainer").getBoundingClientRect().top-document.getElementById("tooltipForce").offsetHeight+250+"px"):o.style("top",e[1]+document.getElementById("forceContainer").getBoundingClientRect().top-50+"px"),s.stop(),simulationUpdate(r)):"string"==typeof r?(o.style("visibility","visible"),o.style("right",""),o.style("left",""),o.style("bottom",""),o.style("top",""),projectName=forceTable.nodes.find(e=>r==e.group).projectName,sourceLength=forceTable.links.filter(e=>r==e.target.group&&r!=e.source.group).length,targetLength=forceTable.links.filter(e=>r==e.source.group&&r!=e.target.group).length,internalLength=forceTable.links.filter(e=>r==e.source.group&&r==e.target.group).length,$("#checkInternal").is(":checked")?o.html("<h4 style='color:#FFFFFF'>ID: "+r+"<br>Name: "+projectName+"<hr><table><tbody><tr><td>Received Dependencies: </td><td><span style='color:#4CD964'>"+sourceLength+"</span></td></tr><tr><td>Raised Dependencies: </td><td><span style='color:#FF2D55'>"+targetLength+"</span></td></tr><tr><td>Internal Dependencies: </td><td><span style='color:#34AADC'>"+internalLength+"</span></td></tr></tbody></table><hr>"):o.html("<h4 style='color:#FFFFFF'>ID: "+r+"<br>Name: "+projectName+"<hr><table><tbody><tr><td>Received Dependencies: </td><td><span style='color:#4CD964'>"+sourceLength+"</span></td></tr><tr><td>Raised Dependencies: </td><td><span style='color:#FF2D55'>"+targetLength+"</span></td></tr></tbody></table><hr>"),e[0]>width/2?o.style("left",e[0]+document.getElementById("forceContainer").getBoundingClientRect().left-document.getElementById("tooltipForce").offsetWidth+"px"):o.style("left",e[0]+document.getElementById("forceContainer").getBoundingClientRect().left+20+"px"),e[1]>height/2?o.style("top",e[1]+document.getElementById("forceContainer").getBoundingClientRect().top-document.getElementById("tooltipForce").offsetHeight+250+"px"):o.style("top",e[1]+document.getElementById("forceContainer").getBoundingClientRect().top-50+"px"),s.stop(),simulationUpdate(r)):(o.style("visibility","hidden"),s.restart(),simulationUpdate())}).on("mouseout",function(){o.style("visibility","hidden"),s.restart(),simulationUpdate()}),groupIds=d3.set(forceTable.nodes.map(function(e){return+e.groupId})).values().map(function(e){return{groupId:e,count:forceTable.nodes.filter(function(t){return+t.groupId==e}).length}}).filter(function(e){return e.count>2}).map(function(e){return e.groupId});var d=function(e){var t=forceTable.nodes.filter(function(t){return t.groupId==e}).map(function(e){return[e.x,e.y]});return d3.polygonHull(t)};function genColour(){var e=[];return t<16777215&&(e.push(255&t),e.push((65280&t)>>8),e.push((16711680&t)>>16),t+=10),"rgb("+e.join(",")+")"}return e}).then(e=>{var t,o,a,r,l,n,s,c,d,u=d3.select("#boardChart").append("div").attr("class","tooltipDemo").attr("id","tooltipBoard").style("position","absolute").style("visibility","hidden"),g=d3.select("#boardContainer").node().getContext("2d"),h=d3.select("#boardContainerHidden").node().getContext("2d"),p=100,y=100,m=10,f=10,b=d3.zoomIdentity,x=100,v=80,k=v-10,F=x-10;function drawBoards(){g.save(),g.clearRect(0,0,width,height),g.translate(b.x,b.y),g.scale(b.k,b.k),function calculateData(){t=e[0].nodes,o=e[0].links,a=t.map(e=>e.group).filter(e=>e).unique().sort(),r=t.map(e=>getBoardDate(e)[0]).unique().sort(function(e,t){return $("#checkBoardNull").is(":checked")?null===e?1:null===t?-1:new Date(e)-new Date(t):null===e?-1:null===t?1:new Date(e)-new Date(t)}),l=[],n=[],s=[],c=1,d={},a.forEach((e,o)=>{l[o]=[],r.forEach((a,r)=>{l[o][r]=[],l[o][r].push(t.filter(t=>t.group==e&&getBoardDate(t)[0]==a))})}),a.forEach((e,t)=>{s[a[t]]=d3.max(l[t],e=>e[0].length)}),r.forEach((e,t)=>{n[r[t]]=d3.max(l.map(e=>e[t]),e=>e[0].length)})}(),function calculateCoords(){for(cellY=v,j=0;j<a.length;j++){for(cellX=x,maxWidth=Math.min(Math.ceil(d3.max(d3.values(n))/5*5),f),cellRows=Math.ceil(s[a[j]]/maxWidth),cellHeight=cellRows*(y+m)+m,i=0;i<r.length;i++)cellColumns=Math.min(Math.ceil(n[r[i]]/5*5),f),cellWidth=cellColumns*(p+m)+m,nodeX=cellX+m,nodeY=cellY+m,l[j][i][0].forEach((e,t)=>{e.nodeX=nodeX,e.nodeY=nodeY,e.nodeColour=genColour(),d[e.nodeColour]=e,e.targetIds.length>0?(e.sourceBoardLinkX=nodeX+10,e.sourceBoardLinkY=nodeY+(y-10)):(e.sourceBoardLinkX=null,e.sourceBoardLinkY=null),e.sourceIds.length>0?(e.targetBoardLinkX=nodeX+(p-10),e.targetBoardLinkY=nodeY+(y-10)):(e.targetBoardLinkX=null,e.targetBoardLinkY=null),(t+1)%cellColumns==0?(nodeX=cellX+m,nodeY+=y+m):nodeX+=p+m}),cellX+=cellWidth;cellY+=cellHeight}o.forEach(e=>{e.midPointX=Math.min(e.source.sourceBoardLinkX,e.target.targetBoardLinkX)+(Math.max(e.source.sourceBoardLinkX,e.target.targetBoardLinkX)-Math.min(e.source.sourceBoardLinkX,e.target.targetBoardLinkX))/2,e.midPointY=Math.max(e.source.sourceBoardLinkY,e.target.targetBoardLinkY)+20})}(),drawHeadings(),drawCells("boardContext"),determineNodeAndStringOrder(),drawNodes("boardContextHidden"),g.restore()}function drawHeadings(){for(null!=r[0]&&(g.beginPath(),g.moveTo(x,v),g.lineTo(10,v),g.quadraticCurveTo(10,10,x,10),g.closePath(),g.fillStyle="#F4F4F4",g.fill()),g.beginPath(),g.moveTo(10,v),g.quadraticCurveTo(10,10,x,10),g.strokeStyle="#333333",g.strokeWidth=2,g.stroke(),g.globalAlpha=1,cellX=x,cellY=10,g.textAlign="center",g.textBaseline="middle",g.font="24px Roboto",i=0;i<r.length;i++)g.globalAlpha=1,g.beginPath(),headingWidth=Math.min(Math.ceil(n[r[i]]/5*5),f)*(p+m)+m,g.rect(cellX,cellY,headingWidth,k),null==r[i]?(g.fillStyle="black",g.globalAlpha=0):i%2==0?(g.fillStyle="#F4F4F4",g.globalAlpha=1):(g.fillStyle="#DBDBDB",g.globalAlpha=1),g.fill(),g.globalAlpha=1,g.fillStyle="#333333",null!=r[i]?(boardTitleTop=d3.timeFormat("%e %b")(new Date(r[i])).toUpperCase(),boardTitleBottom=d3.timeFormat("%Y")(new Date(r[i])).toUpperCase()):(boardTitleTop="NOT",boardTitleBottom="TAGGED"),g.fillText(boardTitleTop,cellX+headingWidth/2,cellY+k/4),g.fillText(boardTitleBottom,cellX+headingWidth/2,cellY+.75*k),g.strokeStyle="#333333",g.strokeWidth=2,g.beginPath(),g.moveTo(cellX,cellY),g.lineTo(cellX+headingWidth,cellY),g.stroke(),i!=r.length-1&&null!=r[i+1]||(g.beginPath(),g.moveTo(cellX+headingWidth,cellY),g.lineTo(cellX+headingWidth,cellY+k),g.stroke()),cellX+=headingWidth;for(cellX=10,cellY=v,maxWidth=Math.min(Math.ceil(d3.max(d3.values(n))/5*5),f),g.font="36px Roboto",g.globalAlpha=1,j=0;j<a.length;j++)headingHeight=Math.ceil(s[a[j]]/maxWidth)*(y+m)+m,g.beginPath(),g.rect(cellX,cellY,F,headingHeight),g.fillStyle=colourSchemeSankey(j),g.fill(),g.fillStyle=pickTextColorBasedOnBgColor(colourSchemeSankey(j),"#FFFFFF","#333333"),boardTitle=a[j],g.save(),g.translate(cellX+F/2,cellY+headingHeight/2),g.rotate(-Math.PI/2),g.fillText(boardTitle,0,0),g.restore(),g.strokeStyle="#333333",g.strokeWidth=2,g.beginPath(),g.moveTo(cellX,cellY),g.lineTo(cellX,cellY+headingHeight),g.stroke(),g.beginPath(),g.moveTo(cellX,cellY),g.lineTo(cellX+F,cellY),g.stroke(),j==a.length-1&&(g.beginPath(),g.moveTo(cellX,cellY+headingHeight),g.lineTo(cellX+F,cellY+headingHeight),g.stroke()),cellY+=headingHeight}function drawCells(e){for((e="boardContext"==e?d3.select("#boardContainer").node().getContext("2d"):d3.select("#boardContainerHidden").node().getContext("2d")).globalAlpha=1,cellY=v,j=0;j<a.length;j++){for(cellX=x,cellRows=Math.ceil(s[a[j]]/maxWidth),cellHeight=cellRows*(y+m)+m,i=0;i<r.length;i++)e.beginPath(),cellColumns=Math.min(Math.ceil(n[r[i]]/5*5),f),cellWidth=cellColumns*(p+m)+m,e.rect(cellX,cellY,cellWidth,cellHeight),null==r[i]?(e.fillStyle=null,e.globalAlpha=0):i%2==0?(e.fillStyle="#F4F4F4",e.globalAlpha=1):(e.fillStyle="#DBDBDB",e.globalAlpha=1),e.fill(),e.globalAlpha=1,g.strokeStyle="#333333",g.strokeWidth=2,g.beginPath(),g.moveTo(cellX,cellY),g.lineTo(cellX+cellWidth,cellY),g.stroke(),j==a.length-1&&(g.beginPath(),g.moveTo(cellX,cellY+cellHeight),g.lineTo(cellX+cellWidth,cellY+cellHeight),g.stroke()),i!=r.length-1&&null!=r[i+1]||(g.beginPath(),g.moveTo(cellX+cellWidth,cellY),g.lineTo(cellX+cellWidth,cellY+cellHeight),g.stroke()),cellX+=cellWidth;cellY+=cellHeight}}function drawNodes(e,o){"boardContext"==e?((e=d3.select("#boardContainer").node().getContext("2d")).font="14px Roboto",t.forEach(t=>{o?t.id==o.id||t.sourceIds.includes(o.id)||t.targetIds.includes(o.id)?e.globalAlpha=1:e.globalAlpha=.05:e.globalAlpha=1,drawRoundRect(e,t.nodeX,t.nodeY,p,y,5,!0,"#FFFFFF",!0,"#333333"),statusColour=getStatusColour(t),roundedHeading={tl:5,tr:5,br:0,bl:0},drawRoundRect(e,t.nodeX,t.nodeY,p,20,roundedHeading,!0,statusColour),e.fillStyle="#333333",e.fillText(t.id,t.nodeX+p/2,t.nodeY+y/2),t.targetIds.length>0&&(e.beginPath(),e.arc(t.sourceBoardLinkX,t.sourceBoardLinkY,2.5,0,2*Math.PI),e.fill()),t.sourceIds.length>0&&(e.beginPath(),e.arc(t.targetBoardLinkX,t.targetBoardLinkY,2.5,0,2*Math.PI),e.fill())})):((e=d3.select("#boardContainerHidden").node().getContext("2d")).globalAlpha=1,t.forEach(t=>{drawRoundRect(e,t.nodeX,t.nodeY,p,y,5,!0,t.nodeColour,!1)}))}function drawLinks(e,t){e="boardContext"==e?d3.select("#boardContainer").node().getContext("2d"):d3.select("#boardContainerHidden").node().getContext("2d"),o.forEach(o=>{t?o.source.id==t.id?(e.strokeWidth=20,e.strokeStyle="#FF2D55",e.globalAlpha=1):o.target.id==t.id?(e.strokeWidth=20,e.strokeStyle="#4CD964",e.globalAlpha=1):(e.strokeWidth=1,e.globalAlpha=.05):(e.strokeStyle=$("#selectStringColour").children("option:selected").val(),e.strokeWidth=10,e.globalAlpha=1),e.beginPath(),e.moveTo(o.source.sourceBoardLinkX,o.source.sourceBoardLinkY),e.quadraticCurveTo(o.midPointX,o.midPointY,o.target.targetBoardLinkX,o.target.targetBoardLinkY),e.stroke()})}function drawRoundRect(e,t,o,a,r,l,n,s,i,c){if(void 0===i&&(i=!0),void 0===l&&(l=5),"number"==typeof l)l={tl:l,tr:l,br:l,bl:l};else{var d={tl:0,tr:0,br:0,bl:0};for(var u in d)l[u]=l[u]||d[u]}e.beginPath(),e.moveTo(t+l.tl,o),e.lineTo(t+a-l.tr,o),e.quadraticCurveTo(t+a,o,t+a,o+l.tr),e.lineTo(t+a,o+r-l.br),e.quadraticCurveTo(t+a,o+r,t+a-l.br,o+r),e.lineTo(t+l.bl,o+r),e.quadraticCurveTo(t,o+r,t,o+r-l.bl),e.lineTo(t,o+l.tl),e.quadraticCurveTo(t,o,t+l.tl,o),e.closePath(),n&&(e.fillStyle=s,e.fill()),i&&(e.strokeStyle=c,e.stroke())}function genColour(){var e=[];return c<16777215&&(e.push(255&c),e.push((65280&c)>>8),e.push((16711680&c)>>16),c+=10),"rgb("+e.join(",")+")"}function determineNodeAndStringOrder(e){e?$("#checkBoardOrder").is(":checked")?(drawNodes("boardContext",e),drawLinks("boardContext",e)):(drawLinks("boardContext",e),drawNodes("boardContext",e)):$("#checkBoardOrder").is(":checked")?(drawNodes("boardContext"),drawLinks("boardContext")):(drawLinks("boardContext"),drawNodes("boardContext"))}function getBoardDate(e){return[e.latestDate,e.latestBasedOn]}function getStatusColour(e){return"To Do"==e.statusCategory?"#007AFF":"In Progress"==e.statusCategory?"#FFCC00":"Done"==e.statusCategory?"#4CD964":"grey"}return d3.select("#boardContainer").call(d3.zoom().scaleExtent([0,1]).on("zoom",function zoom(){b=d3.event.transform,g.save(),g.clearRect(0,0,width,height),g.translate(b.x,b.y),g.scale(b.k,b.k),drawHeadings(),drawCells("boardContext"),determineNodeAndStringOrder(),g.restore(),h.save(),h.clearRect(0,0,width,height),h.translate(b.x,b.y),h.scale(b.k,b.k),drawNodes("boardContextHidden"),h.restore()})).on("mousemove",function(){var e=d3.event.layerX||d3.event.offsetX,t=d3.event.layerY||d3.event.offsety;if(e&&t){var o=h.getImageData(e,t,1,1).data,a="rgb("+o[0]+","+o[1]+","+o[2]+")",r=d[a];r?(d3.select("#boardContainer").style("cursor","pointer"),u.style("visibility","visible"),u.style("right",""),u.style("left",""),u.style("bottom",""),u.style("top",""),null==getBoardDate(r)[0]?(dueDate="Not tagged",basedOn="Not tagged"):(dueDate=d3.timeFormat("%a %e %b, %Y")(new Date(getBoardDate(r)[0])),basedOn=getBoardDate(r)[1]),sourceLength=r.sourceIds?r.sourceIds.length:0,targetLength=r.targetIds?r.targetIds.length:0,u.html("<h4 style='color:#FFFFFF'>ID: <span class='tooltipThin'>"+r.id+"</span><br>Summary: <span class='tooltipThin'>"+r.summary+"</span><br>Status Category: <span style='color:"+getStatusColour(r)+"'>"+r.statusCategory+"</span><br>Due Date: <span class='tooltipThin'>"+dueDate+"</span><br>Based On: <span class='tooltipThin'>"+basedOn+"</span><hr><table><tbody><tr><td>Received Dependencies: </td><td><span style='color:#4CD964'>"+sourceLength+"</span></td></tr><tr><td>Raised Dependencies: </td><td><span style='color:#FF2D55'>"+targetLength+"</span></td></tr></tbody></table><hr>"),e>width/2?u.style("left",e+document.getElementById("boardContainer").getBoundingClientRect().left-document.getElementById("tooltipBoard").offsetWidth-10+"px"):u.style("left",e+document.getElementById("boardContainer").getBoundingClientRect().left+10+"px"),t>height/2?u.style("top",t+document.getElementById("boardContainer").getBoundingClientRect().top-document.getElementById("tooltipBoard").offsetHeight-10+"px"):u.style("top",t+document.getElementById("boardContainer").getBoundingClientRect().top+10+"px"),g.save(),g.clearRect(0,0,width,height),g.translate(b.x,b.y),g.scale(b.k,b.k),drawHeadings(),drawCells("boardContext"),determineNodeAndStringOrder(r),g.restore()):(u.style("visibility","hidden"),d3.select("#boardContainer").style("cursor","default"),g.save(),g.clearRect(0,0,width,height),g.translate(b.x,b.y),g.scale(b.k,b.k),drawHeadings(),drawCells("boardContext"),determineNodeAndStringOrder(),g.restore())}}).on("mouseout",function(){d3.select("#boardContainer").style("cursor","default"),u.style("visibility","hidden"),g.save(),g.clearRect(0,0,width,height),g.translate(b.x,b.y),g.scale(b.k,b.k),drawHeadings(),drawCells("boardContext"),determineNodeAndStringOrder(),g.restore()}).on("click",function(){var e=d3.event.layerX||d3.event.offsetX,t=d3.event.layerY||d3.event.offsety;if(e&&t){var o=h.getImageData(e,t,1,1).data,a="rgb("+o[0]+","+o[1]+","+o[2]+")",r=d[a];r&&AP.request("/rest/api/3/serverInfo").then(e=>{jiraFields=JSON.parse(e.body),serverURL=jiraFields.baseUrl,window.open(serverURL+"/browse/"+r.id,"_blank")})}}),drawBoards(),$("#checkBoardOrder").change(function(){g.save(),g.clearRect(0,0,width,height),g.translate(b.x,b.y),g.scale(b.k,b.k),drawHeadings(),drawCells("boardContext"),determineNodeAndStringOrder(),g.restore()}),$("#checkBoardNull").change(function(){drawBoards()}),$("#selectStringColour").change(function(){drawBoards()}),$("#selectBoardDateType").change(function(){drawBoards()}),e}).then(e=>{function exportCSVFile(e,t,o){e&&t.unshift(e);var a=function convertToCSV(e){for(var t="object"!=typeof e?JSON.parse(e):e,o="",a=0;a<t.length;a++){var r="";for(var l in t[a])""!=r&&(r+=","),r+=t[a][l];o+=r+"\r\n"}return o}(JSON.stringify(t)),r=o+".csv"||"export.csv",l=new Blob([a],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(l,r);else{var n=document.createElement("a");if(void 0!==n.download){var s=URL.createObjectURL(l);n.setAttribute("href",s),n.setAttribute("download",r),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)}}}ringData=e[0].links,heatmapData=e[1];var t={source:"Source Issue Key",type:"Dependency Type",target:"Target Issue Key",sourceProj:"Source Project Key",sourceProjectName:"Source Project Name",sourceStatus:"Source Issue Status",sourceStatusCategory:"Source Issue Status Category",sourceEpicLink:"Source Epic Key",sourceEpicName:"Source Epic Name",targetProj:"Target Project Key",targetProjectName:"Target Project Name",targetStatus:"Target Issue Status",targetStatusCategory:"Target Issue Status Category",targetEpicLink:"Target Epic Key",targetEpicName:"Target Epic Name"},o=[];ringData.forEach(e=>{o.push({source:e.source?e.source.id.replace(/,/g,""):null,type:e.type?e.type.replace(/,/g,""):null,target:e.target?e.target.id.replace(/,/g,""):null,sourceProj:e.sourceProj?e.sourceProj.replace(/,/g,""):null,sourceProjectName:e.sourceProjectName?e.sourceProjectName.replace(/,/g,""):null,sourceStatus:e.sourceStatus?e.sourceStatus.replace(/,/g,""):null,sourceStatusCategory:e.sourceStatusCategory?e.sourceStatusCategory.replace(/,/g,""):null,sourceEpicLink:e.sourceEpicLink?e.sourceEpicLink.replace(/,/g,""):null,sourceEpicName:e.sourceEpicName?e.sourceEpicName.replace(/,/g,""):null,targetProj:e.targetProj?e.targetProj.replace(/,/g,""):null,targetProjectName:e.targetProjectName?e.targetProjectName.replace(/,/g,""):null,targetStatus:e.targetStatus?e.targetStatus.replace(/,/g,""):null,targetStatusCategory:e.targetStatusCategory?e.targetStatusCategory.replace(/,/g,""):null,targetEpicLink:e.targetEpicLink?e.targetEpicLink.replace(/,/g,""):null,targetEpicName:e.targetEpicName?e.targetEpicName.replace(/,/g,""):null})});var a={source:"Source Project Key",sourceName:"Source Project Name",target:"Target Project Key",targetName:"Target Project Name",value:"Total Dependencies"},r=[];heatmapData.forEach(e=>{r.push({source:e.source?e.source.replace(/,/g,""):null,sourceName:e.source?e.sourceName.replace(/,/g,""):null,target:e.target?e.target.replace(/,/g,""):null,targetName:e.target?e.targetName.replace(/,/g,""):null,value:e.value?e.value:0})}),r=r.filter(e=>e.value>0).sort((e,t)=>t.value-e.value),d3.select("#saveToCSVRing").append("input").attr("id","saveToCSVButton").attr("type","submit").attr("class","submit").style("float","right").property("value","Save to CSV").on("click",function(){"Individual Dependencies"==$("button.active").text()?exportCSVFile(t,o,"dependency-ring-data"):"Team Dynamics"==$("button.active").text()?exportCSVFile(a,r,"dependency-sankey-data"):exportCSVFile(a,r,"dependency-heatmap-data"),d3.event.stopPropagation()})}).then(()=>{adjustDarkMode(),stopLoading(),d3.selectAll(".createViz").attr("class","submit createViz").attr("value","Create Visualisation").on("mouseover",function(){d3.select(this).style("opacity",1)}).on("mousemove",function(){d3.select(this).style("opacity",1)}).on("mouseout",function(){d3.select(this).style("opacity",1)}),$("#sectionChart > a").removeClass("loading"),d3.selectAll(".tablinks").transition().style("opacity",1).style("pointer-events","auto")}).catch(e=>{console.log(e),text=e.err?JSON.parse(e.err).errorMessages[0]:e,$("#checkDarkmode").is(":checked")?(t.text(text).attr("white-space","pre-wrap").transition().style("color","#FFCC00"),d3.selectAll(".object").transition().style("background-color","#FFCC00")):(t.text(text).attr("white-space","pre-wrap").transition().style("color","#333333"),d3.selectAll(".object").transition().style("background-color","#333333")),d3.selectAll(".createViz").attr("class","submit createViz").attr("value","Create Visualisation").on("mouseover",function(){d3.select(this).style("opacity",1)}).on("mousemove",function(){d3.select(this).style("opacity",1)}).on("mouseout",function(){d3.select(this).style("opacity",1)})})}function copyToClipboard(e){const t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}function getNodePos(e){for(var t=d3.select("body").node(),o=0,a=0;null!=e&&e!=t;o+=e.offsetLeft||e.clientLeft,a+=e.offsetTop||e.clientTop,e=e.offsetParent||e.parentNode);return{x:o,y:a}}function startLoading(){d3.selectAll("#loading-container").transition().style("opacity",1),d3.select("#chart").transition().style("opacity",0),d3.select("#tableChart").transition().style("opacity",0),d3.selectAll(".object").style("animation-play-state","running"),d3.selectAll("#saveToCSVButton").remove(),d3.selectAll(".iframeButton").remove(),d3.selectAll(".tooltipDemo").remove(),d3.select("#chart").select("svg").remove(),d3.select("#chart").select("canvas").remove(),d3.select("#tableChart").select("svg").remove(),d3.select("#sankeyChart").select("svg").remove(),d3.select("#chart").append("canvas").attr("id","parentCanvas").attr("width",width).attr("height",height).style("position","relative"),d3.select("#chart").append("svg").attr("id","parentSVG").attr("width",width).attr("height",height).style("position","absolute").style("top",$("#parentCanvas").position().top).style("left",$("#parentCanvas").position().left),d3.select("#tableChart").append("svg").attr("id","parentSVG").attr("width",Math.min(width,height)).attr("height",Math.min(width,height)),d3.select("#sankeyChart").append("svg").attr("width",width).attr("height",height).append("g").attr("id","sankeyContainer"),d3.select("#boardChart").append("canvas").attr("width",width).attr("height",height).attr("id","boardContainer"),d3.select("#boardChart").append("canvas").attr("width",width).attr("height",height).attr("id","boardContainerHidden").style("display","none"),loadChart()}function stopLoading(){d3.selectAll("#loading-container").transition().style("opacity",0),d3.selectAll("#loading-container").style("pointer-events","none"),d3.selectAll(".loading-buttons").transition().style("opacity",0),d3.select("#chart").transition().style("opacity",1),d3.select("#tableChart").transition().style("opacity",1),d3.selectAll(".object").style("animation-play-state","paused")}function selectFilter(){""!=$("#selectFilter option:selected").text()&&(d3.select("#jqlInput").node().value='filter = "'+$("#selectFilter option:selected").text()+'"'),testJQL()}function removeDuplicates(e){return Object.keys(e.reduce((e,t)=>(e[JSON.stringify(t)]=1,e),{})).map((e,t,o)=>JSON.parse(o[t]))}function getArcPath(e,t,o){if(e=e[1].replace(/,/g," "),arcs.centroid(t)[1]>0)if(e.includes("0 0 1")){var a=/M(.*?)A/,r=/A(.*?)0 0 1/;null!=(l=/0 0 1 (.*?)$/).exec(e)&&(e="M"+l.exec(e)[1]+"A"+r.exec(e)[1]+"0 0 0 "+a.exec(e)[1])}else if(e.includes("0 1 1")){var l;a=/M(.*?)A/,r=/A(.*?)0 1 1/,null!=(l=/0 1 1 (.*?)$/).exec(e)&&(e="M"+l.exec(e)[1]+"A"+r.exec(e)[1]+"0 1 0 "+a.exec(e)[1])}return e}Array.prototype.unique=function(){for(var e=this.concat(),t=0;t<e.length;++t)for(var o=t+1;o<e.length;++o)e[t]===e[o]&&e.splice(o--,1);return e};const textFits=e=>{const t=e.value.x1-e.value.x0,o=width/2*t;return Math.floor(o/16<1)?null:(newString=16*e.value.projectName.length<o?e.value.projectName:e.value.projectName.substring(0,Math.ceil(o/16)-1)+"...",newString)};function arcTweenData(e,t){var o=d3.interpolate({x0:e.x0s?e.x0s:0,x1:e.x1s?e.x1s:0},e);return e.x0s=e.value.x0,e.x1s=e.value.x1,function tween(e){var t=o(e);return arcs(t)}}function adjustDarkMode(){dataTable&&(svgZoomValue=d3.zoomTransform(d3.select("#parentSVG").node()),context.save(),context.translate(-width/2,-height/2),context.clearRect(0,0,width,height),context.translate(svgZoomValue.x,svgZoomValue.y),context.scale(svgZoomValue.k,svgZoomValue.k),context.translate(width/2,height/2),dataTable.forEach(e=>{e.source=e[0],e.target=e[e.length-1],context.globalAlpha=.2,context.beginPath(),canvasLine(e),context.lineWidth=1,$("#checkDarkmode").is(":checked")?context.strokeStyle="#FFFFFF":context.strokeStyle="#2E2E2E",context.stroke()}),context.restore()),$("#checkDarkmode").is(":checked")?(d3.select("body").style("background-color","#2E2E2E").style("color","#FFFFFF"),d3.selectAll(".set>a").style("border-bottom","2px solid #424242CC"),d3.selectAll(".sectionDepTypesHeading").style("background-color","#5E5E5E"),d3.selectAll(".tags").style("background-color","#5E5E5E"),d3.selectAll(".optionsGroup").style("background-color","#5E5E5E"),d3.selectAll(".tab").style("background-color","#5E5E5E"),d3.selectAll(".tabLinks").style("background-color","#424242CC"),$(".tab").children().css("background-color","#3D3D3D").css("color","#FFFFFF").hover(function(){$(this).css("background-color","#444444")},function(){$(this).hasClass("active")?$(this).css("background-color","#5E5E5E"):$(this).css("background-color","#3D3D3D")}),$(".tab").children(".active").css("background-color","#5E5E5E").css("color","#FFFFFF"),$("#heading").removeClass(),$("#checkColourblind").is(":checked")?$("#heading").addClass("darkHeadingColourBlind"):$("#heading").addClass("darkHeading"),d3.select("#subHeading").selectAll("a").style("color","#FFFFFF"),d3.selectAll(".axis").selectAll("line").style("stroke","#FFFFFF"),d3.selectAll(".node").style("fill","#FFFFFF"),d3.selectAll(".uppercaseHeading").style("fill","#FFFFFF"),d3.selectAll(".loading-text").style("color","#DFEC51"),d3.selectAll(".cancel").style("background-color","#5E5E5E").style("color","#DFEC51").style("border","2px solid #DFEC51"),d3.selectAll(".continue").style("background-color","#DFEC51").style("color","#2E2E2E"),d3.selectAll(".object-one").transition().style("background-color","#56A32A"),d3.selectAll(".object-two").transition().style("background-color","#DFEC51"),d3.selectAll(".node").style("fill","#FFFFFF").on("mouseover",e=>{svgZoomValue=d3.zoomTransform(d3.select("#parentSVG").node()),d3.selectAll(".node").each(function(e){e.target=e.source=!1}),context.save(),context.translate(-width/2,-height/2),context.clearRect(0,0,width,height),context.translate(svgZoomValue.x,svgZoomValue.y),context.scale(svgZoomValue.k,svgZoomValue.k),context.translate(width/2,height/2),dataTable.forEach(t=>{t.source=t[0],t.target=t[t.length-1],context.beginPath(),canvasLine(t),context.lineWidth=1,t.target===e?(t.source.source=!0,context.globalAlpha=1,context.strokeStyle="#4CD964"):t.source===e?(t.target.target=!0,context.globalAlpha=1,context.strokeStyle="#FF2D55"):(context.globalAlpha=.05,context.strokeStyle="#FFFFFF"),context.stroke()}),context.restore(),d3.selectAll(".node").style("font-weight",e=>e.target||e.source?700:400).style("fill",e=>e.target?"#FF2D55":e.source?"#4CD964":"#FFFFFF")}).on("mouseout",e=>{svgZoomValue=d3.zoomTransform(d3.select("#parentSVG").node()),context.save(),context.translate(-width/2,-height/2),context.clearRect(0,0,width,height),context.translate(svgZoomValue.x,svgZoomValue.y),context.scale(svgZoomValue.k,svgZoomValue.k),context.translate(width/2,height/2),dataTable.forEach(e=>{e.source=e[0],e.target=e[e.length-1],context.globalAlpha=.2,context.beginPath(),canvasLine(e),context.lineWidth=1,context.strokeStyle="#FFFFFF",context.stroke()}),context.restore(),d3.selectAll(".node").style("fill","#FFFFFF").style("font-weight",400)}),d3.selectAll(".arcs").on("mouseover",e=>{svgZoomValue=d3.zoomTransform(d3.select("#parentSVG").node()),d3.selectAll(".node").each(function(e){e.target=e.source=e.internal=!1}),context.save(),context.translate(-width/2,-height/2),context.clearRect(0,0,width,height),context.translate(svgZoomValue.x,svgZoomValue.y),context.scale(svgZoomValue.k,svgZoomValue.k),context.translate(width/2,height/2),dataTable.forEach(t=>{t.source=t[0],t.target=t[t.length-1],context.beginPath(),canvasLine(t),context.lineWidth=1,t.target.data.group===e.key&&t.source.data.group===e.key?(t.source.internal=!0,t.target.internal=!0,context.globalAlpha=.5,context.strokeStyle="#34AADC"):t.target.data.group===e.key?(t.source.source=!0,context.globalAlpha=.5,context.strokeStyle="#4CD964"):t.source.data.group===e.key?(t.target.target=!0,context.globalAlpha=.5,context.strokeStyle="#FF2D55"):(context.globalAlpha=.05,context.strokeStyle="#FFFFFF"),context.stroke()}),context.restore(),d3.selectAll(".node").style("font-weight",e=>e.target||e.source?700:400).style("fill",e=>e.internal?"#34AADC":e.source?"#4CD964":e.target?"#FF2D55":"#FFFFFF")}).on("mouseout",e=>{svgZoomValue=d3.zoomTransform(d3.select("#parentSVG").node()),context.save(),context.translate(-width/2,-height/2),context.clearRect(0,0,width,height),context.translate(svgZoomValue.x,svgZoomValue.y),context.scale(svgZoomValue.k,svgZoomValue.k),context.translate(width/2,height/2),dataTable.forEach(e=>{e.source=e[0],e.target=e[e.length-1],context.globalAlpha=.2,context.beginPath(),canvasLine(e),context.lineWidth=1,context.strokeStyle="#FFFFFF",context.stroke()}),context.restore(),d3.selectAll(".node").style("fill","#FFFFFF").style("font-weight",400)}),d3.selectAll(".sankeyLink").style("stroke","#FFFFFF")):(d3.select("body").style("background-color","#FFFFFF").style("color","#2E2E2E"),d3.selectAll(".set>a").style("border-bottom","2px solid #DDDDDD"),d3.selectAll(".sectionDepTypesHeading").style("background-color","#CCCCCC"),d3.selectAll(".tags").style("background-color","#CCCCCC"),d3.selectAll(".optionsGroup").style("background-color","#CCCCCC"),d3.selectAll(".tab").style("background-color","#CCCCCC"),d3.selectAll(".tabLinks").style("background-color","#CCCCCC"),$(".tab").children().css("background-color","#DDDDDD").css("color","#2E2E2E").hover(function(){$(this).css("background-color","#EEEEEE")},function(){$(this).hasClass("active")?$(this).css("background-color","#CCCCCC"):$(this).css("background-color","#DDDDDD")}),$(".tab").children(".active").css("background-color","#CCCCCC").css("color","#2E2E2E"),d3.selectAll(".loading-text").style("color","#56A32A"),d3.selectAll(".cancel").style("background-color","#FFFFFF").style("color","#56A32A").style("border","2px solid #56A32A"),d3.selectAll(".continue").style("background-color","#56A32A").style("fill","#FFFFFF"),d3.selectAll(".object-one").transition().style("background-color","#56A32A"),d3.selectAll(".object-two").transition().style("background-color","#9AC73D"),$("#heading").removeClass(),$("#checkColourblind").is(":checked")?$("#heading").addClass("lightHeadingColourBlind"):$("#heading").addClass("lightHeading"),d3.select("#subHeading").selectAll("a").style("color","#2E2E2E"),d3.selectAll(".axis").selectAll("line").style("stroke","#2E2E2E"),d3.selectAll(".node").style("fill","#2E2E2E"),d3.selectAll(".uppercaseHeading").style("fill","#2E2E2E"),d3.selectAll(".node").style("fill","#2E2E2E").on("mouseover",e=>{svgZoomValue=d3.zoomTransform(d3.select("#parentSVG").node()),d3.selectAll(".node").each(function(e){e.target=e.source=!1}),context.save(),context.translate(-width/2,-height/2),context.clearRect(0,0,width,height),context.translate(svgZoomValue.x,svgZoomValue.y),context.scale(svgZoomValue.k,svgZoomValue.k),context.translate(width/2,height/2),dataTable.forEach(t=>{t.source=t[0],t.target=t[t.length-1],context.beginPath(),canvasLine(t),context.lineWidth=1,t.target===e?(t.source.source=!0,context.globalAlpha=1,context.strokeStyle="#4CD964"):t.source===e?(t.target.target=!0,context.globalAlpha=1,context.strokeStyle="#FF2D55"):(context.globalAlpha=.05,context.strokeStyle="#2E2E2E"),context.stroke()}),context.restore(),d3.selectAll(".node").style("font-weight",e=>e.target||e.source?700:400).style("fill",e=>e.target?"#FF2D55":e.source?"#4CD964":"#2E2E2E")}).on("mouseout",e=>{svgZoomValue=d3.zoomTransform(d3.select("#parentSVG").node()),context.save(),context.translate(-width/2,-height/2),context.clearRect(0,0,width,height),context.translate(svgZoomValue.x,svgZoomValue.y),context.scale(svgZoomValue.k,svgZoomValue.k),context.translate(width/2,height/2),dataTable.forEach(e=>{e.source=e[0],e.target=e[e.length-1],context.globalAlpha=.2,context.beginPath(),canvasLine(e),context.lineWidth=1,context.strokeStyle="#2E2E2E",context.stroke()}),context.restore(),d3.selectAll(".node").style("fill","#2E2E2E").style("font-weight",400)}),d3.selectAll(".arcs").on("mouseover",e=>{svgZoomValue=d3.zoomTransform(d3.select("#parentSVG").node()),d3.selectAll(".node").each(function(e){e.target=e.source=e.internal=!1}),context.save(),context.translate(-width/2,-height/2),context.clearRect(0,0,width,height),context.translate(svgZoomValue.x,svgZoomValue.y),context.scale(svgZoomValue.k,svgZoomValue.k),context.translate(width/2,height/2),dataTable.forEach(t=>{t.source=t[0],t.target=t[t.length-1],context.beginPath(),canvasLine(t),context.lineWidth=1,t.target.data.group===e.key&&t.source.data.group===e.key?(t.source.internal=!0,t.target.internal=!0,context.globalAlpha=.5,context.strokeStyle="#007AAF"):t.target.data.group===e.key?(t.source.source=!0,context.globalAlpha=.5,context.strokeStyle="#4CD964"):t.source.data.group===e.key?(t.target.target=!0,context.globalAlpha=.5,context.strokeStyle="#FF2D55"):(context.globalAlpha=.05,context.strokeStyle="#2E2E2E"),context.stroke()}),context.restore(),d3.selectAll(".node").style("font-weight",e=>e.target||e.source?700:400).style("fill",e=>e.internal?"#007AAF":e.source?"#4CD964":e.target?"#FF2D55":"#2E2E2E")}).on("mouseout",e=>{svgZoomValue=d3.zoomTransform(d3.select("#parentSVG").node()),context.save(),context.translate(-width/2,-height/2),context.clearRect(0,0,width,height),context.translate(svgZoomValue.x,svgZoomValue.y),context.scale(svgZoomValue.k,svgZoomValue.k),context.translate(width/2,height/2),dataTable.forEach(e=>{e.source=e[0],e.target=e[e.length-1],context.globalAlpha=.2,context.beginPath(),canvasLine(e),context.lineWidth=1,context.strokeStyle="#2E2E2E",context.stroke()}),context.restore(),d3.selectAll(".node").style("fill","#2E2E2E").style("font-weight",400)}),d3.selectAll(".sankeyLink").style("stroke","#2E2E2E"))}function adjustHeatmapColour(){colourSchemeHeatmap.range(["#FFFFFF",$("#selectHeatmapColour").children("option:selected").val()]),d3.selectAll("#heatmapRect").transition().style("fill",e=>e.source!=e.target||$("#checkInternal").is(":checked")?colourSchemeHeatmap(e.value):"#CCCCCC")}function adjustRingColour(){colourSchemeRing.interpolator(d3[$("#selectRingColour").children("option:selected").val()]),colourSchemeSankey.interpolator(d3[$("#selectRingColour").children("option:selected").val()]),d3.selectAll(".arcs").each(function(e,t){d3.select(this).transition().style("fill",colourSchemeRing(t)),d3.select("#text"+t).select("textPath").transition().style("fill",d3.hsl(colourSchemeRing(t)).l<.64?"#FFFFFF":"#333333")}),d3.selectAll(".sankeyNodeRect").transition().style("fill",e=>colourSchemeSankey(sankeyProjects.indexOf(e.project))),d3.selectAll(".sankeyNodeText").transition().style("fill",(e,t)=>d3.hsl(colourSchemeSankey(sankeyProjects.indexOf(e.project))).l<.64?"#FFFFFF":"#2E2E2E")}function selectAllDependencies(){$("#depList a").removeClass("unselectedDependency").addClass("selectedDependency"),updateDependencyText()}function clearAllDependencies(){$("#depList a").removeClass("selectedDependency").addClass("unselectedDependency"),updateDependencyText()}function addSubquery(){d3.select("#subqueryContainer").append("div").attr("id","tempSubqueryContainer"),document.getElementById("subqueryContainer").childElementCount>1&&d3.select("#tempSubqueryContainer").append("div").attr("class","subquery uppercaseHeading operator").append("p").text("AND"),d3.select("#tempSubqueryContainer").append("div").attr("class","subqueryGrid subqueryDiv uppercaseHeading optionsGroup").attr("id","tempsubqueryId").attr("width","100%"),d3.select("#tempsubqueryId").append("text").attr("class","subqueryOne").text("Jira Field"),d3.select("#tempsubqueryId").append("text").attr("class","subqueryTwo").text("Dependency Type"),d3.select("#tempsubqueryId").append("text").attr("class","subqueryThree").text("Is / Is Not"),d3.select("#tempsubqueryId").append("text").attr("class","subqueryFour").text("Operator"),d3.select("#tempsubqueryId").append("text").attr("class","subqueryFive").text("Value"),d3.select("#tempsubqueryId").append("i").attr("class","fa fa-times deleteDiv subquerySix").attr("onclick","deleteDiv(this)"),d3.select("#tempsubqueryId").append("select").attr("class","subqueryOne jiraField").attr("id","subqueryJiraField"),d3.select("#tempsubqueryId").append("select").attr("class","subqueryTwo").attr("id","subqueryType").selectAll("option").data(["Received","Raised","Both"]).enter().append("option").text(e=>e).attr("value",e=>e),d3.select("#tempsubqueryId").append("select").attr("class","subqueryThree").attr("id","subqueryIsIsNot").selectAll("option").data(["Is","Is Not"]).enter().append("option").text(e=>e).attr("value",e=>e),d3.select("#tempsubqueryId").append("select").attr("class","subqueryFour").attr("id","subqueryOperator").selectAll("option").data(["Like","Exactly"]).enter().append("option").text(e=>e).attr("value",e=>e),d3.select("#tempsubqueryId").append("input").attr("class","subqueryFive").attr("id","subqueryValue"),searchFields=customFields.filter(e=>e.searchable&&"Project"==e.name).sort((e,t)=>{let o=0;return e.name>t.name?o=1:e.name<t.name&&(o=-1),o}),d3.select("#tempsubqueryId").select("#subqueryJiraField").selectAll("option").data(searchFields).enter().append("option").text(e=>e.name).attr("value",e=>e.id),d3.select("#tempSubqueryContainer").attr("id",null),d3.select("#tempsubqueryId").attr("id",null),adjustDarkMode()}function deleteDiv(e){e.parentNode.parentNode.remove(),(1==document.getElementById("subqueryContainer").childElementCount||document.getElementById("subqueryContainer").firstChild.firstChild.classList.contains("operator"))&&d3.select(".operator").remove()}function cleanArray(e){return e.forEach(e=>{e.project&&(e.project=e.project.name)}),e}function openTab(e,t){var o,a,r;for(a=document.getElementsByClassName("tabcontent"),o=0;o<a.length;o++)a[o].style.display="none";for(r=document.getElementsByClassName("tablinks"),o=0;o<r.length;o++)r[o].className=r[o].className.replace(" active","");document.getElementById(t).style.display="block",e.currentTarget.className+=" active",$("#parentCanvas").position()&&d3.select("#chart").select("#parentSVG").style("top",$("#parentCanvas").position().top).style("left",$("#parentCanvas").position().left),d3.selectAll(".sankeyNodeText").attr("display",function(e){return d3.select(this).node().getBBox().height>e.y1-e.y0?"none":null}),adjustDarkMode()}function pickTextColorBasedOnBgColor(e,t,o){var a="#"===(e=d3.color(e).formatHex()).charAt(0)?e.substring(1,7):e;return.299*parseInt(a.substring(0,2),16)+.587*parseInt(a.substring(2,4),16)+.114*parseInt(a.substring(4,6),16)>186?o:t}$(function(){d3.select("#chart").append("svg").attr("width",width).attr("height",height).append("g").attr("id","container").attr("transform","translate("+width/2+","+height/2+")"),d3.select("#tableChart").append("svg").attr("width",Math.min(width,height)).attr("height",Math.min(width,height)).append("g").attr("id","tableContainer"),d3.select("#sankeyChart").append("svg").attr("width",width).attr("height",height).append("g").attr("id","sankeyContainer"),document.getElementsByClassName("defaultOpen")[0].click(),d3.selectAll(".tablinks").style("opacity",0).style("pointer-events","none"),rootSVG=d3.select("#tableChart").select("svg"),rootRingSVG=d3.select("#chart").select("svg"),rootSankeySVG=d3.select("#sankeyChart").select("svg"),rootForceSVG=d3.select("#forceContainer"),scr={x:window.scrollX,y:window.scrollY,w:window.innerWidth,h:window.innerHeight},body_sel=d3.select("body"),body={w:body_sel.node().offsetWidth,h:body_sel.node().offsetHeight},svgpos=getNodePos(rootSVG.node()),svgRingpos=getNodePos(rootRingSVG.node()),svgSankeypos=getNodePos(rootSankeySVG.node()),dist={x:20,y:-10},chart=$("#tableChart").position(),header=d3.select(".banner").node().getBoundingClientRect(),width=d3.select("#boardChart").node().getBoundingClientRect().width,startLoading()});