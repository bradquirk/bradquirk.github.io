var dataset={nodes:[{name:"Customer Requests",order:0,colorOrder:0,commentary:"We are inundated with customer requests, which is fantastic, but we never have the capacity to address them. Unfortunately the vast majority are thrown out before we have a chance to evaluate them."},{name:"Executive Requests",order:1,colorOrder:1,commentary:"Our senior leadership team collectively have decades of industry experience and knowledge, as such their ideas usually take priority and are evaluated accordingly."},{name:"Annual SteerCo Planning",order:2,colorOrder:2,commentary:"Our annual business strategy sessions are very labour-intensive, with months of preparation required from key stakeholders to ensure the agenda is followed. If we don't get this perfect every time this can have a major impact on everything downstream."},{name:"Expedited Requests",order:3,colorOrder:3,commentary:"We have reserved capacity for high-priority requests from our senior leadership team when the time arises. This can be due to regulatory changes, significant market shifts or other 'pet projects'."},{name:"BAU Helpdesk Requests",order:5,colorOrder:5,commentary:"We pride ourselves on our customer service, but the tools we have in place to triage issues are very primative. More often than not we have to request additional information from our customers which can lead to friction."},{name:"Quarterly Product Increment (PI) Planning",order:4,colorOrder:4,commentary:"Similar to our SteerCo planning, our quarterly tribe PI planning has a lot of overhead attached to the event. We are still finding our feet with regards to getting good outcomes but ideally we want to shift to continuous planning."},{name:"External Vendor Build",order:6,colorOrder:9,commentary:"One of our key features was hastily built using a whitelabel product from a third party vendor, and as such they are contracted to employ quality checks on any changes made to this space. We don't use the same tools so we have little insight as to their day-to-day progress."},{name:"Component Squad #1 Build",order:7,colorOrder:6,commentary:"This squad is responsible for maintaining the CMS features on our platform, of which there are several. Our CMS was built using a whitelabel product from a third party vendor and as such this team is unable to prepare their releases without constant delays."},{name:"Component Squad #2 Build",order:8,colorOrder:7,commentary:"This squad is arguably the most mature with their agile ways of working. They have a clear runway to deploy new features and are fantastic at breaking down their work. We wish to emulate their practices elsewhere."},{name:"Component Squad #3 Build",order:9,colorOrder:8,commentary:"When this team first started they were the highest performing, so we gave them additional responsibilities. Since then the team has lost some original members and as such they have slipped to the back of the pack. They rarely deliver on time due to constant rework on their features."},{name:"Integration & Staging",order:10,colorOrder:10,commentary:"Unfortunately our biggest bottleneck is our release process, which is on a monthly basis. Some of our teams would be capable of deploying new features faster if they had their own runway but we are held back by legacy architecture principles."},{name:"Feature Release",order:11,colorOrder:11,commentary:"Once our features have been released we have no methods in place to measure their success outside of tracking monthly revenue. We feel like this is a huge missed opportunity to close the feedback loop and learn more about our customers."}],links:[{source:0,target:2,value:6,leadTime:1e6,size:13,throughput:.05,defectRate:.05,discardRate:.8,leadtimeText:"500 bus. days",wipText:"300 Requests",throughputText:"20 Initiatives / Year",workItemInput:"Requests",workItemOutput:"Initiatives"},{source:1,target:2,value:3,leadTime:1e6,size:13,throughput:.02,defectRate:.1,discardRate:.2,leadtimeText:"150 bus. days",wipText:"100 Requests",throughputText:"5 Initiatives / Quarter",workItemInput:"Requests",workItemOutput:"Initiatives"},{source:1,target:3,value:2,leadTime:.5,size:13,throughput:.01,defectRate:.05,discardRate:.01,leadtimeText:"20 bus. days",wipText:"2 Requests",throughputText:"1 Initiative / Quarter",workItemInput:"Requests",workItemOutput:"Initiatives"},{source:2,target:5,value:9,leadTime:1e6,size:8,throughput:.03,defectRate:.1,discardRate:.1,leadtimeText:"60 bus. days",wipText:"6 Initiatives",throughputText:"3 Features / Quarter",workItemInput:"Initiatives",workItemOutput:"Features"},{source:5,target:7,value:3,leadTime:1e3,size:5,throughput:.01,defectRate:.1,discardRate:.1,leadtimeText:"5 bus. days",wipText:"5 Features",throughputText:"20 Epics / Quarter",workItemInput:"Features",workItemOutput:"Epics"},{source:7,target:6,value:3,leadTime:1e3,size:3,throughput:.03,defectRate:.2,discardRate:.2,leadtimeText:"20 bus. days",wipText:"2 Epics",throughputText:"25 User Stories / Month",workItemInput:"Epics",workItemOutput:"User Stories"},{source:5,target:8,value:3,leadTime:1e3,size:5,throughput:.01,defectRate:.2,discardRate:.2,leadtimeText:"7 bus. days",wipText:"3 Features",throughputText:"0.5 Epics / Day",workItemInput:"Features",workItemOutput:"Epics"},{source:5,target:9,value:3,leadTime:1e3,size:5,throughput:.01,defectRate:.05,discardRate:.2,leadtimeText:"5 bus. days",wipText:"4 Features",throughputText:"4 Epics / Day",workItemInput:"Features",workItemOutput:"Epics"},{source:4,target:9,value:2,leadTime:1e3,size:3,throughput:.03,defectRate:.5,discardRate:.6,leadtimeText:"700 bus. days",wipText:"300 Requests",throughputText:"8 User Stories / Month",workItemInput:"Requests",workItemOutput:"User Stories"},{source:3,target:9,value:2,leadTime:.5,size:8,throughput:.01,defectRate:.05,discardRate:.01,leadtimeText:"10 bus. days",wipText:"4 Initiatives",throughputText:"15 Epics / Month",workItemInput:"Initiatives",workItemOutput:"Epics"},{source:6,target:10,value:3,leadTime:1e4,size:3,throughput:.005,defectRate:.4,discardRate:.5,leadtimeText:"30 bus. days",wipText:"60 User Stories",throughputText:"15 User Stories / Month",workItemInput:"User Stories",workItemOutput:"Features"},{source:8,target:10,value:3,leadTime:1e3,size:3,throughput:.03,defectRate:.05,discardRate:.2,leadtimeText:"5 bus. days",wipText:"2 Epics",throughputText:"40 User Stories / Month",workItemInput:"Epics",workItemOutput:"User Stories"},{source:9,target:10,value:7,leadTime:1e6,size:3,throughput:.1,defectRate:.7,discardRate:.2,leadtimeText:"30 bus. days",wipText:"20 Epics",throughputText:"15 User Stories / Month",workItemInput:"Epics",workItemOutput:"User Stories"},{source:10,target:11,value:13,leadTime:1e4,size:13,throughput:.003,defectRate:.3,discardRate:.1,leadtimeText:"20 bus. days",wipText:"80 User Stories",throughputText:"1 Releases / Month",workItemInput:"User Stories",workItemOutput:"Releases"}]};const formatNumber=d3.format(",.0f"),format=t=>`${formatNumber(t)} Days`,color=d3.scaleSequential().interpolator(d3.interpolateCool).domain([0,dataset.nodes.length-1]);var widthFactor,heightFactor;/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)||/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.platform)?(widthFactor=5,heightFactor=1.2):(widthFactor=2,heightFactor=.8);const margin={top:100,right:30,bottom:20,left:30},width=$("#chart").innerWidth()*widthFactor-margin.left-margin.right-parseFloat($(".container").css("padding-left"))-parseFloat($(".container").css("padding-right")),height=$(window).innerHeight()*heightFactor-margin.top-margin.bottom,canvas=d3.select("#chart").append("canvas").style("position","relative").style("top",margin.top+"px").style("left",margin.left+"px").attr("width",width).attr("height",height).style("pointer-events","none"),svg=d3.select("#chart").append("svg").style("position","absolute").attr("width",width).attr("height",height).style("left",0).style("top",0),sankey=d3.sankey().nodeWidth(15).nodePadding(80).nodeAlign(d3.sankeyCenter).nodeSort((t,e)=>t.order-e.order).iterations(1e3).size([width-margin.left-margin.right,height-margin.top-margin.bottom]);var graph=sankey(dataset);const link=svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")").selectAll("path").data(dataset.links).enter().append("path").attr("class","link").attr("d",d3.sankeyLinkHorizontal()).style("stroke-width",t=>Math.max(1,t.width)).on("mouseover",function(){return tooltip.style("visibility","visible")}).on("mousemove",function(t,e){var r,a;r=t.defectRate>.4?"red":"white",a=t.discardRate>.2?"red":"white";var o=d3.mouse(root.node());scr.x=window.scrollX,scr.y=window.scrollY,o[0]+=svgpos.x,o[1]+=svgpos.y,tooltip.style("right",""),tooltip.style("left",""),tooltip.style("bottom",""),tooltip.style("top",""),tooltip.html("<h5>From <span style='color:"+t.source.color+";'>"+t.source.name+"</span> to <br><span style='color:"+t.target.color+";'>"+t.target.name+"</h5><hr>From <span style='color:"+t.source.color+";'>"+t.workItemInput+"</span> to <span style='color:"+t.target.color+";'>"+t.workItemOutput+"</span><hr>WIP: "+t.wipText+"<br>Lead Time: "+t.leadtimeText+"<br>Throughput: "+t.throughputText+"<br>Defect Rate: <span style='color:"+r+";'>"+d3.format(".0%")(t.defectRate)+"</span><br>Discard Rate: <span style='color:"+a+";'>"+d3.format(".0%")(t.discardRate)+"</span><br>"),o[0]>scr.x+scr.w/2?tooltip.style("right",body.w-o[0]+dist.x+margin.right+"px"):tooltip.style("left",o[0]+dist.x+margin.left-chart.left+"px"),o[1]>scr.y+scr.h/2?tooltip.style("bottom",body.h-o[1]+dist.y+"px"):tooltip.style("top",o[1]+dist.y+"px"),tooltip.style("visibility","visible")}).on("mouseout",function(){return tooltip.style("visibility","hidden")}),node=svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")").selectAll(".node").data(dataset.nodes).enter().append("g").attr("class","node").attr("transform",t=>`translate(${t.x0},${t.y0})`).call(d3.drag().subject(t=>t).on("start",function(){this.parentNode.appendChild(this)}).on("drag",dragmove)).on("mouseover",function(){return tooltip.style("visibility","visible")}).on("mousemove",function(t,e){var r,a;r=t.targetLinks.length>2?"red":"white",a=t.sourceLinks.length>2?"red":"white";var o=d3.mouse(root.node());scr.x=window.scrollX,scr.y=window.scrollY,o[0]+=svgpos.x,o[1]+=svgpos.y,tooltip.style("right",""),tooltip.style("left",""),tooltip.style("bottom",""),tooltip.style("top",""),tooltip.html("<h5><span style='color:"+t.color+";'>"+t.name+"</span></h5><hr>Stream Inputs: <span style='color:"+r+";'>"+t.targetLinks.length+"</span><br>Stream Outputs: <span style='color:"+a+";'>"+t.sourceLinks.length+"</span><hr><i>"+t.commentary+"</i>"),o[0]>scr.x+scr.w/2?tooltip.style("right",body.w-o[0]+dist.x+margin.right+"px"):tooltip.style("left",o[0]+dist.x+margin.left-chart.left+"px"),o[1]>scr.y+scr.h/2?tooltip.style("bottom",body.h-o[1]+dist.y+"px"):tooltip.style("top",o[1]+dist.y+"px"),tooltip.style("visibility","visible")}).on("mouseout",function(){return tooltip.style("visibility","hidden")});link.attr("d",d3.sankeyLinkHorizontal()),sankey.update(graph),node.append("rect").attr("height",t=>t.y1-t.y0).attr("width",t=>t.x1-t.x0).style("fill",(t,e)=>(t.color=color(t.colorOrder),t.color)).style("stroke","none").append("text").text(t=>`${t.name}\n${format(t.value)}`),node.append("text").attr("x",0).attr("dy","-.35em").attr("text-anchor","middle").attr("transform",null).text(t=>t.name).style("fill",t=>color(t.colorOrder)).style("text-background",(t,e)=>(t.color=color(t.colorOrder),t.color)).text(t=>t.name).call(wrap,10);var tooltip=d3.select("#chart").append("div").attr("id","tooltip").style("position","absolute").style("visibility","hidden");function dragmove(t){var e=d3.select(this).select("rect").attr("y"),r=d3.select(this).select("rect").attr("x");t.x0=t.x0+d3.event.dx,t.x1=t.x1+d3.event.dx,t.y0=t.y0+d3.event.dy,t.y1=t.y1+d3.event.dy;var a=t.y0-e,o=t.x0-r;d3.select(this).attr("transform","translate("+o+","+a+")"),link.attr("d",d3.sankeyLinkHorizontal()),sankey.update(graph)}var root=d3.select("svg"),scr={x:window.scrollX,y:window.scrollY,w:window.innerWidth,h:window.innerHeight},body_sel=d3.select("#chart"),body={w:body_sel.node().offsetWidth,h:body_sel.node().offsetHeight},doc={w:document.width,h:document.height},svgpos=getNodePos(root.node()),dist={x:10,y:10},chart=$("#chart").position();const particleSize=d3.scaleLinear().domain(d3.extent(dataset.links,t=>t.size)).range([5,20]);dataset.links.forEach(t=>{t.particleSize=t.size,t.particleColor=d3.scaleLinear().domain([0,1]).range([t.source.color,t.target.color]),t.defectAlpha=d3.scaleLinear().domain([0,1]).range([1,0])});const t=d3.timer(tick,1e3);let particles=[];function tick(t,e){particles=particles.filter(t=>t.current<t.path.getTotalLength()),d3.selectAll("path.link").each(function(e){for(let r=0;r<2;r+=1){const r=(Math.random()-.5)*(e.width-2*e.size),a=Math.random()<=e.defectRate?1:0,o=Math.random()<=e.discardRate?1:0;Math.random()<e.throughput&&particles.push({link:e,time:t,offset:r,path:this,defect:a,discard:o,speed:1/e.leadTime+Math.random()})}}),particleEdgeCanvasPath(t)}function particleEdgeCanvasPath(t){const e=d3.select("canvas").node().getContext("2d");e.clearRect(0,0,width,height),e.fillStyle="gray",e.lineWidth="1px";for(const a in particles)if({}.hasOwnProperty.call(particles,a)){const o=t-particles[a].time;particles[a].current=.15*o*particles[a].speed;var r=particles[a].path.getPointAtLength(particles[a].current);e.beginPath(),1==particles[a].defect?(e.fillStyle="red",e.globalAlpha=1,r=particles[a].path.getPointAtLength(particles[a].path.getTotalLength()-particles[a].current)):(e.fillStyle=particles[a].link.particleColor(particles[a].current/particles[a].path.getTotalLength()),1==particles[a].discard?particles[a].current>.74*particles[a].path.getTotalLength()?e.globalAlpha=0:e.globalAlpha=particles[a].link.defectAlpha(particles[a].current/(.75*particles[a].path.getTotalLength())):e.globalAlpha=1),e.arc(r.x+particles[a].link.particleSize,r.y+particles[a].offset,particles[a].link.particleSize,0,2*Math.PI),e.fill()}}function piecewise(t,e){for(var r=0,a=e.length-1,o=e[0],i=new Array(a<0?0:a);r<a;)i[r]=t(o,o=e[++r]);return function(t){var e=Math.max(0,Math.min(a-1,Math.floor(t*=a)));return i[e](t-e)}}function wrap(t,e){t.each(function(){for(var t,r=d3.select(this),a=r.text().split(/\s+/).reverse(),o=a.length,i=[],s=0,n=r.attr("x"),l=r.attr("y"),d=r.text(null).append("tspan").attr("x",n).attr("y",l).attr("dy","0em");t=a.pop();)s++,i.push(t),d.text(i.join(" ")),d.node().getComputedTextLength()>e&&(i.pop(),d.text(i.join(" ")),i=[t],d=r.append("tspan").attr("class",s).attr("x",0).attr("y",t=>1==s?1.2*-o-.35+"em":l).attr("dx",sankey.nodeWidth()/2).attr("dy","1.2em").text(t))})}function getNodePos(t){for(var e=d3.select("body").node(),r=0,a=0;null!=t&&t!=e;r+=t.offsetLeft||t.clientLeft,a+=t.offsetTop||t.clientTop,t=t.offsetParent||t.parentNode);return{x:r,y:a}}