d3.csv("/assets/csv/projects/cycletimehorizon.csv").then(function(e){var t="#00FFFF",a="#00FFA1",r={xAxis:"white",releaseLine:"white",mouseoverSelectedNode:t,mouseoverConnectedNode:a,mouseoverUnconnectedNode:"#FBB03B",nodeColour:"#2E2E2E",nodeOpacity:.2,nodeSelectedOpacity:.2,nodeUnselectedOpacity:.1,linkOpacity:.7,linkSelectedOpacity:1,linkUnselectedOpacity:.1},n=d3.utcParse("%Y-%m-%dT%H:%M:%S"),o=d3.timeFormat("%Y-%m-%d"),s=(d3.timeFormat("%d-%m-%Y"),d3.timeParse("%Y-%m-%d")),l=o(n(0));e.forEach(function(e){e.key=e.Key,e.inProgressDate=o(n(e["First In Progress Date"])),e.resolvedDate=o(n(e["Last Resolved Date"]))});var c=d3.nest().key(e=>e.inProgressDate).sortKeys(d3.ascending).key(e=>e.resolvedDate).sortKeys(d3.ascending).rollup(e=>e.length).entries(e);c.forEach((e,t)=>{if(e.key!=l){for(var a=0;a<e.values.length;a++)e.values[a].key!=l&&(e.source=s(e.key),e.target=s(e.values[a].key),e.count=e.values[a].value);delete e.key,delete e.values}});var d=d3.nest().key(e=>e.resolvedDate).sortKeys(d3.ascending).rollup(e=>e.length).entries(e),i=0;d.forEach((e,t)=>{e.key==l?d.shift():e.key=s(e.key),0==t?i=e.value:i+=e.value,e.cfd=i});var y=d;y.sort((e,t)=>d3.ascending(e.key,t.key)),y=y.filter(e=>o(e.key)!=l);var u=20,p=40,g=40,k=40,m=$("#cycleChart").width()-k-p,v=.3*$(window).innerHeight()-u-g,f=d3.select("#cycleChart").append("svg").attr("width",m+k+p).attr("height",v+u+g).append("g").attr("transform","translate("+k+","+u+")");f.append("text").attr("id","wew").attr("text-anchor","middle").attr("transform","translate("+m/2+",0)").attr("dy","0.35em").text("Lifecyle (Cycle Time) of Each Release");var h=d3.scaleTime().range([0,m]),x=d3.scaleLinear().range([v,0]);h.domain([d3.min(c,e=>e.source),d3.max(c,e=>e.target)]),x.domain([0,d3.max(c,e=>e.count)]);var N=d3.scaleLinear().domain(d3.extent(y,e=>e.value)).range([5,15]),A=d3.scaleSequential().interpolator(Y(d3.interpolateHcl,["#D19E1F","#CC3B43"])).domain(d3.extent(c,e=>h(e.target)-h(e.source))),w=d3.scaleSequential().interpolator(Y(d3.interpolateHcl,["#6D469D","#37B96A"])).domain(d3.extent(y,(e,t)=>t)),C=d3.scaleLinear().domain(d3.extent(c,e=>h(e.target)-h(e.source))).range([t,a]),L=d3.scaleLinear().domain(d3.extent(c,e=>e.count)).range([2,5]),P=d3.arc().innerRadius(e=>(h(e.target)-h(e.source))/2-L(e.count)).outerRadius(e=>(h(e.target)-h(e.source))/2),F=d3.arc().innerRadius(e=>0).outerRadius(e=>N(e.value)),D=f.append("g").selectAll("path").data(c).enter().append("path").attr("class","arc").attr("id",e=>"inProgress_"+o(e.source)+"_"+o(e.target)).attr("source",e=>o(e.source)).attr("target",e=>o(e.target)).attr("transform",e=>"translate("+(h(e.target)-(h(e.target)-h(e.source))/2)+","+v+")").style("fill",e=>A(h(e.target)-h(e.source))).style("opacity",r.linkOpacity).attr("d",P.startAngle(1.5*Math.PI).endAngle(2.5*Math.PI)).on("mouseover",e=>{R.style("stroke",function(t){return o(t.key)===o(e.target)?r.mouseoverConnectedNode:r.mouseoverUnconnectedNode}).style("opacity",function(t){return o(t.key)===o(e.target)?1:0}),I.style("fill",function(t){return o(t.key)===o(e.target)?r.mouseoverConnectedNode:r.mouseoverUnconnectedNode}).style("opacity",function(t){return o(t.key)===o(e.target)?1:0}),S.style("fill",function(t){return o(t.key)===o(e.target)?r.mouseoverConnectedNode:r.mouseoverUnconnectedNode}).style("opacity",function(t){return o(t.key)===o(e.target)?1:0}),O.style("fill",function(t){return o(t.source)===o(e.source)&&o(t.target)===o(e.target)?C(h(t.target)-h(t.source)):A(h(t.target)-h(t.source))}).style("opacity",function(t){return o(t.source)===o(e.source)&&o(t.target)===o(e.target)?1:0})}).on("mouseout",e=>{K()}),E={};c.forEach(function(e){E[o(e.source)+","+o(e.target)]=e.count});f.append("g").attr("id","x").attr("class","axis").attr("transform","translate(0,"+v+")").style("pointer-events","none").call(d3.axisBottom(h));var M=f.append("g").selectAll("path").data(y).enter().append("path").attr("class","nodes").attr("id",e=>"node"+o(e.key)).attr("transform",e=>"translate("+h(e.key)+","+v+")").attr("d",F.startAngle(1.5*Math.PI).endAngle(2.5*Math.PI)).style("fill",(e,t)=>w(t)).attr("stroke",r.nodeColour).on("mouseover",e=>T(e)).on("mouseout",e=>K()),O=f.append("g").selectAll("path").data(c).enter().append("path").attr("class","arc").attr("id",e=>"inProgress_"+o(e.source)+"_"+o(e.target)).attr("source",e=>o(e.source)).attr("target",e=>o(e.target)).attr("transform",e=>"translate("+(h(e.target)-(h(e.target)-h(e.source))/2)+","+v+")").style("pointer-events","none").style("opacity",0).attr("d",P.startAngle(1.5*Math.PI).endAngle(2.5*Math.PI)),S=f.append("g").selectAll("circle").data(y).enter().append("circle").attr("class","nodeHighlight").attr("id",e=>"node"+o(e.key)).attr("transform",e=>"translate("+h(e.key)+","+v+")").attr("r",e=>N(e.value)).style("pointer-events","none").style("stroke","black").style("stroke-width",.25).style("opacity",0);d3.selectAll("#node0NaN-NaN-NaN").remove(),d3.selectAll("#node0NaN-NaN").remove(),d3.selectAll("#node0NaN").remove();var U=d3.select("#releaseChart").append("svg").attr("width",m+k+p).attr("height",v+u+g).append("g").attr("transform","translate("+k+","+u+")");U.append("text").attr("id","wew").attr("text-anchor","middle").attr("transform","translate("+m/2+",0)").attr("dy","0.35em").text("Cumulative Releases (Throughput) Over Time");var B=d3.scaleLinear().domain([0,y[y.length-1].cfd]).range([v,0]);U.append("g").attr("id","x").attr("class","axis").attr("transform","translate(0,"+v+")").style("pointer-events","none").call(d3.axisBottom(h)),U.append("g").attr("id","y").attr("class","axis").style("pointer-events","none").call(d3.axisLeft(B)),y.forEach((e,t)=>{0==t?U.append("line").attr("class","cfdLine").attr("x1",h.domain()[0]).attr("y1",B(0)).attr("x2",h(e.key)).attr("y2",B(e.cfd)).attr("stroke-width","2px").attr("stroke",w(t)):U.append("line").attr("class","cfdLine").attr("x1",h(y[t-1].key)).attr("y1",B(y[t-1].cfd)).attr("x2",h(e.key)).attr("y2",B(e.cfd)).attr("stroke-width","2px").attr("stroke",w(t))});U.append("g").selectAll("line").data(y).enter().append("line").attr("class","releaseLine").attr("x1",e=>h(e.key)).attr("y1",e=>B(0)).attr("x2",e=>h(e.key)).attr("y2",e=>B(e.cfd)+N(e.value)).attr("stroke-width","1px").attr("stroke-dasharray","2 2").style("opacity",r.nodeOpacity).attr("stroke",r.releaseLine).on("mouseover",e=>T(e)).on("mouseout",e=>K()),U.append("g").selectAll("circle").data(y).enter().append("circle").attr("class","nodes").attr("id",e=>"node"+o(e.key)).attr("cx",e=>h(e.key)).attr("cy",e=>B(e.cfd)).attr("r",e=>N(e.value)).style("fill",(e,t)=>w(t)).attr("stroke",r.nodeColour).attr("stroke-width","1px").on("mouseover",e=>T(e)).on("mouseout",e=>{K()});var I=U.append("g").selectAll("circle").data(y).enter().append("circle").attr("class","nodeHighlight").attr("id",e=>"node"+o(e.key)).attr("cx",e=>h(e.key)).attr("cy",e=>B(e.cfd)).attr("r",e=>N(e.value)).style("pointer-events","none").style("stroke","black").style("stroke-width",.25).style("opacity",0),R=U.append("g").selectAll("line").data(y).enter().append("line").attr("class","releaseLine").attr("x1",e=>h(e.key)).attr("y1",e=>B(0)).attr("x2",e=>h(e.key)).attr("y2",e=>B(e.cfd)+N(e.value)).style("pointer-events","none").style("stroke","black").style("stroke-width",.25).style("opacity",0);function H(e,t){return E[o(t.key)+","+o(e.key)]||o(e.key)==o(t.key)}function T(e){d3.select("#node"+o(e.key)).style("fill",r.mouseoverSelectedNode),R.style("stroke",function(t){return o(e.key)===o(t.key)?r.mouseoverSelectedNode:H(e,t)?r.mouseoverConnectedNode:r.mouseoverUnconnectedNode}).style("opacity",function(t){return o(e.key)===o(t.key)?1:0}),I.style("fill",function(t){return o(e.key)===o(t.key)?r.mouseoverSelectedNode:H(e,t)?r.mouseoverConnectedNode:r.mouseoverUnconnectedNode}).style("opacity",function(t){return o(e.key)===o(t.key)?1:0}),S.style("fill",function(t){return o(e.key)===o(t.key)?r.mouseoverSelectedNode:H(e,t)?r.mouseoverConnectedNode:r.mouseoverUnconnectedNode}).style("opacity",function(t){return o(e.key)===o(t.key)?1:0}),O.style("fill",function(t){return o(t.target)===o(e.key)||o(t.source)===o(e.key)?C(h(t.target)-h(t.source)):A(h(t.target)-h(t.source))}).style("opacity",function(t){return o(t.target)===o(e.key)?1:0})}function K(){M.style("fill",(e,t)=>w(t)).attr("stroke",r.nodeColour),R.style("opacity",0),I.style("opacity",0),S.style("opacity",0),D.style("fill",e=>A(h(e.target)-h(e.source))).style("opacity",r.linkOpacity),O.style("opacity",0)}function Y(e,t){for(var a=0,r=t.length-1,n=t[0],o=new Array(r<0?0:r);a<r;)o[a]=e(n,n=t[++a]);return function(e){var t=Math.max(0,Math.min(r-1,Math.floor(e*=r)));return o[t](e-t)}}});