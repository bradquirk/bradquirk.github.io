if(/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)||/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.platform))$("#chart").append('<img src="../../img/portfolio/cards/relationship-heatmap_card.png"/>'),$("#chart").append("<p>For the interactive version, please visit this site on desktop!</p>"),d3.select("#header").html("<h3 class='amber-text'>Relationship Heatmap</h3><h6>version 1.0</h6>");else{var margin={top:10,right:200,bottom:150,left:150},tooltipMargin={top:20,right:20,bottom:60,left:60},width=$("#chart").width()-margin.left-margin.right,height=.6*$(window).innerHeight()-margin.top-margin.bottom,tooltipWidth=.4*$(window).innerHeight()-tooltipMargin.left-tooltipMargin.right,tooltipHeight=.4*$(window).innerHeight()-tooltipMargin.top-tooltipMargin.bottom,tooltip=d3.select("#chart").append("div").attr("id","tooltip").style("max-width",1.2*tooltipWidth).style("position","absolute").style("visibility","hidden");tooltipSVG=tooltip.append("p").attr("id","tooltipText").attr("font-size","0.5em"),tooltipSVG=tooltip.append("svg").attr("width",tooltipWidth+tooltipMargin.left+tooltipMargin.right).attr("height",tooltipHeight+tooltipMargin.top+tooltipMargin.bottom).style("background-color","#333").append("g").attr("transform","translate("+tooltipMargin.left+","+tooltipMargin.top+")");var tooltipX=d3.scaleLinear().domain([0,1]).range([0,tooltipWidth]);tooltipSVG.append("g").attr("class","x axis").attr("transform","translate(0,"+tooltipHeight+")").call(d3.axisBottom(tooltipX)),tooltipSVG.append("text").attr("id","tooltipXText").attr("transform","translate("+tooltipWidth/2+" ,"+(tooltipHeight+tooltipMargin.top+20)+")").style("text-anchor","middle");var tooltipY=d3.scaleLinear().domain([0,1]).range([tooltipHeight,0]);tooltipSVG.append("g").attr("class","y axis").call(d3.axisLeft(tooltipY)),tooltipSVG.append("text").attr("id","tooltipYText").attr("transform","rotate(-90)").attr("x",0-tooltipHeight/2).attr("dy","1em").style("text-anchor","middle"),d3.select("#tooltipYText").attr("y",0-tooltipMargin.left),tooltipSVG.append("g").attr("id","scatterGroup");var PearsonPath=d3.line().x(t=>tooltipX(t.xValues)).y(t=>tooltipY(t.yValues));tooltipSVG.append("path").attr("id","tooltipLine").attr("stroke-width","1px").style("stroke","white"),tooltipSVG.append("text").append("textPath").attr("id","tooltipLineText").attr("xlink:href","#tooltipLine").attr("startOffset","50%").style("text-anchor","middle").style("fill","white").style("dy",-10);var dataTable=[];d3.csv("/assets/csv/projects/relationshipheatmap.csv").then(function(t){for(var e=d3.keys(t[0]).filter(function(t){return"key"!==t&&"index"!==t}),a=(e.length,0);a<e.length;a++)for(var o=0;o<e.length;o++){var i={},l=t.map(t=>+t[e[a]]),r=t.map(t=>+t[e[o]]);V(l,r,!0,i),l.filter((t,e,a)=>a.indexOf(t)===e).length>=3&&r.filter((t,e,a)=>a.indexOf(t)===e).length>=3&&dataTable.push({xName:e[a],yName:e[o],xValues:l,yValues:r,linReg:i,pearson:Math.pow(S(l,r),2)})}e=dataTable.map(t=>t.xName).filter((t,e,a)=>a.indexOf(t)===e);var n=d3.select("#chart").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),s=d3.scaleBand().range([0,width]).domain(e).padding(.01);n.append("g").attr("transform","translate(0,"+height+")").call(d3.axisBottom(s)).selectAll("text").attr("class","axisValues").attr("id",t=>"xAxis"+b(t.replace("("," ").replace(")"," "))).style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-45)");var p=d3.scaleBand().range([height,0]).domain(e.reverse()).padding(.01);n.append("g").call(d3.axisLeft(p)).selectAll("text").attr("class","axisValues").attr("id",t=>"yAxis"+b(t.replace("("," ").replace(")"," ")));var d=d3.scaleSequential().interpolator(d3.interpolateWarm),h=d3.scaleSequential().interpolator(d3.interpolateWarm);n.selectAll().data(dataTable).enter().append("rect").attr("x",function(t){return s(t.xName)}).attr("y",function(t){return p(t.yName)}).attr("width",s.bandwidth()).attr("height",p.bandwidth()).style("fill",t=>t.xName==t.yName||t.xValues.filter(t=>t>0).length<=1||t.yValues.filter(t=>t>0).length<=1?"#333":d(t.pearson)).attr("box-sizing","border-box").on("mouseout",function(){d3.selectAll(".axisValues").transition().attr("fill","white"),tooltip.transition().style("visibility","hidden")}).on("mouseover",function(t){d3.select("#xAxis"+b(t.xName.replace("("," ").replace(")"," "))).transition().attr("fill",d(.5)),d3.select("#yAxis"+b(t.yName.replace("("," ").replace(")"," "))).transition().attr("fill",d(.5)),X(d3.mouse(this),t)}).on("mousemove",function(t){X(d3.mouse(this),t)});var c=d3.range(20).map(t=>d(t/20)).reverse();n.append("defs").append("linearGradient").attr("id","gradient-colors").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%").selectAll("stop").data(c).enter().append("stop").attr("offset",function(t,e){return e/(c.length-1)}).attr("stop-color",function(t){return t});var g=n.append("g").attr("class","legendWrapper").attr("transform","translate("+(width+10)+","+margin.top+")");g.append("rect").attr("class","legendRect").attr("y",10).attr("width","15px").attr("height",height/2).style("fill","url(#gradient-colors)"),g.append("text").attr("class","legendTitle").text("Relationship Strength");var m=d3.scaleLinear().domain([0,1]).range([height/2-1,0]);g.append("g").attr("class","legendAxis").attr("transform","translate(15,10)").call(d3.axisRight(m).ticks(5).tickFormat(d3.format(".0%"))).selectAll("path").style("stroke","none");var x=n,f={x:window.scrollX,y:window.scrollY,w:window.innerWidth,h:window.innerHeight},u=d3.select("#chart"),y=(u.node().offsetWidth,u.node().offsetHeight,document.width,document.height,function(t){for(var e=d3.select("body").node(),a=0,o=0;null!=t&&t!=e;a+=t.offsetLeft||t.clientLeft,o+=t.offsetTop||t.clientTop,t=t.offsetParent||t.parentNode);return{x:a,y:o}}(x.node())),v={x:15,y:15},w=$("#chart").position();function b(t){return t.replace(/(?:^\w|[A-Z]|\b\w|\s+)/g,function(t,e){return 0==+t?"":0==e?t.toLowerCase():t.toUpperCase()})}function V(t,e,a,o){"object"==typeof a&&(o=a,a=!1),void 0===o&&(o={});for(var i=0,l=0,r=0,n=0,s=t.length,p=0;p<s;++p)i+=t[p],l+=e[p],r+=t[p]*e[p],n+=t[p]*t[p];if(o.m=(r-i*l/s)/(n-i*i/s),o.b=l/s-o.m*i/s,a){for(var d=0,h=0;h<s;++h)d+=(e[h]-o.b-o.m*t[h])*(e[h]-o.b-o.m*t[h]);var c=s*n-i*i,g=1/(s-2)*d;o.bErr=Math.sqrt(g/c*n),o.mErr=Math.sqrt(s/c*g)}return function(t){return o.m*t+o.b}}function S(t,e){let{min:a,pow:o,sqrt:i}=Math,l=(t,e)=>t+e,r=a(t.length,e.length);if(0===r)return 0;[t,e]=[t.slice(0,r),e.slice(0,r)];let[n,s]=[t,e].map(t=>t.reduce(l)),[p,d]=[t,e].map(t=>t.reduce((t,e)=>t+o(e,2),0)),h=t.map((t,a)=>t*e[a]).reduce(l),c=i((p-o(n,2)/r)*(d-o(s,2)/r));return 0===c?0:(h-n*s/r)/c}function X(t,e){var a=document.getElementById("chart").offsetLeft;d3.event.pageX,margin.left;tooltipSVG.select(".x").transition().call(d3.axisBottom(tooltipX)),tooltipSVG.select(".y").transition().call(d3.axisLeft(tooltipY));var o=d3.mouse(x.node());f.x=window.scrollX,f.y=window.scrollY,o[0]+=y.x,o[1]+=y.y,tooltip.style("right",""),tooltip.style("left",""),tooltip.style("bottom",""),tooltip.style("top",""),d3.select("#tooltipText").html(e.xName+" vs. "+e.yName+"</br>Strength: <span style='color:"+d(e.pearson)+";'>"+d3.format(".0%")(e.pearson)+"</span>"),tooltip.style("height",$("#heading").height()),o[0]>$(window).innerWidth()/2?tooltip.style("left",event.clientX-w.left-v.x-$("#tooltip").width()+"px"):tooltip.style("left",event.clientX-w.left+v.x+"px"),o[1]>$(window).innerHeight()/2?tooltip.style("top",event.clientY-w.top-v.y-$("#tooltip").height()+"px"):tooltip.style("top",event.clientY-w.top+v.y+"px"),tooltip.style("visibility","visible");for(var i=[],l=e.xValues.length-1;l>=0;l--)i.push({xValues:e.xValues[l],yValues:e.yValues[l]});tooltipX.domain([0,d3.max(e.xValues)]),tooltipY.domain([0,d3.max(e.yValues)]),h.domain(tooltipX.domain());var r=tooltipSVG.select("#scatterGroup").selectAll("circle").data(i);r.exit().remove(),r.enter().append("circle").attr("r",0),r.transition().attr("cx",t=>tooltipX(t.xValues)).attr("cy",t=>tooltipY(t.yValues)).attr("r",3).style("opacity",.5).attr("fill",t=>h(t.xValues));var n=[],s=e.linReg;for(l=0;l<tooltipX.domain()[1];l+=tooltipX.domain()[1]/50)n.push({xValues:l,yValues:s.m*l+s.b});n=n.filter(t=>t.xValues>=tooltipX.domain()[0]&&t.xValues<=tooltipX.domain()[1]&&t.yValues>=tooltipY.domain()[0]&&t.yValues<=tooltipY.domain()[1]);var p=tooltipSVG.selectAll("#tooltipLine").data([n]);p.enter().append("path").attr("id","tooltipLine").merge(p).transition().attr("d",PearsonPath).attr("fill","none").attr("stroke-width",2.5),d3.select("#tooltipLineText").text(function(){return s.b>0?"y = "+s.m.toFixed(2)+"*x + "+s.b.toFixed(2):"y = "+s.m.toFixed(2)+"*x "+s.b.toFixed(2)}),d3.select("#tooltipXText").text(e.xName),d3.select("#tooltipYText").text(e.yName)}})}